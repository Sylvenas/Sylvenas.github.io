<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Little Forest]]></title><description><![CDATA[A JavaScript library for building user interfaces]]></description><link>https://reactjs.org</link><generator>RSS for Node</generator><lastBuildDate>Thu, 20 Feb 2020 10:36:02 GMT</lastBuildDate><item><title><![CDATA[俄罗斯套娃娃 - Monad]]></title><description><![CDATA[<p>前面三章我们分别学习了<code class="gatsby-code-text">Functor</code>和<code class="gatsby-code-text">Applicative</code>的概念和实际应用，并列举了几个具体的例子，来说明了Functor和<code class="gatsby-code-text">Applicative</code>的实际用途，比如：使用<code class="gatsby-code-text">Either</code>来处理空值和更优雅的<code class="gatsby-code-text">try-catch</code>;使用<code class="gatsby-code-text">Validation</code>来做高度灵活高度可拓展的表单校验;同时我们应该已经牢牢掌握了<code class="gatsby-code-text">functor</code>的核心<code class="gatsby-code-text">map</code>，应用一个函数到包裹的值，<code class="gatsby-code-text">applicative</code>的核心<code class="gatsby-code-text">ap</code>，应用一个包裹的函数到一个包裹的值。</p>
<p>别忘了我们之前遗留的几个问题：</p>
<ul>
<li>如何解决嵌套的<code class="gatsby-code-text">try-catch</code></li>
<li>异步函数的组合</li>
<li><code class="gatsby-code-text">chain</code>函数又是什么</li>
</ul>
<p>我们一个一个的来解决,先从第一个嵌套的<code class="gatsby-code-text">try-catch</code>开始入手：</p>
<h3 id="arrayprototypeflatmap"><a href="#arrayprototypeflatmap" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Array.prototype.flatMap</h3>
<p><code class="gatsby-code-text">Javascript Array</code> 的map方法，相信我们每个人都非常的熟悉，并且几乎在每天的编程中都可能会用到，但<code class="gatsby-code-text">Array</code>的原型链上的另一个方法<code class="gatsby-code-text">Array.prototype.flatMap</code>可能很多人没怎么用过，从字面意思上理解就是扁平化的<code class="gatsby-code-text">map</code>，实际作用上也确实是的，我们看一个和<code class="gatsby-code-text">map</code>做对比的使用案例：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> <span class="token punctuation">[</span>x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// => [[2], [4], [6], [8]]</span>

arr1<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>x <span class="token operator">=></span> <span class="token punctuation">[</span>x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// => [2, 4, 6, 8]</span></code></pre>
      </div>
<p><code class="gatsby-code-text">flatMap</code>相对于<code class="gatsby-code-text">map</code>的区别是：</p>
<ul>
<li><code class="gatsby-code-text">map</code>是把函数执行的结果，放在一起然后装进一个Box中；</li>
<li><code class="gatsby-code-text">flatMap</code>的结果是把<strong>函数执行的结果分别去掉一层“包装”</strong>，然后放在一起装进一个Box中</li>
</ul>
<p>所以<code class="gatsby-code-text">flatMap</code>相当于是先<code class="gatsby-code-text">map</code>(映射)然后<code class="gatsby-code-text">flat</code>(拍平), 仅仅是多了一个“去包装”的操作！</p>
<p>下图这个流程完美的展现了<code class="gatsby-code-text">flatMap</code>的工作方式：</p>
<p><img src="https://p1.music.126.net/heup-JwK7nvaKfasxckrig==/109951164726073715.gif" alt="flatMap"></p>
<h3 id="嵌套的try-catch"><a href="#%E5%B5%8C%E5%A5%97%E7%9A%84try-catch" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>嵌套的try-catch</h3>
<p>上面介绍了Array的一种先<code class="gatsby-code-text">map</code>在<code class="gatsby-code-text">flat</code>的方法，Array也是我们<code class="gatsby-code-text">Box</code>理念的一个具体实现案例，那其他的Box呢？<code class="gatsby-code-text">Maybe</code>，<code class="gatsby-code-text">Either</code>又是如何实现的呢？我们先从一个更简单的函数组合的案例出发吧，现在我们需要编写一个获取用户地址的街道名称函数：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">address</span> <span class="token operator">=</span> user <span class="token operator">=></span> user<span class="token punctuation">.</span>address
<span class="token keyword">const</span> <span class="token function-variable function">street</span> <span class="token operator">=</span> address <span class="token operator">=></span> address<span class="token punctuation">.</span>street

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>street<span class="token punctuation">,</span> address<span class="token punctuation">)</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    address<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        street<span class="token punctuation">:</span> <span class="token string">'长安街'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">app</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token comment">// => 长安街</span></code></pre>
      </div>
<p>函数组合的理论也非常简单，只要上一个函数的返回值类型可以作为下一个函数的入参就可以放心大胆的进行组合了。</p>
<p>但是别忘了，我们的<code class="gatsby-code-text">user</code>对象上面<code class="gatsby-code-text">address</code>属性可能为<code class="gatsby-code-text">null/undefined</code>,上面的这段代码如果我们不做任何防范，那么<code class="gatsby-code-text">TypeError</code>的错误是不可避免的！这个问题不用担心，我们之前已经完全准备好了用来处理<code class="gatsby-code-text">null/undefined</code>的<code class="gatsby-code-text">Maybe functor</code>。现在我们<code class="gatsby-code-text">Maybe</code>来包装一下上面代码：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">address</span> <span class="token operator">=</span> user <span class="token operator">=></span>  <span class="token function">Maybe</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>u <span class="token operator">=></span> u<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">street</span> <span class="token operator">=</span> address <span class="token operator">=></span> <span class="token function">Maybe</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>a <span class="token operator">=></span> a<span class="token punctuation">.</span>street<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">app</span> <span class="token operator">=</span> user <span class="token operator">=></span>
    <span class="token function">address</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>                   <span class="token comment">// Maybe(address)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>street<span class="token punctuation">)</span>                <span class="token comment">// Maybe(Maybe(street))</span></code></pre>
      </div>
<p>看一下上面的代码，<code class="gatsby-code-text">address(user)</code>函数的返回值是<code class="gatsby-code-text">Maybe(address)</code>,然后我们继续map,把<code class="gatsby-code-text">address</code>传递给了<code class="gatsby-code-text">street</code>函数，别忘了<code class="gatsby-code-text">map</code>方法(<code class="gatsby-code-text">map: f =&gt; Just(f(x))</code>)会把函数计算的结果重新包装进Box中，所以我们最终得到的结果是一个<code class="gatsby-code-text">Maybe(Maybe(street))</code>。</p>
<p>这个时候如果我们想获取最终的street的结果，不得不在<code class="gatsby-code-text">map</code>之后先用<code class="gatsby-code-text">getOrElse</code>拆包第一层，然后再用<code class="gatsby-code-text">getOrElse</code>拆包第二层，最后得到最终的结果。</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">app</span> <span class="token operator">=</span> user <span class="token operator">=></span>
    <span class="token function">address</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>          <span class="token comment">// Maybe(address)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>street<span class="token punctuation">)</span>       <span class="token comment">// Maybe(Maybe(street))</span>
        <span class="token punctuation">.</span><span class="token function">getOrElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment">// Maybe(street)</span>
        <span class="token punctuation">.</span><span class="token function">getOrElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment">// street</span></code></pre>
      </div>
<p>这简直是代码版本的俄罗斯套娃娃：</p>
<p><img src="https://p1.music.126.net/M5xz6W-YU5gxERxRhLscRw==/109951164726066989.gif" alt="russian-dolls"></p>
<p>毫无疑问，我们有几次包装，就需要几次“拆包”操作，这样做逻辑上自然是没有什么问题。但是这岂不是和前端常见的<a href="">回调地狱</a>问题很类似，这样的代码写下去实在是太难维护和看懂了，我们总不能写一行就要数数有几层包装吧！</p>
<p>回头想想出现两层包装的原因是出在<code class="gatsby-code-text">map</code>方法上，<code class="gatsby-code-text">map</code>会把函数计算的结果重新包装进Box中，而这一层包装对我们来说有点赘余，我们之后马上进行了拆箱操作，这非常类似于<code class="gatsby-code-text">Array flatmap</code>的理念。</p>
<p><strong>所以我只需要一个方法(flatMap/chain)帮我们直接执行函数不做其他的任何操作，因为函数的返回值已经是被包装好了</strong></p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Just</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  chain<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Nothing</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  chain<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Nothing</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">app</span> <span class="token operator">=</span> user <span class="token operator">=></span>
    <span class="token function">address</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>                         <span class="token comment">// Maybe(address)</span>
        <span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>street<span class="token punctuation">)</span>                    <span class="token comment">// Maybe(street)</span>
        <span class="token punctuation">.</span><span class="token function">flod</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'no street'</span><span class="token punctuation">,</span>x <span class="token operator">=></span> x<span class="token punctuation">)</span>    <span class="token comment">// street</span></code></pre>
      </div>
<p>此时，我们可以明显的对比出来<code class="gatsby-code-text">map</code>和<code class="gatsby-code-text">chain</code>的不同点：<code class="gatsby-code-text">map</code>方法接收一个仅仅变换容器内值的函数，所以需要用Box重新包装；但是<code class="gatsby-code-text">chain</code>接收一个返回Box类型的函数仅此而已。</p>
<p><code class="gatsby-code-text">map</code>和<code class="gatsby-code-text">chain</code>的相同点却是非常明显的：都是返回一个Box的实例，方便后面继续链式的调用。</p>
<blockquote>
<p><code class="gatsby-code-text">chain</code>方法和<code class="gatsby-code-text">flod</code>方式非常相像，这我得承认他们确实很类似，但是他们的使用场景却完全不同！<code class="gatsby-code-text">flod</code>的通途是把一个值从Box中解放出来；<code class="gatsby-code-text">chain</code>的用途是把一个返回Box的函数应用到一个Box上,这样后面可以继续保持链式的调用。</p>
</blockquote>
<p>既然我们可以解决了嵌套的<code class="gatsby-code-text">Maybe</code>问题，那么嵌套的try-catch，自然用同样的理论也可以迎刃而解了：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Right</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  chain<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Left</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  chain<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Left</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">jsonFormat</span> <span class="token operator">=</span> str <span class="token operator">=></span>
    <span class="token function">tryCatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>ext<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">extFormat</span> <span class="token operator">=</span> ext <span class="token operator">=></span>
    <span class="token function">tryCatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">app</span> <span class="token operator">=</span> str <span class="token operator">=></span>
    <span class="token function">jsonFormat</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>extFormat<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">flod</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'no ext'</span><span class="token punctuation">,</span> x <span class="token operator">=></span> x<span class="token punctuation">)</span>

<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'{ "ext": "" }'</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">app</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token comment">// => 'no ext'</span></code></pre>
      </div>
<h3 id="异步与monad"><a href="#%E5%BC%82%E6%AD%A5%E4%B8%8Emonad" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步与Monad</h3>
<p>到目前为止，我们所讨论的问题都同步的问题，但是在Javascript的世界中90%的代码都是异步，可以说异步才是JavaScript世界的主流，谁能更优雅的解决异步的问题，谁就是JavaScript中的大明星，从刚开始的<code class="gatsby-code-text">callback</code>，到<code class="gatsby-code-text">Promise</code>，再到<code class="gatsby-code-text">async await</code>，那么在函数式编程中异步又该如何解决呢，从最常见的<code class="gatsby-code-text">http</code>请求作为引入的事例吧：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">httpGetUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=></span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'James'</span><span class="token punctuation">,</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">httpGetMovies</span> <span class="token operator">=</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=></span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">'加勒比海盗'</span><span class="token punctuation">,</span> <span class="token string">'霍比特人'</span><span class="token punctuation">,</span> <span class="token string">'蜘蛛侠'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'教父'</span><span class="token punctuation">,</span> <span class="token string">'小丑'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">app</span> <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">httpGetUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>httpGetMovies<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">// => ['加勒比海盗', '霍比特人', '蜘蛛侠']</span></code></pre>
      </div>
<p><code class="gatsby-code-text">httpGetUser</code>函数返回用户相关的信息，<code class="gatsby-code-text">httpGetMovies</code>函数根据用户<code class="gatsby-code-text">id</code>，返回电影列表类似的需求在我们的业务场景中也是非常常见的,现在我们简单的抽象一下上面的代码：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx">httpGetUser <span class="token punctuation">:</span><span class="token punctuation">:</span> id <span class="token operator">-</span><span class="token operator">></span> <span class="token function">Promise</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
httpGetMovies <span class="token punctuation">:</span><span class="token punctuation">:</span> user <span class="token operator">-</span><span class="token operator">></span> <span class="token function">Promise</span><span class="token punctuation">(</span>movies<span class="token punctuation">)</span>
app <span class="token punctuation">:</span><span class="token punctuation">:</span> id <span class="token operator">-</span><span class="token operator">></span> 
    <span class="token function">httpGetUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>httpGetMovies<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> console<span class="token punctuation">.</span>error<span class="token punctuation">)</span></code></pre>
      </div>
<p>然后我们对比一下上一节中的获取街道名称的例子:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx">address <span class="token punctuation">:</span><span class="token punctuation">:</span> user <span class="token operator">-</span><span class="token operator">></span>  <span class="token function">Maybe</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
street <span class="token punctuation">:</span><span class="token punctuation">:</span> address <span class="token operator">-</span><span class="token operator">></span> <span class="token function">Maybe</span><span class="token punctuation">(</span>street<span class="token punctuation">)</span>

app <span class="token punctuation">:</span><span class="token punctuation">:</span> user <span class="token operator">-</span><span class="token operator">></span>
    <span class="token function">address</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>                         <span class="token comment">// Maybe(address)</span>
        <span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>street<span class="token punctuation">)</span>                    <span class="token comment">// Maybe(street)</span>
        <span class="token punctuation">.</span><span class="token function">flod</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'no street'</span><span class="token punctuation">,</span>x <span class="token operator">=></span> x<span class="token punctuation">)</span>    <span class="token comment">// street</span></code></pre>
      </div>
<p>❗️️️❗️️️❗️️️ 这两个例子是何其的类似，两个函数的定义和两个<code class="gatsby-code-text">app</code>的调用方式，除了一个是<code class="gatsby-code-text">Maybe</code>一个是<code class="gatsby-code-text">Promise</code>，一个<code class="gatsby-code-text">chain</code>一个是<code class="gatsby-code-text">flod</code>。</p>
<p>Promise把我们从异步回调地狱中解放出来，而添加<code class="gatsby-code-text">chain</code>方法的<code class="gatsby-code-text">Maybe</code>，可以让我们从嵌套的<code class="gatsby-code-text">Maybe</code>中解脱出来。为何会这么的类似！</p>
<p>其实这是<code class="gatsby-code-text">Maybe</code>，<code class="gatsby-code-text">Promise</code>都是Monad(单子)的概念的拓展和具体实现！而<code class="gatsby-code-text">monad</code> 这个名字多么的让人难以理解，如果你去google一下<code class="gatsby-code-text">monad</code>，有无数篇在讲解<code class="gatsby-code-text">monad</code>,其中最经典的一个解释为：</p>
<blockquote>
<p>“A monad is just a monoid in the category of endofunctors. What’s the problem?”</p>
</blockquote>
<p><img src="https://p1.music.126.net/dUKuPfnrnZ0zt2zRfC8AOA==/109951164726072211.png" alt="monad"></p>
<p>好吧其实上面这句话的出处是<a href="http://james-iry.blogspot.com/2009/05/brief-incomplete-and-mostly-wrong.html">brief-incomplete-and-mostly-wrong</a>,完全是为何吐槽Haskell而说的，理论上没有错，但是却感觉是一句无用的废话。</p>
<p>而Monad的准确定义是：</p>
<blockquote>
<p>All told, a monad in X is just a monoid in the category of endofunctors of X, with product × replaced by composition of endofunctors and unit set by the identity endofunctor.</p>
</blockquote>
<p>所以上面这个定义你看懂了吗?(<del>别打我</del>)看不懂，真的没有关系，因为那是为专业的数学学生而准备的，我们只要掌握monad在实际代码中可以理解为<code class="gatsby-code-text">chainable</code>的对象即可</p>
<h3 id="函数组合与monad"><a href="#%E5%87%BD%E6%95%B0%E7%BB%84%E5%90%88%E4%B8%8Emonad" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数组合与monad</h3>
<p>在常规的函数组合中只要前一个函数的返回值是下一个函数的入参就可以，进行组合：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>fns<span class="token punctuation">)</span> <span class="token operator">=></span> x <span class="token operator">=></span> fns<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">g</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>但是</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">address</span> <span class="token operator">=</span> user <span class="token operator">=></span>  <span class="token function">Maybe</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>u <span class="token operator">=></span> u<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">street</span> <span class="token operator">=</span> address <span class="token operator">=></span> <span class="token function">Maybe</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>a <span class="token operator">=></span> a<span class="token punctuation">.</span>street<span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>street<span class="token punctuation">,</span> address<span class="token punctuation">)</span> <span class="token comment">// 可以这样组合吗？ No!</span></code></pre>
      </div>
<p>我们没办法直接把<code class="gatsby-code-text">address</code>的返回值直接传递给<code class="gatsby-code-text">street</code>函数，因为<code class="gatsby-code-text">address</code>函数的返回值是一个<code class="gatsby-code-text">Maybe(address)</code>，函数<code class="gatsby-code-text">street</code>的入参是<code class="gatsby-code-text">address</code>，所以我们要使用<code class="gatsby-code-text">chain</code>方法把<code class="gatsby-code-text">address从Maybe(address)</code>中提取出来，然后传递给<code class="gatsby-code-text">street</code>函数，所以<code class="gatsby-code-text">monad</code>版本<code class="gatsby-code-text">compose</code>就应运而生了：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">composeM</span> <span class="token operator">=</span> method <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token operator">...</span>fns<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>fns<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=></span> x <span class="token operator">=></span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> composeChain <span class="token operator">=</span> <span class="token function">composeM</span><span class="token punctuation">(</span><span class="token string">'chain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">composeChain</span><span class="token punctuation">(</span>street<span class="token punctuation">,</span> address<span class="token punctuation">)</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">app</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrElse</span><span class="token punctuation">(</span><span class="token string">'no street'</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>这样的定理也完全适用于Promise的组合：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> composeThen <span class="token operator">=</span> <span class="token function">composeM</span><span class="token punctuation">(</span><span class="token string">'then'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">composeThen</span><span class="token punctuation">(</span>httpGetMovies<span class="token punctuation">,</span> httpGetUser<span class="token punctuation">)</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> console<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token comment">// => ['加勒比海盗', '霍比特人', '蜘蛛侠']</span></code></pre>
      </div>
<h3 id="monad-定律"><a href="#monad-%E5%AE%9A%E5%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>monad 定律</h3>
<h4 id="结合律"><a href="#%E7%BB%93%E5%90%88%E5%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结合律</h4>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx">m<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span> <span class="token operator">===</span> m<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>x <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>这个定律我们在<code class="gatsby-code-text">composeChain</code>，<code class="gatsby-code-text">composeThen</code>的例子中已经证明过了</p>
<h4 id="identity"><a href="#identity" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>identity</h4>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token constant">M</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// Left identity</span>
<span class="token constant">M</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">M</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment">// Right identity</span></code></pre>
      </div>
<p>这个实在是太简单的，而现在同时满足结合律和<code class="gatsby-code-text">identity</code>定律的集合又可以被称为<strong>幺半群</strong>，所以这也就解释了</p>
<blockquote>
<p>“A monad is just a monoid in the category of endofunctors. What’s the problem?”</p>
</blockquote>
<p>但是这真的是个巧合，仅仅是个调侃罢了，幺半群也不是Monad的主要使用方向。</p>
<h3 id="monad与applicative"><a href="#monad%E4%B8%8Eapplicative" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Monad与Applicative</h3>
<p>Monad更擅长处理的是一种拥有<code class="gatsby-code-text">Context</code>的场景，我们上面的<code class="gatsby-code-text">httpGetUser</code>与<code class="gatsby-code-text">httpGetMovies</code>的例子中，<code class="gatsby-code-text">httpGetMovies</code>函数必须等到<code class="gatsby-code-text">httpGetUser</code>函数中的异步执行完成才能开始调用，这是一种<strong>纵向(串行)</strong>的链路；</p>
<p>而<strong>Applicative更擅长的是处理一种横向(并行)的链路</strong>，比如上一章介绍的表单校验的例子，每个字段的校验之间完全没有什么关联关系。</p>
<h3 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>
<ul>
<li><code class="gatsby-code-text">Functor</code>是一种实现<code class="gatsby-code-text">map</code>方法的数据类型</li>
<li><code class="gatsby-code-text">Applicative</code>是一种实现了<code class="gatsby-code-text">apply</code>方法的数据类型</li>
<li><code class="gatsby-code-text">Monad</code>是一种实现了<code class="gatsby-code-text">chain</code>或<code class="gatsby-code-text">flatmap</code>方法的数据类型.</li>
</ul>
<p>那么<code class="gatsby-code-text">Functor</code>、<code class="gatsby-code-text">Applicative</code>和<code class="gatsby-code-text">Monad</code>三个区别是什么？</p>
<p><img src="https://p1.music.126.net/bDmdHmGZ635HmpgBPy-tlw==/109951164726068415.png" alt="functor-applicative-monad"></p>
<ul>
<li><code class="gatsby-code-text">Functor</code>: 应用一个函数到包裹的值，使用<code class="gatsby-code-text">map</code>.</li>
<li><code class="gatsby-code-text">Applicative</code>: 应用一个包裹的函数到包裹的值,使用<code class="gatsby-code-text">ap</code></li>
<li><code class="gatsby-code-text">Monad</code>: 应用一个返回包裹值的函数到一个包裹的值，使用<code class="gatsby-code-text">chain</code>.</li>
</ul>
<p>参考资料与引用文章：<br>
[1]: <a href="https://medium.com/@lettier/your-easy-guide-to-monads-applicatives-functors-862048d61610">your easy guide to monads applicatives functors</a><br>
[2]: <a href="https://www.jdon.com/idea/functor-monad.html">functor-monad</a><br>
[3]:《JavaScript函数式编程》<br>
[4]: <a href="https://bartoszmilewski.com/2014/10/28/category-theory-for-programmers-the-preface/">写给程序员的范畴论</a></p>]]></description><link>https://reactjs.org/blog/2020/02/12/俄罗斯套娃娃.html</link><guid isPermaLink="false">https://reactjs.org/blog/2020/02/12/俄罗斯套娃娃.html</guid><pubDate>Tue, 11 Feb 2020 16:00:00 GMT</pubDate></item><item><title><![CDATA[纪念刘和珍君]]></title><description><![CDATA[<p>中华民国十五年三月二十五日，就是国立北京女子师范大学为十八日在段祺瑞执政府前遇害的刘和珍杨德群两君开追悼会的那一天，我独在礼堂外徘徊，遇见程君，前来问我道，“先生可曾为刘和珍写了一点什么没有？”我说“没有”。她就正告我，“先生还是写一点罢; 刘和珍生前就很爱看先生的文章。”</p>
<p>这是我知道的，凡我所编辑的期刊，大概是因为往往有始无终之故罢，销行一向就甚为寥落，然而在这样的生活艰难中，毅然预定了《莽原》全年的就有她。我也早觉得有写一点东西的必要了，这虽然于死者毫不相干，但在生者，却大抵只能如此而已。倘使我能够相信真有所谓 “在天之灵”，那自然可以得到更大的安慰，——但是，现在，却只能如此而已。</p>
<p><strong>可是我实在无话可说。我只觉得所住的并非人间。</strong>四十多个青年的血，洋溢在我的周围，使我艰于呼吸视听，那里还能有什么言语？长歌当哭，是必须在痛定之后的。而此后几个所谓学者文人的阴险的论调，尤使我觉得悲哀。我已经出离愤怒了。我将深味这非人间的浓黑的悲凉;以我的最大哀痛显示于非人间，使它们快意于我的苦痛，就将这作为后死者的菲薄的祭品，奉献于逝者的灵前。</p>
<hr>
<p>真的猛士，敢于直面惨淡的人生，敢于正视淋漓的鲜血。这是怎样的哀痛者和幸福者？然而造化又常常为庸人设计，以时间的流驶，来洗涤旧迹，仅使留下淡红的血色和微漠的悲哀。在这淡红的血色和微漠的悲哀中，又给人暂得偷生，维持着这似人非人的世界。我不知道这样的世界何时是一个尽头!</p>
<p>我们还在这样的世上活着; 我也早觉得有写一点东西的必要了。离三月十八日也已有两星期，忘却的救主快要降临了罢，我正有写一点东西的必要了。</p>
<hr>
<p>在四十余被害的青年之中，刘和珍君是我的学生。学生云者，我向来这样想，这样说，现在却觉得有些踌躇了，我应该对她奉献我的悲哀与尊敬。她不是“苟活到现在的我”的学生，是为了中国而死的中国的青年。</p>
<p>她的姓名第一次为我所见，是在去年夏初杨荫榆女士做女子师范大学校长，开除校中六个学生自治会职员的时候。其中的一个就是她;但是我不认识。直到后来，也许已经是刘百昭率领男女武将，强拖出校之后了，才有人指着一个学生告诉我，说：这就是刘和珍。其时我才能将姓名和实体联合起来，心中却暗自诧异。我平素想，能够不为势利所屈，反抗一广有羽翼的校长的学生，无论如何，总该是有些桀骜锋利的，但她却常常微笑着，态度很温和。待到偏安于宗帽胡同，赁屋授课之后，她才始来听我的讲义，于是见面的回数就较多了，也还是始终微笑着，态度很温和。待到学校恢复旧观，往日的教职员以为责任已尽，准备陆续引退的时候，我才见她虑及母校前途，黯然至于泣下。此后似乎就不相见。总之，在我的记忆上，那一次就是永别了。</p>
<hr>
<p>我在十八日早晨，才知道上午有群众向执政府请愿的事;下午便得到噩耗，说卫队居然开枪，死伤至数百人，而刘和珍君即在遇害者之列。但我对于这些传说，竟至于颇为怀疑。我向来是不惮以最坏的恶意，来推测中国人的，然而我还不料，也不信竟会下劣凶残到这地步。况且始终微笑着的和蔼的刘和珍君，更何至于无端在府门前喋血呢？</p>
<p>然而即日证明是事实了，作证的便是她自己的尸骸。还有一具，是杨德群君的。而且又证明着这不但是杀害，简直是虐杀，因为身体上还有棍棒的伤痕。</p>
<p>但段政府就有令，说她们是 “暴徒”!</p>
<p>但接着就有流言，说她们是受人利用的。</p>
<p>惨象，已使我目不忍视了;流言，尤使我耳不忍闻。我还有什么话可说呢？我懂得衰亡民族之所以默无声息的缘由了。沉默呵，沉默呵!不在沉默中爆发，就在沉默中灭亡。</p>
<hr>
<p>但是，我还有要说的话。</p>
<p>我没有亲见;听说，她，刘和珍君，那时是欣然前往的。自然，请愿而已，稍有人心者，谁也不会料到有这样的罗网。但竟在执政府前中弹了，从背部入，斜穿心肺，已是致命的创伤，只是没有便死。同去的张静淑君想扶起她，中了四弹，其一是手枪，立仆;同去的杨德群君又想去扶起她，也被击，弹从左肩入，穿胸偏右出，也立仆。但她还能坐起来，一个兵在她头部及胸部猛击两棍，于是死掉了。</p>
<p>始终微笑的和蔼的刘和珍君确是死掉了，这是真的，有她自己的尸骸为证，沉勇而友爱的杨德群君也死掉了，有她自己的尸骸为证;只有一样沉勇而友爱的张静淑君还在医院里呻吟。当三个女子从容地转辗于文明人所发明的枪弹的攒射中的时候，这是怎样的一个惊心动魂的伟大呵!中国军人的屠戮妇婴的伟绩，八国联军的惩创学生的武功，不幸全被这几缕血痕抹杀了。</p>
<p>但是中外的杀人者却居然昂起头来，不知道个个脸上有着血污……。</p>
<hr>
<p>时间永是流驶，街市依旧太平，有限的几个生命，在中国是不算什么的，至多，不过供无恶意的闲人以饭后的谈资，或者给有恶意的闲人作“流言”的种子。至于此外的深的意义，我总觉是很寥寥，因为这实在不过是徒手的请愿。人类的血战前行的历史，正如煤的形成，当时用大量的木材，结果却只是一小块，但请愿是不在其中的，更何况是徒手。</p>
<p>然而既然有了血痕了，当然不觉要扩大。至少，也当浸渍了亲族，师友，爱人的心，纵使时光流驶，洗成绯红，也会在微漠的悲哀中永存微笑的和蔼的旧影。陶潜说过，“亲戚或余悲，他人亦已歌，死去何所道，托体同山阿。”倘能如此，这也就够了。</p>
<hr>
<p>我已经说过： 我向来是不惮以最坏的恶意来推测中国人的。但这回却很有几点出于我的意外。一是当局者竟会这样地凶残，一是流言家竟至如此之下劣，一是中国的女性临难竟能如是之从容。</p>
<p>我目睹中国女子的办事，是始于去年的，虽然是少数，但看那干练坚决，百折不回的气概，曾经屡次为之感叹。至于这一回在弹雨中互相救助，虽殒身不恤的事实，则更足为中国女子的勇毅，虽遭阴谋秘计，压抑至数千年，而终于没有消亡的明证了。倘要寻求这一次死伤者对于将来的意义，意义就在此罢。</p>
<p>苟活者在淡红的血色中，会依稀看见微茫的希望;真的猛士，将更奋然而前行。</p>
<p>呜呼，我说不出话，但以此记念刘和珍君!</p>
<p>四月一日。</p>
<p>— 鲁迅</p>]]></description><link>https://reactjs.org/blog/2020/02/07/记念刘和珍君.html</link><guid isPermaLink="false">https://reactjs.org/blog/2020/02/07/记念刘和珍君.html</guid><pubDate>Thu, 06 Feb 2020 16:00:00 GMT</pubDate></item><item><title><![CDATA[应用函子 - Applicative]]></title><description><![CDATA[<h3 id="加法运算"><a href="#%E5%8A%A0%E6%B3%95%E8%BF%90%E7%AE%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>加法运算</h3>
<p>现在让我们回想一下第一章中我们反复介绍的<code class="gatsby-code-text">Functor</code>的核心思想，就是通过<code class="gatsby-code-text">map</code>，把一个函数应用到包裹的值上：<code class="gatsby-code-text">Box(1).map(x =&gt; x+1)</code>,通常我们都是把一个值装进Box中，然后不断的通过<code class="gatsby-code-text">map</code>变化其中的值，别忘了在函数式的思维中，<a href="">函数是一等公民</a>，我们如果先把一个函数包装进了Box中，然后在需要的时候在应用这个函数，举个例子说明：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">addOne</span> <span class="token operator">=</span> x <span class="token operator">=></span> x <span class="token operator">+</span> <span class="token number">1</span>

<span class="token function">Box</span><span class="token punctuation">(</span>addOne<span class="token punctuation">)</span> <span class="token comment">// => Box(x => x+1)</span></code></pre>
      </div>
<p>现在我们得到了一个包裹着函数的Box，可是我们怎么使用这个函数呢？毕竟平常的Functor map方法都是接收一个函数！</p>
<p>不如继续回到函数<code class="gatsby-code-text">addOne</code>上，我们需要一个数字，传递给<code class="gatsby-code-text">addOne</code>,对吧！所以思路继续转换一下，我们怎么传递一个数据进去应用这个<code class="gatsby-code-text">addOne</code>函数呢，答案非常简单，继续传递一个被包裹的值，然后map这个函数不就可以啦!看代码：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Box</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    flod<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    apply<span class="token punctuation">:</span> o <span class="token operator">=></span> o<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>inspect<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Box(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">Box</span><span class="token punctuation">(</span>addOne<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// => Box(3)</span></code></pre>
      </div>
<p>看看Box神奇的新方法，首先被包裹的值是一个函数x，然后我们继续传递另一个<code class="gatsby-code-text">Box(2)</code>进去，不就可以使用<code class="gatsby-code-text">Box(2)</code>上的map方法调用<code class="gatsby-code-text">addOne</code>函数了吗！</p>
<blockquote>
<p>这和<code class="gatsby-code-text">柯里化</code>,<code class="gatsby-code-text">偏应用</code>的思路非常类似，先传递部分参数(函数完全可以当成普通的参数传递)，然后继续传递部分参数，最后进行求值操作。</p>
</blockquote>
<p>现在重新审视一下我们<code class="gatsby-code-text">Box(addOne)</code>,<code class="gatsby-code-text">Box(1)</code>,那么这个问题实际上可以归结为：把一个 <code class="gatsby-code-text">functor</code> 应用到另一个上functor上，而这也就是<code class="gatsby-code-text">applicative functor</code>(应用函子)最擅长的操作了,看一下示意图来描述应用函子的操作流程</p>
<p><img src="https://p1.music.126.net/kfldU46LvUhUaY_QjP6LHw==/109951164712439705.png" alt="applicative functor"></p>
<p>所以根据上面的讲解和实例我们可以得出一个结论：先把一个值<code class="gatsby-code-text">x</code>装进<code class="gatsby-code-text">Box</code>，然后<code class="gatsby-code-text">map</code>一个函数<code class="gatsby-code-text">f</code>和把函数<code class="gatsby-code-text">f</code>装进<code class="gatsby-code-text">Box</code>，然后<code class="gatsby-code-text">ap</code>一个已经已经装进<code class="gatsby-code-text">Box</code>的<code class="gatsby-code-text">x</code>，是完全等价的！</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token constant">F</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">F</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>addOne<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Box</span><span class="token punctuation">(</span>addOne<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// => Box(3)</span></code></pre>
      </div>
<blockquote>
<p>根据<a href="https://github.com/fantasyland/fantasy-land#applicative">规范</a>,apply 方法后面我们会简写为<code class="gatsby-code-text">ap</code>!</p>
</blockquote>
<blockquote>
<p>applicative functor 也是函数式编程中一大堆“故弄玄虚”的概念中唯一的比较“名副其实”的了，想想<code class="gatsby-code-text">Functor(mappable)</code>,<code class="gatsby-code-text">Semigroup(concatible)</code></p>
</blockquote>
<h3 id="柯里化与应用函子"><a href="#%E6%9F%AF%E9%87%8C%E5%8C%96%E4%B8%8E%E5%BA%94%E7%94%A8%E5%87%BD%E5%AD%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>柯里化与应用函子</h3>
<p>继续往前走一步，思考一下，如果现在有两个被包裹的值，怎么把一个函数应用上去呢？举个例子：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> x <span class="token operator">=></span> y <span class="token operator">=></span> x <span class="token operator">+</span> y

<span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>现在我们没办法直接把<code class="gatsby-code-text">Box(1)</code>和<code class="gatsby-code-text">Box(2)</code>相加，他们都在盒子里;可是我们的需求不就是把<code class="gatsby-code-text">Box(1)</code>,<code class="gatsby-code-text">Box(2)</code>,<code class="gatsby-code-text">add</code> 三者互相应用一下吗？不管怎么说，我们先把<code class="gatsby-code-text">add</code>函数包装进Box中,然后得到了一个应用函子<code class="gatsby-code-text">Box(add)</code>,不就可以继续ap了吗</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token function">Box</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// => Box(y => x +y) (得到另一个应用函子)</span>
<span class="token function">Box</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// => Box(3) (得到最终的结果)</span></code></pre>
      </div>
<p>上面的例子，我们可以得出一个结论，一个柯里化的函数，有几个参数，我们就可以ap几次！
再次套用一下上面的公式：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token constant">F</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">F</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Box</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Box</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
      </div>
<h3 id="应用函子的实际应用"><a href="#%E5%BA%94%E7%94%A8%E5%87%BD%E5%AD%90%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用函子的实际应用</h3>
<p>表单校验是我们日常开发中非常常见的一个模块，举个具体的例子，假如我们有一个用户注册的表单，我们需要校验用户名，密码，与邮箱三个字段，常见的代码如下：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">checkUserInfo</span> <span class="token operator">=</span> user <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> pw<span class="token punctuation">,</span> phone <span class="token punctuation">}</span> <span class="token operator">=</span> user
    <span class="token keyword">const</span> errInfo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/^(0|[1-9][0-9]*)$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        errInfo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'用户名不能是数字'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pw<span class="token punctuation">.</span>length <span class="token operator">>=</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        errInfo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'密码长度必须大于6位'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/^1[3|4|5|7|8][0-9]{9}$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        errInfo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'手机号码不正确'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>errInfo<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> errInfo 
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token string">'success'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'12'</span><span class="token punctuation">,</span>
    pw<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    phone<span class="token punctuation">:</span> <span class="token string">'15381048021'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> checkRes <span class="token operator">=</span> <span class="token function">checkUserInfo</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>checkRes<span class="token punctuation">)</span>  <span class="token comment">// => { res: false, errInfo: [ '用户名不能是数字', '手机号码不正确' ] }</span></code></pre>
      </div>
<p>这个代码自然没有问题，但是，假如我们要继续添加需要校验的字段的话，<code class="gatsby-code-text">checkUserInfo</code>函数毫无疑问会越来越大，并且如果我们要修改某一个字段的校验规则的话，整个<code class="gatsby-code-text">checkUserInfo</code>函数可能会收到影响，我们需要增加的单元测试工作要更多了，现在按照函数式的思维(函数组合)来拆分一下<code class="gatsby-code-text">checkUserInfo</code>函数：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">checkName</span> <span class="token operator">=</span> name <span class="token operator">=></span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token operator">/</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">)</span>$<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">checkPW</span> <span class="token operator">=</span> pw <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> pw<span class="token punctuation">.</span>length <span class="token operator">>=</span> <span class="token number">6</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">checkPhone</span> <span class="token operator">=</span> phone <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">/</span><span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">|</span><span class="token number">4</span><span class="token operator">|</span><span class="token number">5</span><span class="token operator">|</span><span class="token number">7</span><span class="token operator">|</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">9</span><span class="token punctuation">}</span>$<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>现在我们拆分成对三个字段分别校验的函数<code class="gatsby-code-text">checkName</code>,<code class="gatsby-code-text">checkPW</code>,<code class="gatsby-code-text">checkPhone</code>,每个函数返回的结果要么是<code class="gatsby-code-text">true</code>，要么是<code class="gatsby-code-text">false</code>，这个和我们第一章介绍的<code class="gatsby-code-text">Either</code>(向左 or 向右)何其相似,只不过我们现在面临的情况是要么校验成功，要么检验失败，所以我们完全可以仿照<code class="gatsby-code-text">Either functor</code> 写<code class="gatsby-code-text">Validation</code>,它也拥有两个分支：<code class="gatsby-code-text">Success / Failure</code></p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Success</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    x<span class="token punctuation">,</span>
    map<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Success</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fold<span class="token punctuation">:</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    ap<span class="token punctuation">:</span> o <span class="token operator">=></span> o<span class="token punctuation">.</span>isFailure <span class="token operator">?</span> o <span class="token punctuation">:</span> o<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    isSuccess<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    isFailure<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>inspect<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Success(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">Failure</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    x<span class="token punctuation">,</span>
    map<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Failure</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    ap<span class="token punctuation">:</span> o <span class="token operator">=></span> o<span class="token punctuation">.</span>isFailure <span class="token operator">?</span> <span class="token function">Failure</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">Failure</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    fold<span class="token punctuation">:</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    isSuccess<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    isFailure<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>inspect<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Failure(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>相对比与<code class="gatsby-code-text">Either</code>，新增了<code class="gatsby-code-text">x</code>属性和<code class="gatsby-code-text">ap</code>方法，其他的属性完全类似，就不做解释了；新增<code class="gatsby-code-text">x</code>属性的原因在于需要记录表单校验的错误信息，这个很好理解；</p>
<p>我们仔细看一下新增的<code class="gatsby-code-text">ap</code>方法，先看<code class="gatsby-code-text">Sucsess</code>分支的ap：<code class="gatsby-code-text">o =&gt; o.isFailure ? o : o.map(x)</code>,毫无疑问<code class="gatsby-code-text">ap</code>方法接收另一个<code class="gatsby-code-text">functor</code>，如果另一个<code class="gatsby-code-text">functor</code>是<code class="gatsby-code-text">Failure</code>的实例，则不需要<code class="gatsby-code-text">Success</code>处理直接返回，如果不是<code class="gatsby-code-text">Failure</code>，则和平常<code class="gatsby-code-text">applicative functor</code>一样，对<code class="gatsby-code-text">o</code>作为主题进行map;</p>
<p>在看<code class="gatsby-code-text">Failure</code>分支上的ap：<code class="gatsby-code-text">o =&gt; o.isFailure ? Failure(x.concat(o.x)) : Failure(x)</code>,如果是<code class="gatsby-code-text">Failure</code>的实例，则进行一个类似于<code class="gatsby-code-text">semigroup</code>的<code class="gatsby-code-text">concat</code>操作，实际上就是为了累加错误信息，而如果不是<code class="gatsby-code-text">Failure</code>的实例则直接返回原本已经记录的错误信息。</p>
<p>做好了前期的准备工作，我们就可以大刀阔斧的修改<code class="gatsby-code-text">checkUserInfo</code>函数了：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">success</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'success'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">checkUserInfo</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> pw<span class="token punctuation">,</span> phone <span class="token punctuation">}</span> <span class="token operator">=</span> user
    <span class="token comment">// 3 是因为我们正调用 `ap` 3 次。</span>
    <span class="token keyword">let</span> returnSuccess <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">curryN</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Success</span><span class="token punctuation">(</span>returnSuccess<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">checkName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">checkPW</span><span class="token punctuation">(</span>pw<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">checkPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> checkRes <span class="token operator">=</span> <span class="token function">checkUserInfo</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>checkRes<span class="token punctuation">)</span> <span class="token comment">// => Failure(用户名不能是数字,手机号码不正确)</span></code></pre>
      </div>
<p>上面代码中对<code class="gatsby-code-text">success</code>函数执行<code class="gatsby-code-text">curryN(3, success)</code>的操作，就是为了后面可以<a href="">连续的ap三次</a></p>
<blockquote>
<p>此处需要指出的是<code class="gatsby-code-text">applicative functor</code>更擅长的是处理并行问题的能力，<code class="gatsby-code-text">checkName</code>，<code class="gatsby-code-text">checkPW</code>，<code class="gatsby-code-text">checkPhone</code>函数都是同步函数，假如说这三个函数都是异步的，那么实际上这三个请求‘几乎会同时’发送出去，别着急，后面的章节我们会讨论异步的世界，现在只要把理论和概念理解清楚就OK！</p>
</blockquote>
<h3 id="applicative的定理"><a href="#applicative%E7%9A%84%E5%AE%9A%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>applicative的定理</h3>
<h4 id="同一律（identity）"><a href="#%E5%90%8C%E4%B8%80%E5%BE%8B%EF%BC%88identity%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>同一律（identity）</h4>
<p>完全类似于functor的同一律完全类似，先把id函数包装进Applicative functor中，然后<code class="gatsby-code-text">apply</code>一个<code class="gatsby-code-text">Box(1)</code>和<code class="gatsby-code-text">Box(1).map(id)</code>的结果是一样</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">id</span> <span class="token operator">=</span> x <span class="token operator">=></span> x

<span class="token constant">A</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">A</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">A</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token function">Box</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code></pre>
      </div>
<h4 id="同态（homomorphism）"><a href="#%E5%90%8C%E6%80%81%EF%BC%88homomorphism%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>同态（homomorphism）</h4>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token constant">A</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">A</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">Box</span><span class="token punctuation">(</span>addOne<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>addOne<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token function">addOne</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre>
      </div>
<h4 id="互换（interchange）"><a href="#%E4%BA%92%E6%8D%A2%EF%BC%88interchange%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>互换（interchange）</h4>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token constant">A</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">A</span><span class="token punctuation">(</span>f<span class="token operator">=></span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">Box</span><span class="token punctuation">(</span>addOne<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Box</span><span class="token punctuation">(</span>f <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span>addOne<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre>
      </div>
<h4 id="applicative和functor的区别和联系"><a href="#applicative%E5%92%8Cfunctor%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>applicative和functor的区别和联系</h4>
<p>根据applicative的同一律和同态，两条特性，我们可以得出一个结论，假如一个盒子(Box),实现了<code class="gatsby-code-text">ap</code>方法，那么我们一定可以利用<code class="gatsby-code-text">ap</code>方法推导出一个<code class="gatsby-code-text">map</code>方法，如果拥有了<code class="gatsby-code-text">map</code>方法，那它就是一个<code class="gatsby-code-text">functor</code>,所以我们也可以认为<code class="gatsby-code-text">applicative</code>是<code class="gatsby-code-text">functor</code>的拓展，比<code class="gatsby-code-text">functor</code>更强大。</p>
<p>那么强大在何处呢? <code class="gatsby-code-text">functor</code>只能映射一个接收单个参数的函数(i.e., <code class="gatsby-code-text">x=&gt;y</code>),如果我们想把接收多个参数的函数(i.e., <code class="gatsby-code-text">x =&gt; y =&gt; z</code>)应用到多个值上，则是applicative的舞台了，
想想<code class="gatsby-code-text">checkUserInfo</code>的例子。</p>
<p>上面是实际应用中的对比，从抽象的数学层面来对比：</p>
<ul>
<li>functor: 应用一个函数到包裹的值:<code class="gatsby-code-text">Box(1).map(x =&gt; x+1)</code>.</li>
<li>applicative: 应用一个包裹的函数到包裹的值:<code class="gatsby-code-text">Box(x =&gt; x+1).ap(Box(1))</code>.</li>
</ul>
<p><img src="https://p1.music.126.net/qnIolKU9yLB9tH7onLbj7w==/109951164719087429.png" alt="applicative vs functor"></p>
<p>参考资料与引用文章：<br>
[1]: <a href="https://medium.com/axiomzenteam/functor-applicative-and-why-8a08f1048d3d">functor-applicative-and-why?</a><br>
[2]: <a href="https://stackoverflow.com/questions/46752031/what-is-my-applicative-functor-not-working-with-ramdas-ap">applicative and list</a><br>
[3]: <a href="http://jiyinyiyong.github.io/monads-in-pictures/">Monad in Pictures</a><br>
[4]:《JavaScript函数式编程》   </p>]]></description><link>https://reactjs.org/blog/2020/02/05/应用函子.html</link><guid isPermaLink="false">https://reactjs.org/blog/2020/02/05/应用函子.html</guid><pubDate>Tue, 04 Feb 2020 16:00:00 GMT</pubDate></item><item><title><![CDATA[加法是自然之道 - Monoid]]></title><description><![CDATA[<h3 id="积木游戏"><a href="#%E7%A7%AF%E6%9C%A8%E6%B8%B8%E6%88%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>积木游戏</h3>
<blockquote>
<p>说出来你可能不信，我只花了十分钟的时间就教会三岁的小孩什么是半群,ahhhhh.jpg</p>
</blockquote>
<p>周末在家陪小侄女玩了一个小时的积木，在不断叠加积木的过程中，突然想到用搭积木的案例来描述什么是<code class="gatsby-code-text">半群</code>异常的清晰,看下面三个积木：</p>
<p><img src="" alt="红黄蓝积木"></p>
<p>看到这三个积木，(<del>是不是有一种把他们叠在一起的冲动</del>)，按照常规操作，有一部分人可能会总左向右开始叠加，也就是先把最左边的红色积木和中间的黄色积木，搭在一起；然后把最后一个蓝色叠加上，那么最后的结果是：</p>
<p><img src="" alt="积木拼接结果"></p>
<p>然后可能有另一部分人从右向左叠加，那么就是先拼接黄色和蓝色；然后最后加上红色的积木；最后得到的结果，毫无疑问和第一种是一样的，<del>你这不是废话吗!!</del></p>
<p>组合方法如果满足这种不论先拼接哪一块，最后按顺序组合在一起，得到的结果就是一样的，这被称为<strong>associative</strong>(可结合的)，积木的游戏很明显是满足这个法则的；而这个过程，我只演示了一遍，三岁的小侄女，就明白了这个道理；我觉的我们20多岁的人，可能不需要任何解释吧；</p>
<p>而满足结合律的数据类型，则可以称之为半群(Semigroup)，是不是想起来了，很常用的<code class="gatsby-code-text">Array.prototype.concat</code>就是一个完全类似的东西，下面我们给半群一个精确的定义和解释。</p>
<h3 id="半群"><a href="#%E5%8D%8A%E7%BE%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>半群</h3>
<p>一个半群(Semigroup)是带有组合方法(i.e.,<code class="gatsby-code-text">Array</code>的<code class="gatsby-code-text">concat</code>)的数据类型，假设我们的组合符号是<code class="gatsby-code-text">+</code>,那么组合方法满足结合律:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx">a <span class="token operator">+</span> <span class="token punctuation">(</span>b <span class="token operator">+</span> c<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">+</span> c</code></pre>
      </div>
<p>在举个小学数学的知识来验证一下：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

a <span class="token operator">+</span> <span class="token punctuation">(</span>b <span class="token operator">+</span> c<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">+</span> c   <span class="token comment">// => true</span>

<span class="token keyword">const</span> e <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

e <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>f <span class="token operator">&amp;&amp;</span> g<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token punctuation">(</span>e <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> g   <span class="token comment">// => true</span></code></pre>
      </div>
<p>Ok!让我们切换到JavaScript的世界：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token string">'a'</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'a'</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span> <span class="token comment">// => true</span>

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// [1,2,3,4,5,6,7,8,9]</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>   <span class="token comment">// [1,2,3,4,5,6,7,8,9]</span></code></pre>
      </div>
<p>由于JavaScript中<code class="gatsby-code-text">String</code>,<code class="gatsby-code-text">Array</code>类型，原型链上本身具有<code class="gatsby-code-text">cancat</code>方法，所以我们可以不断的<code class="gatsby-code-text">.concat .concat</code>;但是我们<code class="gatsby-code-text">Number</code>类型却没有，所以没法实现类似<code class="gatsby-code-text">1.concat(2).concat(3)</code>的代码；</p>
<p>回想一下第一章中的Box理念，如果我们把数字<code class="gatsby-code-text">1</code>，包裹进Box中，则我们可以调用<code class="gatsby-code-text">Box(1)</code>上面的<code class="gatsby-code-text">map</code>方法，我们可以仿照Box再创建一个容器<code class="gatsby-code-text">Sum</code>,来包裹数字,让<code class="gatsby-code-text">Sum(1)</code>拥有<code class="gatsby-code-text">concat</code>方法，看看Sum的实现：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Sum</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    x<span class="token punctuation">,</span>
    concat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">:</span> y <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Sum</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>inspect<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Sum(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>下面我们可以做个验证：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// => Sum(6)</span>
<span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// => Sum(6)</span></code></pre>
      </div>
<p>研究明白了加法的知识，不妨继续扩展一下小学数学知识：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx">a <span class="token operator">*</span> <span class="token punctuation">(</span>b <span class="token operator">*</span> c<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token punctuation">(</span>a <span class="token operator">*</span> b<span class="token punctuation">)</span> <span class="token operator">*</span>  c                   <span class="token comment">// 乘法</span>
<span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>       <span class="token comment">// 最大值</span>
<span class="token function">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>       <span class="token comment">// 最小值</span></code></pre>
      </div>
<p>相信根据<code class="gatsby-code-text">Sum</code>的案例，大家可以很轻松的写出很多类似的案例：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token comment">// 对任意的 bool 类型求 并(&amp;&amp;) 的结果</span>
<span class="token keyword">const</span> <span class="token function-variable function">All</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    x<span class="token punctuation">,</span>
    concat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">:</span> y <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">All</span><span class="token punctuation">(</span>x <span class="token operator">&amp;&amp;</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>inspect<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`All(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 对任意的自然数求 max(最大值) 的结果</span>
<span class="token keyword">const</span> <span class="token function-variable function">Max</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    x<span class="token punctuation">,</span>
    concat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">:</span> y <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Max</span><span class="token punctuation">(</span>x <span class="token operator">></span> y <span class="token operator">?</span> x <span class="token punctuation">:</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>inspect<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Max(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
      </div>
<blockquote>
<p><strong>Note:</strong>类似于<code class="gatsby-code-text">functor</code>为一个<code class="gatsby-code-text">mappable</code>的数据类型，也可以类比半群就是一个<code class="gatsby-code-text">concatible</code>的数据类型，这样更好理解</p>
</blockquote>
<blockquote>
<p>在 <a href="https://github.com/fantasyland/fantasy-land#semigroup">Fantasy Land Spec</a>中半群的结合方法也确实就叫concat)</p>
</blockquote>
<h3 id="加法是自然之道"><a href="#%E5%8A%A0%E6%B3%95%E6%98%AF%E8%87%AA%E7%84%B6%E4%B9%8B%E9%81%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>加法是自然之道</h3>
<p>让我们再次探索一下小学数学知识：我们已经不断的验证了加法满足结合律，那么减法呢？减法满足结合律吗？</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// => 2</span>
<span class="token number">5</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// => 4</span></code></pre>
      </div>
<p>这就是小学数学老师教的，做加法的时候，可以随意的添加和删除括号；而减法绝不能这样操作！</p>
<p><strong>为什么？因为减法不满足结合律！</strong></p>
<p>我们经常说道法自然，那么自然之道是什么？我认为自然是在做加法，老子道德经说“道生一，一生二，二生三，三生万物”；反映在数学上就是，假如我们创造一个数字<code class="gatsby-code-text">1</code>,然后有一个计算法则<code class="gatsby-code-text">+</code>,则我们可以很轻松很直觉的创造出所有的自然数！</p>
<p>我们平常写代码的时候，可能刚开始设计的很巧妙，思路很清晰；但是随着业务的迭代(<del>产品经理的频繁变换</del>),代码不可避免会变得很多很多；
贴一个经常吐槽Java(<del>假装很懂Java</del>)的一句话：Java的问题不是太啰嗦而是OOP使得类的数目很多。我想不管使用什么语言，代码量增多迟早会面对，而是要积极面对。面向对象原则和GOF设计模式已经在告诉我们如何维护拓展这些类代码：宁可增加新的类代码，尽量不要去修改那些经过测试已经成熟稳定的代码；也就是说不要去做修改替换，而是要做增加！这种增加如同树的自然成长，是一种干生枝，枝生叶的繁茂。</p>
<p>切换到FP的理念中，我们听了太多的<a href="">纯函数</a>,<a href="">不可变数据</a>，<a href="">避免共享状态</a>等等，细想一下不管是函数也好，数据也好，他们有一个共同点就是在原来的基础上添加(<code class="gatsby-code-text">append/concat</code>)而是修改原来的！</p>
<h3 id="幺元"><a href="#%E5%B9%BA%E5%85%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>幺元</h3>
<p>现在我们来看一个特殊的数字<strong>0</strong>，在加法中<code class="gatsby-code-text">0</code>是一个很特殊的存在，特殊在哪里呢？</p>
<ul>
<li>任何自然数和<code class="gatsby-code-text">0</code>相加都等于它本身：<code class="gatsby-code-text">1 + 0 = 1</code></li>
<li><code class="gatsby-code-text">0</code>可以添加到加法运算中的任意位置，而不影响计算结果：<code class="gatsby-code-text">1 + 2 + 3 = 0 + 1 + 2 + 3 = 1 + 2 + 0 + 3</code></li>
</ul>
<p>仔细思考一下，<code class="gatsby-code-text">0</code>存在的意义在哪里呢？实际上0是数学中对于自然世界中<code class="gatsby-code-text">空</code>的抽象。</p>
<p>在代码的世界中，<code class="gatsby-code-text">空</code>是一个很常见的定义，比如：空字符串<code class="gatsby-code-text">&#39;&#39;</code>,空数组<code class="gatsby-code-text">[]</code>,这些空值通常用来实现初始化的值，而这种’空值’(和任何元素结合都不会影响结果的单位元)在函数式编程中被称为<code class="gatsby-code-text">幺元(Identity Element)或者单位元</code>。用数组的例子来看就是：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span></code></pre>
      </div>
<blockquote>
<p>加号表示组合的意思，等号表示“值”相等。 </p>
</blockquote>
<p>结合半群<code class="gatsby-code-text">Sum</code>来看,很明显加法操作的幺元为<code class="gatsby-code-text">Sum(0)</code>：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx">Sum<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> res1 <span class="token operator">=</span> Sum<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// => Sum(3)</span>
<span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Sum<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// => Sum(3)</span></code></pre>
      </div>
<p>同样对于All的幺元则为：<code class="gatsby-code-text">All.empty = () =&gt; All(true)</code>,true和任何boolean值结合都不会影响原来的值。</p>
<p>除了<code class="gatsby-code-text">Sum(0)</code>,<code class="gatsby-code-text">All(true)</code>,我们可以在代码中找到很多其他的幺元的例子，比如：<code class="gatsby-code-text">&#39;&#39;</code>,<code class="gatsby-code-text">[]</code>,<code class="gatsby-code-text">{}</code>。</p>
<p>下面我们看一个稍微特殊一点的数字：无穷大(∞)。在加法中，我们不是找到了0作为幺元吗？无穷大看上去是空数字的反面，但是它也是一个单位元，但是如何描述无穷大是数字的空元素呢？答案是使用min操作,看下面伪代码：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-text"><code class="gatsby-code-text">min(∞, x) = x;  
min(x, ∞) = x;</code></pre>
      </div>
<p>对于求最小值的操作来说，在任何地方插入无穷大都不会影响计算结果，对吧！
同样的负无穷大就是max操作的幺元；数字1就是乘法运算的幺元。现在看来多个‘空对象’是可以同时存在的，只是在不同操作下对于空的定义不同罢了。</p>
<h4 id="单元函数"><a href="#%E5%8D%95%E5%85%83%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>单元函数</h4>
<p>函数式编程的核心在于函数组合，那么对于函数组合这个操作来说，它的幺元是什么呢？答案是一个很简单的单元函数(identity function):<code class="gatsby-code-text">x =&gt;x</code>,通常被简称为id。</p>
<p>单元函数是一个对函数输入没有做任何操作直接返回的函数(<code class="gatsby-code-text">id(1) === 1</code>,<code class="gatsby-code-text">id(x) === x</code>)，很明显这个函数和任意的函数进行组合，或者插入到函数组合的任意位置，都不影响函数组合的结果。</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>fns<span class="token punctuation">)</span> <span class="token operator">=></span> x <span class="token operator">=></span> fns<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>

<span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
<span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> x<span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
<span class="token function">compose</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> g<span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">)</span></code></pre>
      </div>
<p>通过这种组合方式，我们可以看到单元函数是函数组合操作的幺元</p>
<h3 id="广群，半群，幺半群"><a href="#%E5%B9%BF%E7%BE%A4%EF%BC%8C%E5%8D%8A%E7%BE%A4%EF%BC%8C%E5%B9%BA%E5%8D%8A%E7%BE%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>广群，半群，幺半群</h3>
<p>上面介绍了半群和幺元的概念，本质上来说是很简单的东西，平常代码中也会经常用到，只是没有特意的强化和准确的定义这个概念;下面继续介绍另一个简单的概念：广群</p>
<h4 id="广群"><a href="#%E5%B9%BF%E7%BE%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>广群</h4>
<p>对于某非空集合<code class="gatsby-code-text">S</code>，若存在<code class="gatsby-code-text">S</code>上的二元运算<code class="gatsby-code-text">&quot;*&quot;</code>使得对于任意的<code class="gatsby-code-text">a,b∈S</code>,有<code class="gatsby-code-text">a*b∈S</code>（运算封闭），则称<code class="gatsby-code-text">{S,*}</code>为广群(Group)。</p>
<p>广群只是定义一个集合，集合中有元素和操作，操作结果也属于这个集合，这样泛泛的集合称为广群。　</p>
<p>如果广群再加上结合律约束，就会得到半群，因此半群是广群的子集，要求更苛刻些，而半群可以找到一个合适的<code class="gatsby-code-text">幺元</code>（identity element），则可以把该半群称为幺半群，也就是<strong><code class="gatsby-code-text">结合律</code>+<code class="gatsby-code-text">幺元</code>=<code class="gatsby-code-text">幺半群</code></strong>，所以，Monid对应的中文是幺半群。</p>
<p>所以半群是广群的子集，而幺半群很明显是半群的子集。</p>
<h3 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>
<p>这一节介绍的概念比较多，但是在我们完全理解了Functor的基础上，理解半群(<code class="gatsby-code-text">concatible</code>),幺元(<code class="gatsby-code-text">id</code>),幺半群(半群 + 幺元)就是很简单的概念；一个<code class="gatsby-code-text">monoid</code>是一个元素(也可称对象)的集合，<code class="gatsby-code-text">monoid</code>首先是一个集合，但是这个集合有一些约束条件，也就是说，是一个特殊的集合，满足结合律和幺元，这种元和其他元素结合时，并不会改变那些元素。</p>
<p>下面的一章则会进入我们函数式编程进阶的核心内容了：<code class="gatsby-code-text">Monad</code>。我们使用一句经典名言，来做个引言：</p>
<blockquote>
<p>“A monad is just a monoid in the category of endofunctors. What’s the problem?”</p>
</blockquote>]]></description><link>https://reactjs.org/blog/2020/02/02/加法是自然之道.html</link><guid isPermaLink="false">https://reactjs.org/blog/2020/02/02/加法是自然之道.html</guid><pubDate>Sat, 01 Feb 2020 16:00:00 GMT</pubDate></item><item><title><![CDATA[动物庄园]]></title><description><![CDATA[<hr>
<p>几年过去了。寒来暑往，时光流逝，寿命不长的动物一生更如白驹过隙。已经到了没有谁还记得造反前是怎么回事的那样一个时代，除了紫苜蓿、本杰明、乌鸦摩西和几口猪。</p>
<p>母山羊慕莉尔死了；蓝铃铛、杰茜和钳爪都死了。琼斯也死了——他死在本郡另一头的酒鬼收容所里。雪球已被遗忘。拳击手也被遗忘了，除非少数认识他的动物才记得。紫苜蓿如今已是一匹发福的老母马，关节僵硬，眼睛动辄分泌黏液。她已超过退休年龄两岁，但实际上从来没有动物真正退休。给超龄动物留出草地一角之议，早就被束之高阁。拿破仑如今是一头重达三百三十磅的成熟公猪。吱嘎胖得几乎睁不开眼睛。唯独老本杰明大体上还是过去的模样，只是鼻口处的毛色稍增灰白，还有就是自打拳击手死后越发孤僻自闭，寡言少语。</p>
<p>如今农场里的动物增加了许多，尽管增长幅度并不像早些年头预期的那么大。对于后来出生的动物，造反仅仅是一个口口相传的模糊的传说，而另一些从别处购进的动物，在来到此地之前压根儿就没听谁提起过这么一档子事。现在农场除紫苜蓿外拥有三匹马。他们都是挺拔健壮的好牲口，勤劳肯干，和睦友好，只是蠢得要命。他们中没有一匹认得B以后的字母。他们全盘接受所听到的关于造反和动物主义原则的说法，尤其是出自紫苜蓿之口的，因为他们对紫苜蓿怀有近乎孝心的尊敬；不过，他们对于所听到的究竟能懂得多少，那可要存疑了。</p>
<p>现在的农场比往昔较为富裕，生产组织得也较好；它的面积有所扩大，增加了从皮尔金顿那儿购得的两块地。风车最终还是圆满建成了，农场拥有属于自己的一台脱粒机和一台捆草机，此外还新盖了各种不同的建筑物。温珀给自己购置了一辆双轮轻便马车。不过，风车到头来却并没有用于发电。它被用来碾磨谷物，收益颇丰。动物们正在努力建造另一座风车；据说等这第二座建成后将要安装发电机组。不过，当初雪球教动物们梦想过上的奢华生活——有电灯照明和冷热水齐全的厩舍，一周三天工作制——再也不谈了。拿破仑指责这种想法是与动物主义的精神背道而驰的。他说，真真正正的幸福就在于勤奋的工作和俭朴的生活。</p>
<p>不知怎么的，虽然农场比过去富了，可是动物们自己似乎并没有什么富裕起来的迹象——当然，猪和狗不在此例。也许，部分原因就在于有那么多的猪和那么多的狗。倒不是说这两种动物不劳动——这是他们的做派。问题在于，就像吱嘎从来不厌其烦地解释的那样，在农场的管理和组织方面有干不完的工作。这些工作中有许多属于其他动物过于无知而理解不了的。例如，吱嘎曾告诉他们，猪不得不每天耗费大量劳动在叫做“档案”、“报告”、“议事录”、“备忘录”的神秘事务上头。那都是大张大张的纸，必须在上面密密麻麻地写上字，一旦这些纸写满了字，就会放到炉子里烧掉。这对农场的福祉都是至关重要的，吱嘎说。但迄今为止，猪也罢，狗也罢，都还没有用他们自己的劳动生产过任何食物；而他们的数量却非常之多，他们的胃口又始终非常之好。</p>
<p>至于其他动物，据他们所知，他们的生活还一直是老样子。他们普遍吃不饱，睡干草，喝池塘水，干农活；冬天他们苦于寒冷，夏天受苍蝇骚扰。有时他们中年龄大些的，会去搜索他们模糊的记忆，试图就这样一个问题做出判断：在早先造反的日子里，那会儿琼斯被赶走还不太久，当时的日子是比现在好，还是比现在差。他们记不起来了。他们没有任何东西可以拿来同当前的生活做比较，因为他们没有任何参照的依据，除非以吱嘎的长长一大串一大串数字为准，而这些数字一贯表明任何事物都是越来越好，越来越好。动物们发现这个问题没法儿解决；他们现在没工夫思考这些事情。只有老本杰明表示自己漫长一生的每一个细节他都记得起来，也知道事情从来没有、也永远不会大大好于过去或大大不如过去——反正饥饿、辛苦和失望是生活的不变法则，他如是说。</p>
<p>然则动物们从不放弃希望。非但如此，他们从来不曾，哪怕只是短短的一瞬间也不曾丧失自己作为动物农物成员之一的荣誉感和优越感。他们至今仍是全郡——也是全英格兰！——唯一属动物们所有并由动物们运作的农场。他们中的任何一员，即便是最年轻的，即便是从十英里或二十英里以外买来的，无不始终对这一点感到惊讶。每当他们听到猎枪鸣响，看见绿旗在旗杆顶上迎风飘扬，他们心中总会充盈着不灭的自豪，于是话题必然转向往昔的英雄岁月，转向驱逐琼斯，书写《七诫》，以及入侵的人类被打得落荒而逃的那两次伟大战役。旧时的梦想一个也没有舍弃。老少校曾经预言的动物共和国，动物们仍坚信不疑，到那时英格兰的绿野将不容人类践踏。这个预言总有一天会实现，也许不会很快，也许目前活着的任何动物有生之年谁也盼不到，可那一天还是会到来。甚至《英格兰的生灵》的曲调也有动物在这里或那里偷偷哼唱，至少农场的每一只动物都知道这首歌总是一个事实，尽管谁也不敢大声唱。他们的一生也许过得很苦，他们的希望也许并没有完全实现，但他们意识到自己跟别的动物不一样。如果他们吃不饱，那并非由于必须养活对他们实施暴政的人类；如果他们工作很辛苦，至少他们是为自己工作。他们中没有谁是用两条腿行走的。没有哪只动物称任何别的动物“东家”。凡动物一律平等。</p>
<p>入夏不久的一天，吱嘎命令几只绵羊跟他走，并把他们带到农场另一头一块蔓生着许多桦树苗的荒地上。绵羊们在那儿呆了一整天，在吱嘎的监督下啮食嫩叶。傍晚，吱嘎独自回到宅子，但由于天气暖和，他吩咐绵羊们仍留在荒地上。结果他们在那儿一留就是整整一个星期，这段时期其他动物都不见他们的踪影。吱嘎每天的大部分时间都和绵羊待在一起。他说自己在教他们唱一首新歌，必须不受打扰。</p>
<p>直到绵羊们回去以后，一个惬意的傍晚，动物们已经收工，正在返回农场居住区的路上，这时从院子里传来一匹马受惊的嘶鸣，收工的动物们给吓得在原地站住，一动也不动。那是紫苜蓿的嘶叫声。她再次发出一声长啸，这一回所有的动物全都撒腿飞奔冲进院子。这时他们看到了紫苜蓿所看到的情景。</p>
<p>那是一头猪在用他的后腿行走。</p>
<p>没错，那是吱嘎。他正从院子的一头向另一头踱去，稍稍显得有点儿笨拙，仿佛还不太习惯按这样的姿势支撑自己硕大的身躯，但平衡保持得十分完美。仅仅过了片刻，从农场主宅子门内走出一长列猪，全都用他们的两条后腿行走。一些猪走得比另一些较好，有一两头甚至步态略显不稳，看样子他们最好能有一根拐棍作支持，但他们每一头都成功地绕院子走了一圈。临了是一片惊心动魄的狗叫和黑色小公鸡喔喔喔的尖声啼鸣，于是拿破仑亲自驾临，气宇轩昂，目光傲慢地从这一边扫向另一边，他的狗保镖们在他周围又蹦又跳。</p>
<p>他的前蹄夹着一条鞭子。</p>
<p>这时出现了一片死一般的寂静。</p>
<p>惊愕、恐惧的动物们互相挤做一团，瞧着猪们排成长列绕院子缓慢行进。这光景就像是世界给倒了过儿似的。当最初的震悚已经消逝，尽管他们仍然慑于狗们的淫威，尽管经年累月养成的习惯就是不管发生什么事情概不抱怨，概不批评，尽管这一切并没有改变，但现在已到了这样的时刻，动物们可以置以上的一切于不顾，说出一两句表示抗议的话了。但是，恰恰在这个当口儿，所有的绵羊像接到一个信号似的，一下子爆发出声势汹汹的咩咩大合唱——“四条腿好，两条腿更好！四条腿好，两条腿更好！四条腿好，两条腿更好！”</p>
<p>如是者共持续达五分钟之久，没有停顿。及至绵羊们完全静下来，表示任何抗议的机会已经成为过去，因为猪们的队伍回到宅内去了。</p>
<p>本杰明感到有一个鼻子挤压着他的肩膀。他转过头去一看。是紫苜蓿。她的老眼似乎比以往任何时候更加昏花。她什么也不说，只是轻轻拽住本杰明的鬃毛把他带到写着《七诫》的大谷仓尽头外墙跟前。他俩站住脚，盯着涂了柏油写上白字的那堵墙约莫有一两分钟。</p>
<p>“我的眼神越来越不济了，”紫苜蓿终于说。“即使在我年轻时我也念不了那上面写的什么。可是我总觉得那堵墙看上去跟以前不一样。这《七诫》还是往常的《七诫》吗，本杰明？”</p>
<p>本杰明只此一遭同意打破他自己的规矩，把写在墙上的字念给紫苜蓿听。如今墙上只有一条戒律，其余什么都没有。那唯一的一诫是：</p>
<p>“凡动物一律平等</p>
<p>但是有些动物比别的动物更加平等”</p>
<p>明乎此，第二天农场里的监工猪一个个都用蹄子夹着皮鞭就不足为怪了。之后，据悉猪们又给自己购置了无线电收音机，并准备安装电话，还订阅了《约翰牛》、《花边新闻》和《每日镜报》，当然也不足为怪。同样不足为怪的还有拿破仑被看见叼着一支烟斗在农场主宅内花园里散步——不，不，甚至还有猪们把琼斯先生衣柜里的服装取出来穿在自己身上；拿破仑自己公然身穿黑上衣、猎装裤，绑着皮裹腿招摇过市；而深得他宠爱的一头母猪身上则是过去琼斯太太星期日才穿的一袭波纹绸连衣裙。</p>
<p>一周后的下午，一溜儿好几辆双轮小马车来到农场。由附近几位农场主组成一个代表团应邀前来考察。来宾们被领到农场各处参观，他们对所看到的一切，特别对风车表示高度赞扬。动物们正在萝卜地里锄草。他们干得很勤勉，眼睛一直看着地上，几乎连头也不抬，不知道他们更害怕猪还是人。</p>
<p>那天晚上，从农场主宅内传来喧闹异常的欢笑声和唱歌声。忽然间，动物们被混杂在一起的各种声音激起了好奇之心。既然动物和人头一回平起平坐聚在一起，倒要瞅瞅究竟会发生什么事情？于是他们不约而同地尽可能放轻脚步开始向农场主宅子的花园里溜进去。</p>
<p>到门口他们停了下来，不太敢再往前走，但紫苜蓿带头走进去。他们踮着脚挨到宅子跟前，某些个子够高的动物通过餐厅的窗户朝里张望。那里，在一张长桌周围坐着六个农场主和六头地位较高的猪。拿破仑自己占着餐桌一端的荣誉席位。猪们坐在椅子上的姿态相当自在。宾主们原先在打牌散心来着，后来放下纸牌暂停片刻，显然为了举杯祝酒。一把大酒壶不断传来递去，带把儿的大杯子一再斟满啤酒。谁也没有注意到，动物们一张张神情讶异的脸正从窗外一眼不眨地往里凝视。</p>
<p>狐苑农场的皮尔金顿先生手执酒杯站起身来。他说，此刻他想请在座的诸位干上一杯。但在举杯之前，他觉得自己有义务先说几句话。</p>
<p>皮尔金顿先生说，能感到很长一个时期以来的不信任和误会现已告终，这对他来说是皆大欢喜的缘由——他相信对在座的其他各位来说亦然如此。曾经有一段时间——虽然他或在座的任何一位都不认同这种态度——但确实曾有一段时间，尊敬的动物农场几位业主遭到来自他们的人类邻居的……他不愿说敌视，但或许可以说是某种程度的猜疑。不幸的事件时有发生，错误的观念被普遍接受。当时觉得，一家由猪当业主和经营管理的农场的存在，总有些不太正常，会对周边邻居产生一种不安定的影响。为数极多的农场主未做调查研究便认定，这样的农场里主宰一切的必然是无法无天、恣意胡为的歪风邪气。这些农场主十分忧虑他们自己的动物乃至他们的人类雇员会受到影响。但所有这一切疑虑如今均已消除。今天他和他的几位朋友一起来动物农场参观访问，亲眼考察了这里的每一寸土地，他们发现了什么呢？不光操作规程是最现代的，而且工作纪律严明，到处井然有序，这些对于任何地方的农场主都堪为楷模。动物农场的低等动物比郡内任何动物干的活更多，而消耗的饲料却更少——他相信自己这样说没错。确实，他和他的同行参观者们今天看到的很多东西，他们打算马上引进到自己的农场里去。</p>
<p>他说，在发表自己这番感想的末尾，他要再一次强调，过去存在于动物农场与它邻居之间的友好感情应该继续留存下去。猪与人之间过去没有，也没有必要产生任何利害冲突。他们努力奋斗的目标和面临的困难是相同的。劳工问题在任何地方不都是一样的吗？说到这里，皮尔金顿先生显然有意向大家抛出一句精心准备好的俏皮话，然而有一瞬间他自己越想越觉得可笑，以致话也说不出来。他呛了好一阵子，在这期间他那呈多级台阶状的下巴转成了紫色，呛过以后，他总算说出了口：“你们有你们的低等动物需要对付，”他说，“我们有我们的下层阶级需要摆平！”这句妙语一出，举座为之笑得前俯后仰；于是皮尔金顿先生就他在动物农场观察到的食品定量低、工作时间长以及绝无纪律松弛现象再一次向猪们表示祝贺。</p>
<p>皮尔金顿先生最后请在座各位全体起立，先把各自的酒杯斟满。“先生们，”皮尔金顿说，“先生们，我建议大家一起举杯：祝动物农场财运亨通！”</p>
<p>这时响起一片兴高采烈的欢呼声和跺足声。拿破仑心里简直乐开了花，竟然离开自己的席位，绕到桌子另一端去跟皮尔金顿先生先碰过杯，然后再一饮而尽。这一轮的祝酒和欢呼平静下来后，依然用两条后腿站着的拿破仑表示他也有几句话要说。</p>
<p>和拿破仑所有的发言一样，这次讲话也很短，而且直奔主题。他说，他对于误会误解的时期终于结束也感到很高兴。在一个长时期内有流言在传播——他有理由认为是敌人恶意散播的——说他自己以及他的同事们的观点含有某种颠覆性，甚至革命性的内容。外界认为他们图谋煽动附近几家农场的动物起来造反。没有比这种谣言离事实真相更远的了！拿破仑和他的同事们的唯一愿望，现在和过去都是同他们的邻居和睦共处，保持正常的商务关系。他补充说，他有幸负责监管的这个农场，是一个合作社性质的企业。由他亲自保管的产权证书属于猪们共有。</p>
<p>他说他不信旧的猜疑还会残存下来，但前不久农场在规章制度方面还是做了若干变更，这些举措应该会收到进一步推动互信的效果。到目前为止，农场的动物们有一个颇为愚蠢的惯例，就是互相称呼“同志”。这个称呼必须禁止使用。另外还有一条非常奇怪的旧规，其起因已无从查考，那就是每星期日早晨必须列队走过钉在花园内木柱上的一个公猪头颅。这一陋规也将取消，那个骷髅头已经被掩埋。来宾们可能已经看到有一面绿色旗帜飘扬在旗杆顶上。如果看到了，他们或许会留意原先标在旗帜上面的白色蹄角现在已被撤去。今后它将是一面素色的绿旗。</p>
<p>他说，对于皮尔金顿先生刚才那一席洋溢着睦邻友情的精彩讲话，他只有一点批评意见。皮尔金顿先生始终称本农场为“动物农场”。皮尔金顿先生当然不可能知道——因为他，拿破仑，现在才第一次正式宣布此事：“动物农场”这个名称已经废除。今后农场将被称为“庄园农场”——他相信这才是农场正确的原名。</p>
<p>“先生们，”拿破仑如此结束他的发言，“我也要像刚才那样建议大家一齐举杯，但要换一种方式。请把你们的酒杯斟满。先生们，我的祝酒词是：祝庄园农场财运亨通！”</p>
<p>又是和先前同样尽兴尽情的欢呼，酒杯里全都点滴不剩。但是，就在动物们从窗外注视着这幅景象时，他们觉得好像有什么事情快要发生了。猪们的脸上究竟什么起了变化？紫苜蓿的老眼把昏花的视线从一张脸移到另一张脸。其中一张有五个下巴颏儿，一张有四个，一张有三个。但究竟是什么似乎在漫漶和变化？这时，掌声停息，宾主拿起纸牌继续玩刚才被打断的牌戏，窗外的动物们悄无声息地离开那儿。</p>
<p>但是他们走开还没有超过二十码距离，又骤然站住。好多条嗓子大吵大嚷的喧哗声从农场主宅内传来。动物们赶回去重又朝窗内张望。没错儿，一场激烈的争吵正在进行中。那里边有破口大骂的，有拍桌子的，有犀利的目光怀疑对方作弊的，有气急败坏矢口否认的。翻脸的缘起好像是拿破仑和皮尔金顿先生同时都打出一张黑桃A。</p>
<p>十二条嗓门暴跳如雷地吼叫，声音全都一个样。这下弄明白了，猪们的脸究竟出了什么问题。敢情动物们从窗外朝里望，目光从猪移到人，再从人移到猪，又重新从猪移到人，要分清哪张脸是猪的，哪张脸是人的，已经不可能了。    </p>
<p>— 乔治·奥威尔</p>]]></description><link>https://reactjs.org/blog/2020/02/01/动物庄园.html</link><guid isPermaLink="false">https://reactjs.org/blog/2020/02/01/动物庄园.html</guid><pubDate>Fri, 31 Jan 2020 16:00:00 GMT</pubDate></item><item><title><![CDATA[薛定谔的 Maybe - IO]]></title><description><![CDATA[<h3 id="副作用"><a href="#%E5%89%AF%E4%BD%9C%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>副作用</h3>
<p>程序的可观察，而不是操作了一番然后睡觉去了</p>
<p>上篇文章中引入范畴学中<code class="gatsby-code-text">Functor</code>的概念，核心内容就是把一个值放入到一个<code class="gatsby-code-text">Box</code>中，然后不停的通过<code class="gatsby-code-text">map</code>函数来映射变换其中的值，而这就是一个最简单的<code class="gatsby-code-text">Identity Functor</code>,但是管他呢，我们还是叫它Box吧(多么简单形象)！</p>
<p>然后还举了个Either的例子，来说明Box理念在代码中实际用途，接下来介绍另外两个常用的<code class="gatsby-code-text">Box</code>:<strong><code class="gatsby-code-text">Maybe</code></strong>,<strong><code class="gatsby-code-text">IO</code></strong></p>
<h3 id="schrödingers-maybe"><a href="#schr%C3%B6dingers-maybe" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Schrödinger’s Maybe</h3>
<p><img src="./imgs/cat.jpeg" alt="薛定谔的猫"></p>
<blockquote>
<p>I call it my billion-dollar mistake. It was the invention of the null reference in 1965. — Tony Hoare</p>
</blockquote>
<p>在项目开发中无时不刻不在遇到<code class="gatsby-code-text">null</code>的问题,举个实际的例子，最近在做一个换肤的功能，需要根据用户的选择来动态的加载CSS主题样式，需要编写一个<code class="gatsby-code-text">getThemeForUser</code>函数，根据用户的之前的选择，从URL列表中中返回合适的URL，看个简单的代码描述：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">'hzxxxx'</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">'zhangsan'</span><span class="token punctuation">,</span>
  infos<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    theme<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">THEME_CSS_URLS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token string">'https://xxx.com/theme-default.css'</span><span class="token punctuation">,</span>
  <span class="token string">'red'</span><span class="token punctuation">:</span> <span class="token string">'https://xxx.com/theme-red.css'</span><span class="token punctuation">,</span>
  <span class="token string">'dark'</span><span class="token punctuation">:</span> <span class="token string">'https://xxx.com/theme-dark.css'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getThemeForUser</span> <span class="token operator">=</span> user <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>在编写<code class="gatsby-code-text">getThemeForUser</code>函数之前，我们先考虑一下问题：</p>
<ul>
<li>用户可能根本没有选择主题，而是使用的默认主题，<code class="gatsby-code-text">infos</code>对象中<code class="gatsby-code-text">theme</code>的value可能为null/undefined</li>
<li>user本身也可能为null，用户还没有登陆</li>
<li>数据异常，给出的主题色，可能不在<code class="gatsby-code-text">THEME_CSS_URLS</code>中   </li>
</ul>
<p>那么现在我们不得不处理很多个null/undefined,我们尝试编写第一个版本的<code class="gatsby-code-text">getThemeForUser</code>函数：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">getThemeForUser</span> <span class="token operator">=</span> user <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 没有登录进来</span>
    <span class="token keyword">return</span> <span class="token constant">THEME_CSS_URLS</span><span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 返回默认主题</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>infos<span class="token punctuation">.</span>theme <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>infos<span class="token punctuation">.</span>theme <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">THEME_CSS_URLS</span><span class="token punctuation">[</span>user<span class="token punctuation">.</span>infos<span class="token punctuation">.</span>theme<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">// 如果存在主题</span>
      <span class="token keyword">return</span> <span class="token constant">THEME_CSS_URLS</span><span class="token punctuation">[</span>user<span class="token punctuation">.</span>infos<span class="token punctuation">.</span>theme<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token constant">THEME_CSS_URLS</span><span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token constant">THEME_CSS_URLS</span><span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getThemeForUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => 'https://xxx.com/theme-red.css'</span></code></pre>
      </div>
<blockquote>
<p>类似这样的代码在前端项目中，随处可见；有人认为很多的if判断增强了JavaScript代码的健壮性，但是反过来说，也可以认为这是一段简单的代码，打上各种补丁之后，终于可以正常运转了(我不认为这是让代码更健壮的方案，反而更像是一段温室中的代码)</p>
</blockquote>
<p>再举一个更普遍的例子：很多时候服务端接口文档，明确写了返回值为<code class="gatsby-code-text">Array</code>类型，但是没有值的时候，会直接给一个<code class="gatsby-code-text">null</code>而不是一个<code class="gatsby-code-text">empty Array</code>，这个时候客户端如果不做校验，直接作为<code class="gatsby-code-text">Array</code>类型来处理，<code class="gatsby-code-text">Uncaught TypeError</code>的错误是不可避免的；或者某个嵌套的JSON结构中，不知道哪一层就会出现<code class="gatsby-code-text">null</code>，我们总不能一直作出这样的判断吧<code class="gatsby-code-text">if(response &amp;&amp; response.a &amp;&amp; response.a.b ...)</code>!</p>
<p>为此经常这段代码简直就是<strong>薛定谔的猫</strong>，根据数据库数据的不同返回的结构完全不可预知，客户端只有在拿到数据的那一刻，才能确定下来！</p>
<p>现在我们面临的问题就是我们无法提前预知到底什么时候会出现<code class="gatsby-code-text">null/undefined</code>，如果出现的情况下，我们又该如何优雅而准确的处理<code class="gatsby-code-text">null/undefined</code>的问题！</p>
<p>为此薛定谔的Maybe出场的时候到了，来看一看另一个Box：<strong>Maybe</strong></p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Just</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  map<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Just</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  fold<span class="token punctuation">:</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  getOrElse<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">,</span>
  inspect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Maybe.Just(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Nothing</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  map<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Nothing</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  fold<span class="token punctuation">:</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  getOrElse<span class="token punctuation">:</span> v <span class="token operator">=></span> v<span class="token punctuation">,</span>
  inspect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Maybe.Nothing`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Maybe</span> <span class="token operator">=</span> x <span class="token operator">=></span>
  x <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">Just</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">Nothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>Maybe的实现会把类型分为两类，一类是非空值，另一类是空值，所以经常会看到<code class="gatsby-code-text">Some(x)/None</code>或者<code class="gatsby-code-text">Just(x)/Nothing</code>这样的实现。</p>
<blockquote>
<p>Java8 和 scale中分别成为<code class="gatsby-code-text">Optional</code>和<code class="gatsby-code-text">Option</code>,他们将Just和Nothing称为Some和None,本质上并没有什么区别</p>
</blockquote>
<p>一般来说Maybe会提供一个<code class="gatsby-code-text">getOrElse</code>函数，用来做出获取到值(Just)则给出正确的值，如果没有取到则提供一个默认值,Nothing会把传进来的otherValue作为回退方案。</p>
<p>下面看一下Maybe的基本用法：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token constant">R</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ramda'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> match <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span>match<span class="token punctuation">;</span>

<span class="token function">Maybe</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/o/ig</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// => Maybe.Just(o,o)</span>
<span class="token function">Maybe</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/a/ig</span><span class="token punctuation">)</span>  <span class="token comment">// => Maybe.Nothing</span></code></pre>
      </div>
<blockquote>
<p>这里引入了<a href="https://github.com/ramda/ramda">Ramda.js</a>,提供了很多函数式风格的封装，避免了我们重复造轮子，但是他们一般不会提供函数式编程的核心的数学概念，比如：<code class="gatsby-code-text">Monad、functor、Foldable</code></p>
<p>实现了<a href="https://github.com/fantasyland/fantasy-land"><code class="gatsby-code-text">Fantasy-Land</code></a>规范的库,比如<a href="https://github.com/ramda/ramda-fantasy"><code class="gatsby-code-text">ramda-fantasy</code></a>,<a href="https://github.com/origamitower/folktale"><code class="gatsby-code-text">folktale</code></a>等,他们的实现比较工程化和严谨(适合正式的项目中引入)，但这里为了方便理解，我们选择继续扩展我们的<strong>Box</strong>,而不会引入这些类库</p>
</blockquote>
<p>现在尝试用<code class="gatsby-code-text">Maybe</code>来重写一下<code class="gatsby-code-text">getThemeForUser</code>函数：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token constant">R</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ramda'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span>path
<span class="token keyword">const</span> curry <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span>curry

<span class="token keyword">const</span> <span class="token function-variable function">getThemeForUser</span> <span class="token operator">=</span> user <span class="token operator">=></span>
  <span class="token function">Maybe</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'infos'</span><span class="token punctuation">,</span> <span class="token string">'theme'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span>maybeGetTheme<span class="token punctuation">,</span> maybeGetTheme<span class="token punctuation">)</span>


<span class="token keyword">const</span> maybeGetTheme <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>urls<span class="token punctuation">,</span> themeName<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Maybe</span><span class="token punctuation">(</span>urls<span class="token punctuation">[</span>themeName<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">THEME_CSS_URLS</span><span class="token punctuation">)</span>


<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getThemeForUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrElse</span><span class="token punctuation">(</span><span class="token constant">THEME_CSS_URLS</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => https://xxx.com/theme-red.css</span></code></pre>
      </div>
<blockquote>
<p><code class="gatsby-code-text">getThemeForUser</code>函数中最后为何使用<code class="gatsby-code-text">fold</code>而不是<code class="gatsby-code-text">map</code>呢？这是因为<code class="gatsby-code-text">maybeGetTheme</code>函数的入参是<code class="gatsby-code-text">themeName</code>,而<code class="gatsby-code-text">getThemeForUser</code>函数的返回值是<code class="gatsby-code-text">Maybe(themeName)</code>；</p>
<p>关于<code class="gatsby-code-text">fold</code>的两个一样的参数，在没有引入<code class="gatsby-code-text">chain</code>函数之前，我们暂时继续使用<code class="gatsby-code-text">flod</code>函数把<code class="gatsby-code-text">themeName</code>从<code class="gatsby-code-text">Maybe(themeName)</code>中释放出来,后面会和嵌套的<code class="gatsby-code-text">tryCatch</code>问题一起给出解决方案，现在先暂时放下这个问题</p>
<p>使用柯里化的<code class="gatsby-code-text">maybeGetTheme</code>函数，避免访问全局变量，并再次使用<code class="gatsby-code-text">Maybe</code>包装可能为空的数据，最后使用<code class="gatsby-code-text">getOrElse</code>取出Maybe中的值</p>
</blockquote>
<p>Maybe和Either中的<code class="gatsby-code-text">fromNullable</code>看上去非常类似，至少从代码上来看是这样的，但是现在必须要说明一点的是：Either更过的时候会被用来处理逻辑分支以及异常恢复，而Maybe则用来处理空值检查比较多，在使用理念上不同。</p>
<p>一个常见的用法是<code class="gatsby-code-text">xxx.getOrElse(throw new Error(&#39;Fail&#39;))</code>将结果是一个Nothing的Maybe转回一个异常，一般的经验法则则是在没有合理的方案能捕获异常时将其抛出；如果异常是一种可恢复的错误，使用Either会更加灵活</p>
<p>引入<code class="gatsby-code-text">Maybe</code>可能会造成一些不适，熟悉Scala的用户应该知道<code class="gatsby-code-text">Option</code>，或者Java中的<code class="gatsby-code-text">Optional</code>,是完全类似的概念；Scale中被迫在任何情况下都进行空值检查，的确让人头疼不已。随着时间的推移，空值检查会成为第二本能，说不定你还会感激它提供的安全性呢。不管怎么说，空值检查大多数时候都能防止在代码逻辑上偷工减料，让我们脱离危险。</p>
<h3 id="甩锅侠io"><a href="#%E7%94%A9%E9%94%85%E4%BE%A0io" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>甩锅侠IO</h3>
<h4 id="保持纯与副作用"><a href="#%E4%BF%9D%E6%8C%81%E7%BA%AF%E4%B8%8E%E5%89%AF%E4%BD%9C%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>保持纯与副作用</h4>
<p>我们知道函数式编程的理念中，函数要保持“纯”的概念，即不能修改外部的变量，仅仅依赖于函数入参；也不能产生任何与以上可观察的副作用或输出，比如典型的读写操作。从代码编写者的角度来看，如果一段程序运行之后没有可观察到的作用，那他到底运行了没有？或者运行之后有没有实现代码的目的？有可能它只是浪费了几个CPU周期之后就去睡大觉了！！！</p>
<p>从JavaScript语言的诞生之初就不可避免地需要能够不断变化的，共享的，有状态的DOM互相作用；如果无法输入输出任何数据，那么数据库有什么用处呢？如果无法从网络请求信息，我们的页面又该如何展示？没有<code class="gatsby-code-text">side effect</code>我们几乎寸步难行。上述的任何一个操作，都会产生副作用，违反引用透明性，我们似乎陷入了两难的境地！</p>
<blockquote>
<p>世間安得雙全法，不負如來不負卿</p>
</blockquote>
<p><strong>如何在<code class="gatsby-code-text">keep pure</code>的前提下，又能妥善的处理<code class="gatsby-code-text">side effect</code>呢？</strong></p>
<p>答案是用数学的思维：<strong>作弊</strong>！</p>
<ul>
<li><strong>Dependency injection(依赖注入)</strong>：把函数中不纯的部分，踢出去，作为参数传递进来</li>
<li><strong>IO Functor/</strong>:把产生<code class="gatsby-code-text">side effect</code>的部分包裹起来,带着这个保护壳参与运算，直到需要结果时再打开运行</li>
</ul>
<h4 id="dependency-injection"><a href="#dependency-injection" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependency injection</h4>
<p>依赖注入式我们处理副作用的第一种方法，我们把代码中任何不纯的部分从函数中剔除，然后我们将他们作为传递进来，看一段代码：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">logSomething</span> <span class="token operator">=</span> something <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>something<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> something<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p><code class="gatsby-code-text">logSomething</code>函数有两个不纯的因素：首先创建了一个动态的Date,然后记录到console！因此不仅执行了IO,而且每一次执行的结果也都不一样。那么如何将这个函数变得pure呢？通过依赖注入我们可以把不纯的部分作为参数，所以现在函数应该被修改为接受三个参数的函数：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">logSomething</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> cnsl<span class="token punctuation">,</span> something<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dt <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> cnsl<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>something<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>如此这般logSomething函数就可以做到相同的输入，对应相同的输出了：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> something <span class="token operator">=</span> <span class="token string">"idiot !"</span>
<span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">logSomething</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> console<span class="token punctuation">,</span> something<span class="token punctuation">)</span></code></pre>
      </div>
<p>看到这里，你可能会想，这简直蠢爆了！就像在假装无知的说：“我不知道调用cnsl对象上的log会执行IO,只是其他人把它传给了我！”</p>
<p>尽管如此，它并不是一个单纯的傻瓜，至少这种思想可以延伸出来一个思路： </p>
<ul>
<li><strong>把不纯的部分剥离出来,让不纯的代码远离核心的logSomething函数</strong></li>
<li><strong>缩小了不确定性的范围，目前看起来只有log函数不纯</strong></li>
<li><strong>副作用集中管理，如果反复的缩小不确定的范围，我们甚至可以把不纯的代码推到代码的边缘，保证核心的pure和referential transparency</strong></li>
</ul>
<p>缺点在于：</p>
<ul>
<li>会导致方法签名过长，logSomething从一个参数变成了三个参数</li>
<li>传参的链路过长，可能导致多个函数在传递一长串的参数</li>
</ul>
<h4 id="io-functor"><a href="#io-functor" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IO Functor</h4>
<p>现在我们来看看另外一种解决思路：IO Functor。在开始之前，我们先回顾一下JavaScript中的函数：由于函数的一等性和高阶性，JavaScript函数具有<strong>值的行为</strong>，也就是说，函数就是一个基于输入的切尚未求值的不可变的值，或者可以认为一个函数本身就是一个等待计算的惰性的值。</p>
<p>回想一下，我们前面一篇中说的，Box理念，既然函数只是<strong>惰性的值</strong>，我们何不把函数也包裹进Box中，等到需要的时候，在取出来！看代码：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">LazyBox</span> <span class="token operator">=</span> g <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
	map<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">LazyBox</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	fold<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
      </div>
<blockquote>
<p><code class="gatsby-code-text">map: f =&gt; LazyBox(() =&gt; f(g()))</code>，也可以使用<code class="gatsby-code-text">const compose = (...fns) =&gt; (...args) =&gt; fns.reduceRight((res, fn) =&gt; [fn.call(null, ...res)], args)[0]</code>和<code class="gatsby-code-text">map: f =&gt; LazyBox(compose(f, g))</code>的结合，并且更为合理;但是此处为了保持便于理解和代码简洁，没有采用</p>
</blockquote>
<p>注意观察，我们没有调用fold函数，解封其中的值之前,map函数所做的一直都是在组合函数，函数并没有被实际的调用:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">nextChartFromNumberString</span> <span class="token operator">=</span> str <span class="token operator">=></span>
	<span class="token function">LazyBox</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> str<span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hahaha'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>r <span class="token operator">=></span> <span class="token function">parseInt</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">=></span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">=></span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">nextChartFromNumberString</span><span class="token punctuation">(</span><span class="token string">' 64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment">// => { map: [Function: map], fold: [Function: fold] },</span>
<span class="token comment">// 而并没有打印出'hahaha' </span></code></pre>
      </div>
<blockquote>
<p>这一特性有点类似递归，在未满足终止条件之前(没用调用fold之前)，递归调用会在栈中不断的堆叠，直到满足终止条件(调用fold函数)，才真正的开始计算</p>
<p>同样类似与递归，可能会出现Maximum call stack size exceeded的错误</p>
<p>IO也和Rxjs中的<code class="gatsby-code-text">Observable</code>有很多相似之处，两者都是惰性的，在调用<code class="gatsby-code-text">subscribe</code>之前<code class="gatsby-code-text">Observable</code>也不会执行，在调用subscribe之后</p>
</blockquote>
<p>再看一个读取文件的例子：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">readFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span>filename<span class="token punctuation">,</span> enc<span class="token punctuation">)</span> <span class="token operator">=></span>
	fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> enc<span class="token punctuation">)</span>


<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">LazyBox</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'config.json'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>str <span class="token operator">=></span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/8/g</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>  <span class="token comment">// => {"post":6666}</span></code></pre>
      </div>
<p>在没有调用fold函数之前，我们的代码都是纯的；flod函数就像打开潘多拉魔盒的双手；通过LazyBox我们把可能会弄脏双手的代码扔给了最后的fold，甩锅成功！</p>
<p>可以看到，我们这里使用的是同步的读取文件的例子，现在我们解决了<code class="gatsby-code-text">side effect</code>的问题，但是异步呢？异步该如何解决呢？不要着急，等我们介绍完了monad之后，会给出解决方案</p>
<blockquote>
<p>看到这里，是不是想起来了React中的useEffect</p>
<p>诚然，副作用依然存在，并没有消除，但是可以通过类似的方式，让大部分的代码保持纯的特性，享受纯函数带来的引用透明的好处</p>
</blockquote>
<h3 id="关于functor的定律"><a href="#%E5%85%B3%E4%BA%8Efunctor%E7%9A%84%E5%AE%9A%E5%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于Functor的定律</h3>
<ul>
<li>
<p>必须是无副作用的。若映射<code class="gatsby-code-text">identity</code>(<code class="gatsby-code-text">x =&gt; x</code>)函数可以获取上下文中相同的值，既可以证明Functor是无副作用的。
<code class="gatsby-code-text">Box(&#39;hello world&#39;).map(identity) // =&gt; Box(hello world)</code></p>
</li>
<li>
<p>必须是可组合的。这个属性的意思是多个map函数的组合，与分别map函数的结果是一样的</p>
</li>
</ul>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token constant">R</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ramda'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> reverse <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span>reverse
<span class="token keyword">const</span> toUpper <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span>toUpper
<span class="token keyword">const</span> compose <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span>compose

<span class="token function">Box</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>reverse<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>toUpper<span class="token punctuation">)</span>  <span class="token comment">// => Box(DLROW OLLEH)</span>

<span class="token function">Box</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>toUpper<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
      </div>
<h3 id="summary"><a href="#summary" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h3>
<p>关于Functor的介绍暂时告一段落，我们已经介绍了几个常用的Functor:<code class="gatsby-code-text">Either</code>、<code class="gatsby-code-text">Maybe</code>、<code class="gatsby-code-text">IO</code>等等，但是其实根据应用场景的不同，我们可以创造出无数个Functor，比如：<code class="gatsby-code-text">tree</code>、<code class="gatsby-code-text">list</code>、<code class="gatsby-code-text">map</code>等等；</p>
<p>并且介绍了如果在保持pure的同时，处理side effect的两个方案：<code class="gatsby-code-text">Dependency injection</code>与<code class="gatsby-code-text">Lazy Function</code></p>
<p>同时记住我们抛出的几个尚未解决的问题？</p>
<ul>
<li>如何解决嵌套的try-catch</li>
<li>异步函数的组合</li>
<li>chain函数又是什么</li>
</ul>
<p>下面几节，将会解决这几个问题！</p>]]></description><link>https://reactjs.org/blog/2020/01/30/薛定谔的Maybe.html</link><guid isPermaLink="false">https://reactjs.org/blog/2020/01/30/薛定谔的Maybe.html</guid><pubDate>Wed, 29 Jan 2020 16:00:00 GMT</pubDate></item><item><title><![CDATA[Abort-Controller]]></title><description><![CDATA[<h3 id="应用场景"><a href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用场景</h3>
<p>现在前端主流的技术方案都是<a href="https://www.freecodecamp.org/news/what-exactly-is-client-side-rendering-and-hows-it-different-from-server-side-rendering-bd5c786b340d/">服务端渲染</a>，那就面临着一个问题，Node.js需要承担接口转发的任务，所以原来的<a href="https://www.freecodecamp.org/news/what-exactly-is-client-side-rendering-and-hows-it-different-from-server-side-rendering-bd5c786b340d/">客户端渲染</a>的<code class="gatsby-code-text">http</code>请求的路线(brower -> server),需要调整为(Node.js -> server);看上去没有什么本质的区别，无非是原来是又浏览器发起请求，现在改为Node.js发起请求。</p>
<p>但是高并发呢？举个例子，假如有1000000个请求，原来从browser请求到server,server端如果没有做限流处理，那么部分请求就会一直处于<code class="gatsby-code-text">pendding</code>状态；但是1000000个<code class="gatsby-code-text">pendding</code>是分布在每个客户端上的，所以并没有什么压力；但是如果是Node.js发起的请求，则会出现很大一部分请求在Node.js端处于<code class="gatsby-code-text">pendding</code>状态，则会导致Node.js的CPU和内存占用压力剧增。</p>
<h3 id="promise-timeout方案"><a href="#promise-timeout%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise timeout方案</h3>
<p>前端<code class="gatsby-code-text">http</code>请求的代码一般会添加一个<code class="gatsby-code-text">timeout</code>的时间限制，配合<code class="gatsby-code-text">Promise.race</code>大概的代码思路是：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ms <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span>
                msg<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">` 调用接口超时: ></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ms<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms`</span></span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> option<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
        res <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        err <span class="token operator">=></span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求失败'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                msg<span class="token punctuation">:</span> <span class="token string">'加载失败'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span></code></pre>
      </div>
<p>上面的代码很简单，借助<code class="gatsby-code-text">Promise.race</code>,如果期望的fetch请求在2000ms内没有返回，则timeout中的<code class="gatsby-code-text">promise</code>会进入<code class="gatsby-code-text">rejected</code>状态，导致整个promise reject,相当于正常的fetch请求我们不会继续处理，直接抛弃了。</p>
<p>但是事实如此吗？这个被我们抛弃的Promise实际上依然处于<code class="gatsby-code-text">pendding</code>状态，直到http请求结束，promise进入<code class="gatsby-code-text">resolve or reject</code>状态，下图可见，错误日志已经打印出来了，但是http依然处于<code class="gatsby-code-text">pendding</code>的状态；可见<code class="gatsby-code-text">Promise.race</code>并不能真正的”抛弃请求”。内存占用，cpu占用依然存在。</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/promise-timeout-d1eeb13b949a765178b35954fc0ef954-ce390.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 840px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 54.706533776301214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABmklEQVQoz41SDW/rIAzk///FblnXrfmChHwHSMrtTKqqm57eZunEAbYx9qlhHLCsK7ZtwzzPqI1GXhUJb5czKlMnFHUJ3RhorVHXNZqmSf7jOGKapseq3L4hxB1innyJIYFPwGEn91y3tF/jlvxu+40FHDFiURBj4kpfrxj42tRZosPS92nfliUsKxFuigImzzG2LTr+wGpWWJWJG/rNfZdiR2uhen5lMAZ+Gh9Yhx4jvze2DVY6d0xQXz8x2RZeWsSzmXzivaNvmCfyFiuTKnyzeOBe/j/t+e6Je+exsw0q/i/4F7sxNj4ShiOh9x5BEAKcc7wguBfunrnnwBgkcD4gUBmB56KOfd+xLtzzXFVVjctnjrKqUEjz2c+W/ZBVpNGQy1oZi0If0I1NA7M87znEfhgwUDYSp7LzO07ZBTmTaTqZIkfxcYFno7d1wbbMCXN3DGEduoSFwxDMVIcMTSbelAXU+fSC7OWE7C1LohUJyBSjd2yMv4M8+O/wxyp+jpMXZUgBqi9f8XF+5ZfrpHTpCe5C/Qt+KuILm49S9LYMov8AAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="promise-timeout"
        title=""
        src="/static/promise-timeout-d1eeb13b949a765178b35954fc0ef954-a6b71.jpg"
        srcset="/static/promise-timeout-d1eeb13b949a765178b35954fc0ef954-1839a.jpg 210w,
/static/promise-timeout-d1eeb13b949a765178b35954fc0ef954-6c621.jpg 420w,
/static/promise-timeout-d1eeb13b949a765178b35954fc0ef954-a6b71.jpg 840w,
/static/promise-timeout-d1eeb13b949a765178b35954fc0ef954-ce390.jpg 903w"
        sizes="(max-width: 840px) 100vw, 840px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>上面的例子是发生在browser,问题不大，因为通常一个页面请求不会超过10个，对于单个用户机器来说，性能完全没有什么问题。</p>
<p><strong>但是如果上述事件是发生在Node.js请求server的过程中呢？大量的请求堆积在Node.js端，导致机器cpu或者内存占满，别忘了我们是服务端渲染，这个时候，用户打开页面将会异常缓慢(肯本没有机会继续处理页面渲染了)，或者长时间的等待之后502</strong>。</p>
<blockquote>
<p>上面的例子是在云音乐项目中实际案例。</p>
</blockquote>
<p>所以我们需要找到另外一种解决方案(能真正取消fetch请求的方案)，此时<code class="gatsby-code-text">[AbortController](https://developer.mozilla.org/en-US/docs/Web/API/AbortController)</code>映入眼帘。</p>
<h3 id="abortcontroller使用方法"><a href="#abortcontroller%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AbortController使用方法</h3>
<p>使用方法很简单，直接看文档。
<a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController">MDN文档</a><br>
<a href="https://developers.google.com/web/updates/2017/09/abortable-fetch">Google Developers: abortable-fetch</a></p>
<p>现在我们已经确定<code class="gatsby-code-text">AbortController</code>可以真正的取消请求，但是对性能的影响呢？下面我们做个实验：</p>
<h3 id="使用abortcontroller取消-nodejs---java-server的请求"><a href="#%E4%BD%BF%E7%94%A8abortcontroller%E5%8F%96%E6%B6%88-nodejs---java-server%E7%9A%84%E8%AF%B7%E6%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用AbortController取消 Node.js -> java server的请求</h3>
<h4 id="测试代码："><a href="#%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81%EF%BC%9A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>测试代码：</h4>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> fetch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-fetch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> AbortController <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'abort-controller'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> signal <span class="token operator">=</span> controller<span class="token punctuation">.</span>signal<span class="token punctuation">;</span>
    Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">fetchInterface</span><span class="token punctuation">(</span>signal<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">timeout</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log('请求成功')</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> err <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">//console.log('请求失败')</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">timeout</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ms <span class="token operator">=</span> <span class="token number">2000</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">// 是否取消请求</span>
            controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span>
                msg<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">` 调用接口超时: ></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ms<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms`</span></span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">fetchInterface</span><span class="token punctuation">(</span>signal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://xx.xx.xx.xx:xxxx/fiveseconds'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        signal
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// handle success</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// handle error</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 全部延迟到6s之后关闭进程</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'测试结束'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">6000</span><span class="token punctuation">)</span></code></pre>
      </div>
<h4 id="nodejs-进程性能监控"><a href="#nodejs-%E8%BF%9B%E7%A8%8B%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Node.js 进程性能监控</h4>
<h5 id="监控工具"><a href="#%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>监控工具</h5>
<p>Node.js 版本 - v10.16.3<br>
<a href="https://github.com/nearform/node-clinic">node-clinic</a></p>
<p>测试命令：<code class="gatsby-code-text">clinic doctor -- node abort.js</code></p>
<h5 id="测试方法"><a href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>测试方法</h5>
<p>在Node.js端连续发起<strong>10000</strong>次(<del>再多电脑散热器要揭竿而起</del>)fetch请求,请求随机延迟0-5秒之后响应；</p>
<p>设置2s的超时期限；分别测试2s之后，取消请求与不取消请求的差别下Node.js进程的性能对比；</p>
<blockquote>
<p>最后采用<code class="gatsby-code-text">setTimeout 6s</code>的原因是全部延迟Node.js进程到6s之后结束,取消请求会导致2s后进程关闭，后面的性能数据无法继续采集</p>
</blockquote>
<h6 id="测试结果"><a href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>测试结果</h6>
<ul>
<li>
<p>不取消请求的结果</p>
<ul>
<li>相同点：2s之后<code class="gatsby-code-text">Promise.race</code>返回的promise毫无疑问处于rejected状态</li>
<li><strong>不同点：2s之后，原来发起的请求，依然处于pending状态，Node.js进程并未结束，需等待所有异步请求结束之后才会结束进程</strong></li>
</ul>
</li>
<li>
<p>取消请求的结果</p>
<ul>
<li>相同点：2s之后<code class="gatsby-code-text">Promise.race</code>返回的promise毫无疑问处于rejected状态</li>
<li><strong>不同点：2s之后，原来发起的请求，处于canceled状态，Node.js进程结束</strong></li>
</ul>
</li>
<li>
<p>性能图对比：</p>
<ul>
<li>
<p>不取消请求</p>
<ul>
<li>cpu持续占用，最高600%</li>
<li>内存逐渐小幅度增加，最高252MB</li>
<li>active handles到结束逐渐减少

  <a
    class="gatsby-resp-image-link"
    href="/static/不取消请求-b0ff5c90a827f999ea6c136cbabcdc91-d1e36.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 840px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 48.802083333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABYklEQVQoz62QzU7DMBCE/RBAaWI7TpqkcZISQn9SWn4kEBceAnHhiUC87jDrliIQBw4cPu1OnFmPVy2Ge9Rnm4BvL1F9Y32o02bYa/Z7LZ7t7SNWmwcs13fw1GrWX6FsB6R+AVucw5U9EiI1Ky9Ij4JnbbdB6ZfIqzmHrTh4QFmvkNIj2LRGZAqoJqnhrceQztC5Bq2jTjwyO0WkC0RxjqLqYScddNpCZzOY7AxGNHudNojp0fTG9KgFU/R5h5tyjm1xgWV+jjWZ85tzHomQNUzRMUUDwyQ7GlgOFJLJDp1UUDafYZxMcaRzHDPRCWOfsI5YI1NiTPKyw5SkTK6ptaQPZ0V4pvSfqMhWYbLhz4L+Qczzul2EIYLjNyFlcrnABu+O8GQje3FNeIKg9xw092McDc6HiwN7LUNkLZ+rkQuVJPgzyVcf/ULMxGo0Mjg9NRj/AzJHXb+8Y/X8hvnT67/wAeosKplSp104AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="不取消请求"
        title=""
        src="/static/不取消请求-b0ff5c90a827f999ea6c136cbabcdc91-acf85.png"
        srcset="/static/不取消请求-b0ff5c90a827f999ea6c136cbabcdc91-c1418.png 210w,
/static/不取消请求-b0ff5c90a827f999ea6c136cbabcdc91-5d5d8.png 420w,
/static/不取消请求-b0ff5c90a827f999ea6c136cbabcdc91-acf85.png 840w,
/static/不取消请求-b0ff5c90a827f999ea6c136cbabcdc91-de0cd.png 1260w,
/static/不取消请求-b0ff5c90a827f999ea6c136cbabcdc91-bd6c2.png 1680w,
/static/不取消请求-b0ff5c90a827f999ea6c136cbabcdc91-d1e36.png 1920w"
        sizes="(max-width: 840px) 100vw, 840px"
      />
    </span>
  </span>
  
  </a>
    </li>
</ul>
</li>
<li>
<p>取消请求</p>
<ul>
<li>2s内cpu持续占用，最高355%，2s后极速降低为0</li>
<li>2s内内存逐渐小幅度增加，最高248MB，2后极速降低到133MB</li>
<li>active handles 2s后极速降低到0

  <a
    class="gatsby-resp-image-link"
    href="/static/取消请求-9c7686ae5764435812e81ddd5b47728c-d1e36.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 840px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 48.802083333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABL0lEQVQoz62QSW7CQBBF+xYB291uz7PNYIwBoSiKsskhomxyokS57s/vZlIQEhsWT7+rXMMvi379iqLZWPJ6JJsbjMiq9fH7eI7Ldovd8zuG7RtWI+cwFt1iz4I1kqJHmM7J4qiXd5z3qLsd0nLge8lhg+1JyxWCeGZRQQlHJhBu0MJvXuBFc0zdGFOZnnGMegmitIOKWnhBAy/sqNU/XF0SqsogomyGuNpC040KazY21OaiJsftQcLFYQUdd/AtrcXEJzw/hwjjBlLRDZ046uDqmpgOc6L9gs6TmzUW9gslM0hOVkReYXMqR1H3dnuoC2gib9Qa7MmaZwT8B5pnaX2iuLyZN8PM2dKcfqdOOHRwD9e/X3OoKyAmTxKTicT0AZg5Yv/1i+HzB8uP74fwB4WUKhsJFVXHAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="取消请求"
        title=""
        src="/static/取消请求-9c7686ae5764435812e81ddd5b47728c-acf85.png"
        srcset="/static/取消请求-9c7686ae5764435812e81ddd5b47728c-c1418.png 210w,
/static/取消请求-9c7686ae5764435812e81ddd5b47728c-5d5d8.png 420w,
/static/取消请求-9c7686ae5764435812e81ddd5b47728c-acf85.png 840w,
/static/取消请求-9c7686ae5764435812e81ddd5b47728c-de0cd.png 1260w,
/static/取消请求-9c7686ae5764435812e81ddd5b47728c-bd6c2.png 1680w,
/static/取消请求-9c7686ae5764435812e81ddd5b47728c-d1e36.png 1920w"
        sizes="(max-width: 840px) 100vw, 840px"
      />
    </span>
  </span>
  
  </a>
    </li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>CPU占用超过100%的原因JS为单线程，但是Node.js为多线程，Node.js会启用其他线程进行垃圾回收，性能优化等等,所以CPU占用是一个综合之后的数据</p>
</blockquote>
<h3 id="node-fetch-timeout"><a href="#node-fetch-timeout" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>node-fetch timeout</h3>
<p>现在在Node.js端做转发请求一般会使用<a href="https://github.com/node-fetch/node-fetch">node-fetch</a>库，node-fetch本身实现了<code class="gatsby-code-text">timeout</code>的option，node-fetch <code class="gatsby-code-text">timeout</code>的实现原理如下：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'socket'</span><span class="token punctuation">,</span> socket <span class="token operator">=></span> <span class="token punctuation">{</span>
        reqTimeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FetchError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`network timeout at: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> <span class="token string">'request-timeout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>node-fetch并不推荐使用<code class="gatsby-code-text">timeout</code>，而是建议使用标准的<code class="gatsby-code-text">AbortController</code>来控制超时：</p>
<ul>
<li><a href="https://github.com/node-fetch/node-fetch#request-cancellation-with-abortsignal">node-fetch timeout vs abortsignal</a></li>
<li><a href="https://stackoverflow.com/questions/54204342/node-fetch-why-is-signal-recommended-over-timeout">建议使用AbortController的原因</a></li>
</ul>
<h3 id="结论"><a href="#%E7%BB%93%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结论</h3>
<p>引入<a href="https://www.npmjs.com/package/abort-controller"><code class="gatsby-code-text">abort-controller</code></a> polyfill包 <strong>3kb</strong>，还是值得的,周下载量超过200万，应该是挺多人在使用。</p>]]></description><link>https://reactjs.org/blog/2020/01/18/abort-controller.html</link><guid isPermaLink="false">https://reactjs.org/blog/2020/01/18/abort-controller.html</guid><pubDate>Fri, 17 Jan 2020 16:00:00 GMT</pubDate></item><item><title><![CDATA[Catch React Error]]></title><description><![CDATA[<h3 id="catch-react-error"><a href="#catch-react-error" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>catch-react-error</h3>
<p>English | <a href="./doc/catch-react-error.md">简体中文</a></p>
<p><a href="./doc/catch-react-error_EN.md">Why we create catch-react-error</a></p>
<h3 id="introduction"><a href="#introduction" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h3>
<p>This project make it easy to protect your react source code。</p>
<p>We combine decorators and React Error Boundaries together.</p>
<p>The React Error Boundaries don’t support the Server Side Rendering，so we use <code class="gatsby-code-text">try/catch</code> to deal such condition.</p>
<p>The catch-react-error takes only one argument,<a href="https://reactjs.org/docs/error-boundaries.html">React Error Boundary Component</a>.
We provide DefaultErrorBoundary as the default argument.</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">catchreacterror</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Boundary <span class="token operator">=</span> DefaultErrorBoundary<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
      </div>
<div style="text-align:center" align="center">
  <img src="https://p1.music.126.net/6tHW45dHH_qKtCw0rrkJOg==/109951164571395030.gif">
</div>
<h3 id="demo"><a href="#demo" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Demo</h3>
<p>we provide some demo, so you can understand the library more clearly</p>
<h3 id="client-side-render"><a href="#client-side-render" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>client side render</h3>
<div class="gatsby-highlight">
      <pre class="gatsby-code-sh"><code class="gatsby-code-sh">cd example-client
npm install
npm run dev</code></pre>
      </div>
<h3 id="server-side-render"><a href="#server-side-render" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>server side render</h3>
<div class="gatsby-highlight">
      <pre class="gatsby-code-sh"><code class="gatsby-code-sh">cd example-server
npm install
npm run dev</code></pre>
      </div>
<h3 id="how-to-use"><a href="#how-to-use" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to use</h3>
<h4 id="1install-catch-react-error"><a href="#1install-catch-react-error" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.install catch-react-error</h4>
<div class="gatsby-highlight">
      <pre class="gatsby-code-sh"><code class="gatsby-code-sh">npm install catch-react-error --save</code></pre>
      </div>
<h4 id="2-install-es7-decorator-babel-plugin"><a href="#2-install-es7-decorator-babel-plugin" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Install ES7 Decorator babel plugin</h4>
<div class="gatsby-highlight">
      <pre class="gatsby-code-sh"><code class="gatsby-code-sh">npm install --save-dev @ babel / plugin-proposal-decorators
npm install --save-dev @ babel / plugin-proposal-class-properties</code></pre>
      </div>
<p>babel plugin configuration</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsxon"><code class="gatsby-code-jsxon">{
  &quot;plugins&quot;: [
    [&quot;@ babel / plugin-proposal-decorators&quot;, { &quot;legacy&quot;: true }],
    [&quot;@ babel / plugin-proposal-class-properties&quot;, { &quot;loose&quot;: true }]
  ]
}</code></pre>
      </div>
<h4 id="3-import-catch-react-error"><a href="#3-import-catch-react-error" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. import catch-react-error</h4>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">import</span> catchreacterror <span class="token keyword">from</span> <span class="token string">"catch-react-error"</span><span class="token punctuation">;</span></code></pre>
      </div>
<h4 id="4-use-catchreacterror-on-class-component"><a href="#4-use-catchreacterror-on-class-component" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. Use @catchreacterror on class component</h4>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx">@<span class="token function">catchreacterror</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"count is three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<h4 id="5-use-catchreacterror-on-functionc-component"><a href="#5-use-catchreacterror-on-functionc-component" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. Use @catchreacterror on functionc component</h4>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"count is three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> SaleCount <span class="token operator">=</span> <span class="token function">catchreacterror</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SaleCount</span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span><span class="token constant">I</span>'m <span class="token constant">OK</span><span class="token punctuation">,</span> click me <span class="token operator">!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<h4 id="6-how-to-write-a-customerrorboundary"><a href="#6-how-to-write-a-customerrorboundary" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6. How to write a CustomErrorBoundary</h4>
<ol>
<li>create an normal Error Boundary Component</li>
</ol>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">class</span> <span class="token class-name">CustomErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
<span class="token function">  constructor</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>hasError<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>hasError<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token function">  componentDidCatch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//do something as needed</span>
<span class="token function">    logErrorToMyService</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token function">  render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> Something <span class="token keyword">with</span> my app<span class="token punctuation">,</span>fallback ui<span class="token punctuation">.</span> <span class="token operator">&lt;</span><span class="token operator">/</span> h1<span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<ol start="2">
<li>pass it as the argument</li>
</ol>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx">@<span class="token function">catchreacterror</span><span class="token punctuation">(</span>CustomErrorBoundary<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
      </div>
<p>or</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> SaleCount <span class="token operator">=</span> <span class="token function">catchreacterror</span><span class="token punctuation">(</span>CustomErrorBoundary<span class="token punctuation">)</span><span class="token punctuation">(</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<h3 id="license"><a href="#license" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>License</h3>
<p>MIT.</p>]]></description><link>https://reactjs.org/blog/2020/01/02/catch-react-error.html</link><guid isPermaLink="false">https://reactjs.org/blog/2020/01/02/catch-react-error.html</guid><pubDate>Wed, 01 Jan 2020 16:00:00 GMT</pubDate></item><item><title><![CDATA[黑珍珠号的诅咒 - Functor]]></title><description><![CDATA[<p>函数式编程（Functional Programming）这一理念不论是在前端领域还是后端领域，都逐渐热门起来，现在不大量使用函数式编程技术的大型应用程序已经很罕见了，比如前端流行的 React（核心思路数据即视图），Vue3.0 的 Composition API ，Redux ，Lodash 等等前端框架和库，无不充斥着函数式的思维，实际上函数式编程绝不是最近几年才被创造的编程范式，而是在计算机科学的开始，<a href="https://history.computer.org/pioneers/church.html">Alonzo Church</a> 在 20 世纪 30 年代发表的 <code class="gatsby-code-text">lambda</code> 演算，可以说是函数式编程的前世今生。</p>
<p>本系列文章适合拥有扎实的 JavaScript 基础和有一定函数式编程经验的人阅读，本文的目的是结合 JavaScript 的语言特性来讲解范畴论的一些概念和逻辑在编程中的实际应用。</p>
<h3 id="黑珍珠号的诅咒"><a href="#%E9%BB%91%E7%8F%8D%E7%8F%A0%E5%8F%B7%E7%9A%84%E8%AF%85%E5%92%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>黑珍珠号的诅咒</h3>
<h4 id="扬帆起航！"><a href="#%E6%89%AC%E5%B8%86%E8%B5%B7%E8%88%AA%EF%BC%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>扬帆起航！</h4>
<p>首先我们看一段 <code class="gatsby-code-text">双11大促销</code> 的代码，即作为对函数组合等概念的回顾，也作为即将开启的新征程的第一步：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">finalPrice</span> <span class="token operator">=</span> number <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> doublePrice <span class="token operator">=</span> number <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token keyword">const</span> discount <span class="token operator">=</span> doublePrice <span class="token operator">*</span> <span class="token number">.8</span>
    <span class="token keyword">const</span> price <span class="token operator">=</span> discount <span class="token operator">-</span> <span class="token number">50</span>
    <span class="token keyword">return</span> price
<span class="token punctuation">}</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">finalPrice</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// => 110</span></code></pre>
      </div>
<p>看看上面这段简单的 <code class="gatsby-code-text">双11购物狂欢节</code> 的代码，<strong>原价 100 **的商品，经过商家一顿花式大促销（<code class="gatsby-code-text">打折（八折）</code> + <code class="gatsby-code-text">优惠券（50）</code>）的操作之后，大家成功拿到</strong>剁手价 110**。<del>好划算，快剁手</del></p>
<p>如果你已经阅读了我们云音乐前端团队的另外一篇<a href="https://juejin.im/post/5d70e25de51d453c11684cc4">函数式编程入门文章</a>，我相信你已经知道如何书写函数式的程序了：即通过管道把数据在一系列纯函数间传递的程序。我们也知道了，这些程序就是声明式的行为规范。现在再次使用函数组合的思路保持数据管道操作，并消除这么多的中间变量，保持一种 <code class="gatsby-code-text">Point-Free</code> 风格：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx">    <span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>fns<span class="token punctuation">)</span> <span class="token operator">=></span> x <span class="token operator">=></span> fns<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token function-variable function">double</span> <span class="token operator">=</span> x <span class="token operator">=></span> x <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token keyword">const</span> <span class="token function-variable function">discount</span> <span class="token operator">=</span> x <span class="token operator">=></span> x <span class="token operator">*</span> <span class="token number">0.8</span>
    <span class="token keyword">const</span> <span class="token function-variable function">coupon</span> <span class="token operator">=</span> x <span class="token operator">=></span> x <span class="token operator">-</span> <span class="token number">50</span>

    <span class="token keyword">const</span> finalPrice <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>coupon<span class="token punctuation">,</span> discount<span class="token punctuation">,</span> double<span class="token punctuation">)</span>

    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">finalPrice</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// => 110</span></code></pre>
      </div>
<p>嗯！终于有了点函数式的味道！这个时候，我们发现传给函数 <code class="gatsby-code-text">finalPrice</code> 的参数 <code class="gatsby-code-text">100</code> 像一个工厂的零配件一样在流水线上先后被函数 <code class="gatsby-code-text">double</code>、 <code class="gatsby-code-text">discount</code> 和 <code class="gatsby-code-text">coupon</code> 所操作。<code class="gatsby-code-text">100</code> 像水一样在管道中流通。看到这一幕我们是不是有点眼熟，Array 的 <code class="gatsby-code-text">map</code> ，<code class="gatsby-code-text">filter</code> ，不就是完全类似的概念吗？所以我们可以用 Array 把我们输入的参数进行包装：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">finalPrice</span> <span class="token operator">=</span> number <span class="token operator">=></span>
    <span class="token punctuation">[</span>number<span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">finalPrice</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// => [110]</span></code></pre>
      </div>
<p>现在我们把 <code class="gatsby-code-text">number</code> 放进 Array 这个容器内，然后连续调用了三次 map ,来实现数据的管道流动。仔细观察发现 Array 只是我们数据的容器，我们也只是想利用 Array 的 map 方法罢了，其他的方法我们暂时用不到，那么我们何不创建一个 <code class="gatsby-code-text">Box</code> 容器呢？</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Box</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    inspect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Box(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">finalPrice</span> <span class="token operator">=</span> str <span class="token operator">=></span>
    <span class="token function">Box</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">finalPrice</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// => Box(110)</span></code></pre>
      </div>
<blockquote>
<p>这里使用函数 Box 而不是 ES6 的 Class 来生产对象的原因是，尽量避免了“糟糕”的 new 和 this 关键字(摘自《 You Don’t Know JS 上册》)， new 让人误以为是创建了 Class 的实例，但其实根本不存在所谓的<code class="gatsby-code-text">实例化</code>，只是简单的<code class="gatsby-code-text">属性委托机制(对象组合的一种)</code>，而 this 则引入了执行上下文和词法作用域的问题，而我只是想创建一个简单的对象而已！        </p>
<p>inspect 方法的目的是为了使用 Node.js 中的 console.log 隐式的调用它，方便我们查看数据的类型；而这一方法在浏览器中不可行，可以用 <code class="gatsby-code-text">console.log(String(x))</code> 来代替; Node.js V12 API 有变更，可以采用 <a href="http://nodejs.cn/api/en/util.html#util_util_inspect_object_options"><code class="gatsby-code-text">Symbol.for(&#39;nodejs.util.inspect.custom&#39;)</code></a> 替代 inspect
<br>
这里使用连续 dot、dot、dot 的链式调用而不是使用 compose 组合的原因是为了更方便的理解，compose 更为函数式。</p>
</blockquote>
<h4 id="被封印的黑珍珠号"><a href="#%E8%A2%AB%E5%B0%81%E5%8D%B0%E7%9A%84%E9%BB%91%E7%8F%8D%E7%8F%A0%E5%8F%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>被封印的黑珍珠号</h4>
<p><img src="https://p1.music.126.net/eLyaFFUwmPlcaY9bxWhGkw==/109951164499400541.png" alt="杰克船长的黑珍珠号"></p>
<p>Box 中这个 <code class="gatsby-code-text">map</code> 跟数组那个著名的 <code class="gatsby-code-text">map</code> 一样，除了前者操作的是 <code class="gatsby-code-text">Box(x)</code> 而后者是 <code class="gatsby-code-text">[x]</code> 。它们的使用方式也几乎一致，把一个值丢进 Box ，然后不停的 map，map，map…：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// => Box(12)</span>

<span class="token function">Box</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">=></span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// => Box('HELLO')</span></code></pre>
      </div>
<p>这是讲解函数式编程的第一个容器，我们将它称之为 <code class="gatsby-code-text">Box</code>，而数据就像杰克船长瓶子中的黑珍珠号一样，我们只能通过 <code class="gatsby-code-text">map</code> 方法去操作其中的值，而 Box 像是一种虚拟的屏障，也可以说在一定程度上保护 Box 中的值不被随意的获取和操作。</p>
<p>为什么要使用这样的思路？因为我们能够在不离开 Box 的情况下操作容器里面的值。Box 里的值传递给 <code class="gatsby-code-text">map</code> 函数之后，就可以任我们操作；操作结束后，为了防止意外再把它放回它所属的 <code class="gatsby-code-text">Box</code>。这样做的结果是，我们能连续地调用 <code class="gatsby-code-text">map</code>，运行任何我们想运行的函数。甚至还可以改变值的类型，就像上面最后一个例子中那样。</p>
<blockquote>
<p>map 是可以使用 lambda 表达式变换容器内的值的有效且安全的途径。</p>
</blockquote>
<p>等等，如果我们能一直调用 <code class="gatsby-code-text">map.map.map</code> ，那我们是不是可以称这种类型为 <code class="gatsby-code-text">Mappable Type</code> ? 这样理解完全没有问题！</p>
<p><code class="gatsby-code-text">map</code> 知道如何在上下文中映射函数值。它首先会打开该容器，然后把值通过函数映射为另外一个值，最后把结果值再次包裹到一个新的同类型的容器中。而这种变换容器内的值的方法(map)称为 <a href="https://medium.com/@dtinth/what-is-a-functor-dcf510b098b6">Functor(函子)</a>。</p>
<p><img src="https://p1.music.126.net/T8BjeCqe_-mJUQczJoOdbw==/109951164499392356.png" alt="函子图解"></p>
<p><code class="gatsby-code-text">Functor(函子)</code> 是<a href="https://www.quantamagazine.org/with-category-theory-mathematics-escapes-from-equality-20191010/">范畴论</a>里的概念。范畴论又是什么？？？ 我不懂！！！</p>
<p>不慌！后面我们会再继续简单的讨论一下范畴论与 Functor 的概念和理论，让我们暂时忘记这个奇怪的名字，先跳过这个概念。</p>
<p>还是继续称之为我们都能理解的 Box 吧！</p>
<h4 id="黑珍珠号的救赎"><a href="#%E9%BB%91%E7%8F%8D%E7%8F%A0%E5%8F%B7%E7%9A%84%E6%95%91%E8%B5%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>黑珍珠号的救赎</h4>
<p>类似于 <code class="gatsby-code-text">Box(2).map(x =&gt; x + 2)</code> 我们已经可以把任何类型的值，包装到 Box 中，然后不断的 map，map，map…。</p>
<p>另一个问题，我们怎么取出来我们的值呢？我想要的结果是 <code class="gatsby-code-text">4</code> 而不是 <code class="gatsby-code-text">Box(4)</code>!</p>
<p>如果黑珍珠号不能从瓶子中释放出来又有什么用处呢？接下来让杰克斯派洛船长抢过黑胡子的宝剑，释放出来黑珍珠号！</p>
<p>是时候为我们的这个最为原始的 Box 添加别的方法了。</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Box</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fold<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    inspect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Box(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">)</span>  <span class="token comment">// => 4</span></code></pre>
      </div>
<p>嗯，看出来 <code class="gatsby-code-text">fold</code> 和 <code class="gatsby-code-text">map</code> 的区别了吗？</p>
<p><strong><code class="gatsby-code-text">map</code> 是把函数执行的结果重新包装到 Box 中后然返回一个新的 Box 类型，而 <code class="gatsby-code-text">fold</code> 则是直接把函数执行的结果 return 出来，就结束了！</strong></p>
<h3 id="box-的实际应用"><a href="#box-%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Box 的实际应用</h3>
<h4 id="try-catch"><a href="#try-catch" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Try-Catch</h4>
<p>在许多情况下都会发生 JavaScript 错误，特别是在与服务器通讯时，或者是在试图访问一个 null 对象的属性时。我们总是要预先做好最坏的打算，而这种大部分都是通过 <code class="gatsby-code-text">try-catch</code> 来实现的。</p>
<p>举例来说：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">getUser</span> <span class="token operator">=</span> id <span class="token operator">=></span>
    <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Loren'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Zora'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token comment">// => 'Loren'</span>

<span class="token keyword">const</span> name2 <span class="token operator">=</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name2<span class="token punctuation">)</span> <span class="token comment">// => 'TypeError: Cannot read property 'name' of undefined'</span></code></pre>
      </div>
<p>那么现在代码报错了，使用 <code class="gatsby-code-text">try-catch</code> 可以一定程度上解决这个问题：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token comment">// => 'TypeError: Cannot read property 'name' of undefined'</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>一旦发生了错误，JavaScript 会立即终止执行，并创建导致该问题的函数的调用堆栈跟踪，并保存到 Error 对象中，catch 就像是我们代码的避风港湾一样。但是 <code class="gatsby-code-text">try-catch</code> 能妥善的解决我们的问题吗？<code class="gatsby-code-text">try-catch</code> 存在以下缺点：</p>
<ul>
<li>违反了<a href="https://en.wikipedia.org/wiki/Referential_transparency">引用透明</a>原则，因为抛出异常会导致函数调用出现另一个出口，所以不能确保单一的可预测的返回值。</li>
<li>会引起<a href="https://juejin.im/post/5d70e25de51d453c11684cc4#heading-11">副作用</a>，因为异常会在函数调用之外对堆栈引发不可预料的影响。</li>
<li>违反<a href="https://www.commonlounge.com/discussion/e16d75c8232c4161b474f4b62c261c9d#trycatch">局域性的原则</a>，因为用于恢复异常的代码和原始的函数调用渐行渐远，当发生错误的时候，函数会离开局部栈和环境。</li>
<li>不能只关心函数的返回值，调用者需要负责声明 catch 块中的异常匹配类型来管理特定的异常;难以与其他函数组合或链接，总不能让管道中的下一个函数处理上一个函数抛出的错误吧。</li>
<li>当有多个异常条件的时候会出现<a href="https://guide.freecodecamp.org/javascript/error-handling-and-try-catch-throw/">嵌套的异常处理块</a>。</li>
</ul>
<blockquote>
<p>异常应该由一个地方抛出，而不是随处可见。</p>
</blockquote>
<p>上面的描述和代码可以看出，<code class="gatsby-code-text">try-catch</code> 是完全被动的解决方式，也非常的不“函数式”，若是能轻松的处理错误甚至包容错误，该有多好？下面不妨让我们使用Box理念，来优化这些问题</p>
<h4 id="向左-向右"><a href="#%E5%90%91%E5%B7%A6-%E5%90%91%E5%8F%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>向左? 向右?</h4>
<p>仔细分析 <code class="gatsby-code-text">try-catch</code> 代码块的逻辑，发现我们的代码出口要么在 try 中，要么在 catch 中(函数总不能有两个返回值吧)。按照我们代码设计的期望，我们是希望代码从 try 分支走完的，catch 是我们的一个兜底方案，那么我们可以类比 try 为 <code class="gatsby-code-text">Right</code> 指代正常的分支，catch 为 <code class="gatsby-code-text">Left</code> 指代出现异常的分支，他们两者绝不会同时出现！那么我们扩展一下我们的 <code class="gatsby-code-text">Box</code> ，分别为 <code class="gatsby-code-text">Left</code> 和 <code class="gatsby-code-text">Right</code> ，看代码：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Left</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Left</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    fold<span class="token punctuation">:</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    inspect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Left(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">Right</span> <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> f <span class="token operator">=></span> <span class="token function">Right</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fold<span class="token punctuation">:</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    inspect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`Right(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> resultLeft <span class="token operator">=</span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resultLeft<span class="token punctuation">)</span>  <span class="token comment">// => Left(4)</span>

<span class="token keyword">const</span> resultRight <span class="token operator">=</span> <span class="token function">Right</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resultRight<span class="token punctuation">)</span>  <span class="token comment">// => Right(2.5)</span></code></pre>
      </div>
<p><code class="gatsby-code-text">Left</code> 和 <code class="gatsby-code-text">Right</code> 的区别在于 Left 会自动跳过 <code class="gatsby-code-text">map</code> 方法传递的函数，而 Right 则类似于最基本的 Box，会执行函数并把返回值重新包装到 Right 容器里面。<code class="gatsby-code-text">Left</code> 和 <code class="gatsby-code-text">Right</code> 完全类似于 Promise 中的 <code class="gatsby-code-text">Reject</code> 和 <code class="gatsby-code-text">Resolve</code>，一个 Promise 的结果要么是 Reject 要么是 Resolve，而拥有 Right 和 Left 分支的结构体，我们可以称之为 <strong>Either</strong> ，要么向左，要么向右，很好理解，对吧！上面的代码说明了 Left 和 Right 的基本用法，现在把我们的 <code class="gatsby-code-text">Left</code> 和 <code class="gatsby-code-text">Right</code> 应用到 <code class="gatsby-code-text">getUser</code> 函数上吧！</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">getUser</span> <span class="token operator">=</span> id <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Loren'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Zora'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> user <span class="token operator">?</span> <span class="token function">Right</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'not found'</span><span class="token punctuation">,</span> x <span class="token operator">=></span> x<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// => not found</span></code></pre>
      </div>
<p>不可相信！我们现在竟然能线性的处理错误，并且甚至能够给出一个 <code class="gatsby-code-text">not found</code> 的提醒了（通过给 fold 提供），但是再仔细思考一下，是不是我们原始的 <code class="gatsby-code-text">getUser</code> 函数，有可能会返回 <code class="gatsby-code-text">undefined</code> 或者一个正常的值，是不是可以直接包装一下这个函数的返回值呢？</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">fromNullable</span> <span class="token operator">=</span> x <span class="token operator">=></span>
    x <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">Right</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">getUser</span> <span class="token operator">=</span> id <span class="token operator">=></span>
    <span class="token function">fromNullable</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Loren'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Zora'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'not found'</span><span class="token punctuation">,</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// => not found</span></code></pre>
      </div>
<p>现在我们已经成功处理了可能出现 null 或者 undefined 的情况，那么 try-catch 呢？是否也可以被 Either 包装一下呢？</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">tryCatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Right</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Left</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">jsonFormat</span> <span class="token operator">=</span> str <span class="token operator">=></span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">app</span> <span class="token operator">=</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token function">tryCatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">jsonFormat</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'default path'</span><span class="token punctuation">,</span> x <span class="token operator">=></span> x<span class="token punctuation">)</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token string">'{"path":"some path..."}'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// => 'some path...'</span>

<span class="token keyword">const</span> result2 <span class="token operator">=</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token string">'the way to death'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span> <span class="token comment">// => 'default path'</span></code></pre>
      </div>
<p>现在我们的 try-catch 即使报错了，也不会打断我们的函数组合了,并且错误得到了合理的控制，不会随意的 throw 出来一个 Error 对象了。</p>
<blockquote>
<p>此处建议打开网易云音乐听一首<a href="https://music.163.com/#/song?id=1365888841">《向左向右》</a>！放松一下，顺带回味一下我们的 Right 与 Left。</p>
</blockquote>
<h3 id="什么是-functor-怎么使用-functor-为什么使用-functor"><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-functor-%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8-functor-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8-functor" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>什么是 Functor? 怎么使用 Functor? 为什么使用 Functor?</h3>
<h4 id="什么是-functor"><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-functor" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>什么是 Functor?</h4>
<p>上面我们定义了一个简单的 Box，其实也就是拥有 <code class="gatsby-code-text">map</code> 和 <code class="gatsby-code-text">fold</code> 方法的类型。让我们把脚步放慢一点，再仔细观察和思考一下我们的 <code class="gatsby-code-text">map</code>：<code class="gatsby-code-text">Box(a) -&gt; Box(b)</code> ，本质上就是通过一个函数 <code class="gatsby-code-text">a -&gt; b</code> 把一个 <code class="gatsby-code-text">Box(a)</code> 映射为 <code class="gatsby-code-text">Box(b)</code>。这和中学代数中的函数知识何其类似，不妨再回顾一下代数课本中函数的定义：</p>
<p><strong>假设 A 和 B 是两个集合，若按照某种对应法则，使得 A 的任一元素在 B 中都有唯一的元素和它对应，则称这种对应为从集合 A 到集合 B 的函数。</strong></p>
<p>上面的集合 A 和集合 B，拿到我们的程序世界，完全可以类比与 String 、Boolean、Number 和更抽象的 Object，通常我们可以把数据类型视作所有可能值的一个集合（ Set ）。像 Boolean 就可以看作是 <code class="gatsby-code-text">[true,false]</code> 的集合，Number 是所有实数的集合，所有的集合，以集合为对象，集合之间的映射作为箭头，则构成了一个范畴：</p>
<p><img src="https://p1.music.126.net/IQIDMxhCvN2lKYDPfBE6rQ==/109951164499395888.png" alt="范畴"></p>
<p>看图：a，b，c 分别表示三个范畴，现在我们做个类比：a 为字符串的集合(String)，b 为实数的集合(Number)，c 为 Boolean 的集合；那么我们完全可以实现映射函数 <code class="gatsby-code-text">g</code> 为 <code class="gatsby-code-text">str =&gt; str.length</code>，而函数 <code class="gatsby-code-text">f</code> 为 <code class="gatsby-code-text">number =&gt; number &gt;=0 ? true : false</code>，那么我们就可以通过函数 <code class="gatsby-code-text">g</code> 完成从字符串范畴到实数范畴的映射，然后通过函数 <code class="gatsby-code-text">f</code> 从实数范畴映射到 Boolean 范畴。</p>
<p>现在重新回顾一下之前跳过的那个晦涩的名字： Functor （函子）就是范畴到范畴之间映射的那个箭头！而这个箭头一般通过 map 方法配合一个变换函数（i.e. <code class="gatsby-code-text">str =&gt; str.length</code> ）来实现,这样理解起来就很容易了，对吧（<del>才怪</del>）</p>
<p>如果我们有了函数 g 和函数 f，那么我们一定可以推导出函数 <code class="gatsby-code-text">h = f·g</code> ，也就是 <code class="gatsby-code-text">const h = compose(f,g)</code>，而这就是上图下半部分 <code class="gatsby-code-text">a -&gt; c</code>的变换过程，这不就是中学的数学<code class="gatsby-code-text">结合律</code>吗? <del>我们可都是学过高数的，谁不会啊</del></p>
<p>等等，a，b，c 上面的那个 id 箭头又是什么鬼？自己映射到自己？不错！
对于任何 <code class="gatsby-code-text">Functor</code>，通过函数 <code class="gatsby-code-text">const id = x =&gt; x</code> 可以实现 <code class="gatsby-code-text">fx.map(id) == id(fx)</code>，而这被称为 <code class="gatsby-code-text">Identity</code>，也就是数学中的<code class="gatsby-code-text">同一律</code>。</p>
<p>这也是为什么我们一定要引入范畴论，引入 <code class="gatsby-code-text">Functor</code> 的概念，而不只是简单的把他们称为 <code class="gatsby-code-text">mappale</code> 或者其他什么东西，因为这样我们就可以在保持名称不变的基础上更加理解伴随着数学原理而来的 Functor 的其他的定理(<code class="gatsby-code-text">Composition</code> 和 <code class="gatsby-code-text">Identity</code>)，不要因为这个晦涩的名称而让我们驻步不前。</p>
<blockquote>
<p>上面的介绍仅仅是方便前端渣渣们(<del>和Haskell大神相比</del>)，在一定程度上理解范畴。并不是十分的严谨(<del>非常不严谨好不</del>)，范畴中的对象可以不是集合，箭头也可以不是映射…停停！！打住！再说下去我就可以转行做代数老师了(ahhhh.jpg)。</p>
</blockquote>
<h4 id="怎么使用-functor"><a href="#%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8-functor" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>怎么使用 Functor?</h4>
<p>现在再次让我们回到代码的世界，毫无疑问 <code class="gatsby-code-text">Functor</code> 这个概念太常见了。其实绝大多数的开发人员一直在使用 <code class="gatsby-code-text">Functor</code> 却没有意识到而已。比如：</p>
<ul>
<li>Array 的 <code class="gatsby-code-text">map</code> 和 <code class="gatsby-code-text">filter</code>。</li>
<li>jQuery 的 <code class="gatsby-code-text">css</code> 和 <code class="gatsby-code-text">style</code>。</li>
<li>Promise 的 <code class="gatsby-code-text">then</code> 和 <code class="gatsby-code-text">catch</code> 方法(Promise 也是一种 Functor? Yes！)。</li>
<li>Rxjs Observable 的 <code class="gatsby-code-text">map</code> 和 <code class="gatsby-code-text">filter</code> (异步函数的组合？Relax！)。</li>
</ul>
<p>都是返回同样类型的 <code class="gatsby-code-text">Functor</code>，因此可以不断的链式调用，其实这些都是 Box 理念的延伸：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#mybtn"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span><span class="token string">"100px"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span><span class="token string">"100px"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">"background"</span><span class="token punctuation">,</span><span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token function">fromEvent</span><span class="token punctuation">(</span>$input<span class="token punctuation">,</span> <span class="token string">'keyup'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e <span class="token operator">=></span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>text <span class="token operator">=></span> text<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">debounceTime</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>    </code></pre>
      </div>
<h4 id="为什么使用-functor"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8-functor" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么使用 Functor?</h4>
<p>把值装进一个容器（比如 Box，Right，Left 等），然后只能用 <code class="gatsby-code-text">map</code> 来操作它，这么做的理有到底是什么呢？如果我们换种方式来思考，答案就很明显了：让容器自己去运用函数能给我们带来什么好处呢？答案是：
<strong>抽象，对于函数运用的抽象。</strong></p>
<p>纵观整个函数式编程的核心就在于把一个个的小函数组合成更高级的函数。
举个函数组合的例子：如果想给任何 <code class="gatsby-code-text">Functor</code> 应用一个统一的 map ，该如何处理？答案是 <a href="https://juejin.im/post/5d70e25de51d453c11684cc4#heading-15"><code class="gatsby-code-text">Partial Application</code></a>：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">partial</span> <span class="token operator">=</span>
    <span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token operator">...</span>presetArgs<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token punctuation">(</span><span class="token operator">...</span>laterArgs<span class="token punctuation">)</span> <span class="token operator">=></span>
            <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>presetArgs<span class="token punctuation">,</span> <span class="token operator">...</span>laterArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">double</span> <span class="token operator">=</span> n <span class="token operator">=></span> n <span class="token operator">*</span> <span class="token number">2</span>
<span class="token keyword">const</span> <span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token constant">F</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
<span class="token keyword">const</span> mapDouble <span class="token operator">=</span> <span class="token function">partial</span><span class="token punctuation">(</span>map<span class="token punctuation">,</span> double<span class="token punctuation">)</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">mapDouble</span><span class="token punctuation">(</span><span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment">// => 2</span></code></pre>
      </div>
<p>关键在于 <code class="gatsby-code-text">mapDouble</code> 函数返回的结果是一个等待接收第二个参数 F (Box(1)) 的函数; 一旦收到第二个参数，则会直接执行 <code class="gatsby-code-text">F.map(fn)</code> ，相当于 <code class="gatsby-code-text">Box(1).map(double)</code> ,该表达式返回的结果为 <code class="gatsby-code-text">Box(2)</code> ,所以后面可以继续 <code class="gatsby-code-text">.fold</code>等等链式操作。</p>
<h3 id="总结与计划"><a href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E8%AE%A1%E5%88%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结与计划</h3>
<h4 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h4>
<p>上面通过双十一购物狂欢节的例子，介绍了函数式编程的几个基本概念（pure function，compose）等，并逐渐引入了功能强大的 <code class="gatsby-code-text">Box</code> 理念，也就是最基本的 <code class="gatsby-code-text">Functor</code>。后面通过无时不刻可能出现的 null ，介绍了 <code class="gatsby-code-text">Either</code> 可以用来做 null 的包容器。再通过 <code class="gatsby-code-text">try-catch</code> 的例子，了解了比较 pure 的处理错误的方式， Either 当然不仅仅是这两种用法，后面会继续介绍其他高级的用法。最后总结了什么是 <code class="gatsby-code-text">Functor</code>，怎么使用 <code class="gatsby-code-text">Functor</code>，以及使用 <code class="gatsby-code-text">Functor</code> 的优势何在。</p>
<h4 id="计划"><a href="#%E8%AE%A1%E5%88%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>计划</h4>
<p><code class="gatsby-code-text">Functor</code> 是我们介绍的范畴论中的最最最基本的一个概念，不过我们目前解决的都是最简单的问题（更优秀的组合（map），更健壮的代码（fromNullAble），更纯的错误处理（TryCatch）），但是嵌套的 try-catch 呢？异步函数怎么组合呢？后面会继续通过 <code class="gatsby-code-text">双11购物狂欢节的案例</code> 来介绍范畴论中的其他概念和实际用法示例（实际目的：继续揭露奸商的套路，<del>顺便转行做代数老师，摆脱 34岁 淘汰的潜规则; 狗头.jpg</del>）。</p>
<p>参考资料与引用文章：   </p>
<ul>
<li><a href="https://medium.com/@dtinth/what-is-a-functor-dcf510b098b6">What is a functor?</a>   </li>
<li><a href="https://medium.com/@cscalfani/so-you-want-to-be-a-functional-programmer-part-1-1f15e387e536">So You Want to be a Functional Programmer</a>   </li>
<li><a href="https://hackernoon.com/two-years-of-functional-programming-in-javascript-lessons-learned-1851667c726">Two Years of Functional Programming in JavaScript: Lessons Learned</a>   </li>
<li><a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-functional-programming-7f218c68b3a0">Master the JavaScript Interview: What is Functional Programming?</a>    </li>
<li><a href="https://github.com/MostlyAdequate/mostly-adequate-guide">《JavaScript函数式编程指南》</a>      </li>
<li><a href="https://book.douban.com/subject/25883834/">《You Don’t Know JS》</a>   </li>
<li><a href="https://bartoszmilewski.com/2014/10/28/category-theory-for-programmers-the-preface/">写给程序员的范畴论</a></li>
</ul>]]></description><link>https://reactjs.org/blog/2019/09/10/黑珍珠号的诅咒.html</link><guid isPermaLink="false">https://reactjs.org/blog/2019/09/10/黑珍珠号的诅咒.html</guid><pubDate>Mon, 09 Sep 2019 16:00:00 GMT</pubDate></item><item><title><![CDATA[移动端适配方案rem & vh、vw]]></title><description><![CDATA[<h3 id="rem布局"><a href="#rem%E5%B8%83%E5%B1%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rem布局</h3>
<h4 id="lib-flexible"><a href="#lib-flexible" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>lib-flexible</h4>
<p>假设设计MM给我们的设计稿尺寸为<code class="gatsby-code-text">750 x 1340</code>，那么我们前端拿到设计稿之后要如何动手开始开发呢？经过上面的介绍了移动端开发的基本概念之后，应该有了一些基本的思路，我们可以使用js动态计算rem的方案来实现。</p>
<p>rem是根据html节点的font-size来做计算的</p>
<p>举个例子：假如html元素的font-size为 <code class="gatsby-code-text">Npx</code>,一个元素的宽度设定为<code class="gatsby-code-text">2rem</code>;则该元素的实际宽度为：<code class="gatsby-code-text">2 * N px</code>；</p>
<p>换句话说px与rem的一定是成正比关系的。</p>
<p>那么既然设计MM给我们的设计稿尺寸为<code class="gatsby-code-text">750 x 1340</code>，那么我们完全可以把屏幕的布局视口平均分为750份；设计稿中的某个元的宽度直接按照，占了750份中的多少份来计算就可以了。</p>
<p>举例：
iPhone6的布局视口宽度为<code class="gatsby-code-text">document.documentElement.clientWidth = 375px</code>分为750份，则每份的宽度为<code class="gatsby-code-text">375px/750 = 0.5px</code>;并把<code class="gatsby-code-text">0.5px</code>设置为html元素的<code class="gatsby-code-text">font-size</code>;</p>
<p>现在有一个元素的宽度为<code class="gatsby-code-text">20px</code>,则只需要把元素的宽度用CSS编写为<code class="gatsby-code-text">20rem</code>即可！</p>
<p>因为<code class="gatsby-code-text">20px</code>，相对于平均分成<code class="gatsby-code-text">750</code>份之后,确实是只占了<code class="gatsby-code-text">20</code>份，每份是<code class="gatsby-code-text">0.5rem</code>。</p>
<p><strong>但是我们这样做了之后就会发现有问题啊，为何结果没有达到我们的预期呢？至少从数学计算的角度来说，我们的逻辑没问题！</strong></p>
<p>那么问题出在哪里呢？</p>
<p><strong>是浏览器在作妖！chrome的浏览器所允许的最小<code class="gatsby-code-text">font-size</code>为<code class="gatsby-code-text">12px</code>,所以我们设置了html元素的<code class="gatsby-code-text">font-size=.5px</code>是被忽略的，并且被重置为了<code class="gatsby-code-text">12px</code></strong></p>
<p>那么我们再次运用小学数学知识，只要把html元素的<code class="gatsby-code-text">font-size</code>等比例扩大100倍，然后元素的大小在缩小100倍不就可以解决这个问题啦！</p>
<p>所以我们把html元素的<code class="gatsby-code-text">font-size = 50px</code>,然后元素的宽度设定为<code class="gatsby-code-text">.2rem</code>，这样在计算之后不就没问题啦！</p>
<p>现在总结一下计算公式：</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token comment">// html元素的font-size大小，单位：px</span>
<span class="token keyword">const</span> htmlFontSize <span class="token operator">=</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> <span class="token number">750</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token comment">// 普通元素宽度，单位：rem</span>
<span class="token keyword">const</span> eleWidth <span class="token operator">=</span> <span class="token punctuation">(</span>设计稿宽度<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>如果上面的换算觉得还是麻烦，可以借助<code class="gatsby-code-text">postCss</code>的插件<code class="gatsby-code-text">px2rem</code>来帮助我们完成换算，我们在代码中直接写px就可以了！</p>
<p>其实这也是阿里巴巴<code class="gatsby-code-text">lib-flexible</code>的大概实现原理！</p>
<h4 id="rem的缺陷"><a href="#rem%E7%9A%84%E7%BC%BA%E9%99%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rem的缺陷</h4>
<p>rem是弹性布局的一种实现方式，弹性布局可以算作响应式布局的一种，但响应式布局不是弹性布局，弹性布局强调等比缩放，100%还原；响应式布局强调不同屏幕要有不同的显示，比图媒体查询。</p>
<p>一般内容型的网站，都不太使用使用rem,因为大屏用户可以自己选择要更大的字体，还是更多的内容，一旦使用了rem，就剥夺了用户的自由；一些偏向App类型的，图标类的，图片类的，比如：淘宝，活动页面，比较适合使用rem,因为调大字体时并不能调大图片的大小。同时rem存在一下问题：</p>
<ul>
<li><strong>字体问题</strong> - 字体大小并不能使用rem,字体的大小和字体宽度并不成正比关系，这个关系完全取决于字体的作者。所以字体大小不能使用rem。</li>
<li><strong>PC浏览</strong> - 如果用户在PC段浏览页面怎么办？一般我们都会设置一个最大宽度，大于这个宽度的话，页面居中，两边留白，或者直接跳PC页面</li>
</ul>
<div class="gatsby-highlight">
      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">var</span> clientWidth <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
clientWidth <span class="token operator">=</span> clientWidth <span class="token operator">&lt;</span> <span class="token number">780</span> <span class="token operator">?</span> clientWidth <span class="token punctuation">:</span> <span class="token number">780</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> clientWidth <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>设置body的宽度为100rem，并水平居中:</p>
<div class="gatsby-highlight">
      <pre class="gatsby-code-css"><code class="gatsby-code-css"><span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100rem
<span class="token punctuation">}</span></code></pre>
      </div>
<h3 id="vh、vw方案"><a href="#vh%E3%80%81vw%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vh、vw方案</h3>
<p>vh、vw方案即将视觉视口宽度<code class="gatsby-code-text">window.innerWidth</code>和视觉视口宽度<code class="gatsby-code-text">window.innerHeight</code>等分为100份。</p>
<p>本质上来说，<code class="gatsby-code-text">flexible</code>方案就是模仿这种方案，随着浏览器兼容性的进步，<code class="gatsby-code-text">vh、vw</code>方案已经可以直接用了。</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/vw-vh-5379a182408150a2dce7cf759fa14c00-1d83a.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 840px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 48.36309523809524%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcklEQVQoz31Sf2uCUBT1+3+GbcQgIvqr0SA3ptCvRRCUTslW1mowjcraKrXUs/feTH0Fe3C5713PPffcexXCMITruszonZ4oijhP45cWBAHzFJMaIHQ6HeTzeRQKBTQaDQ6QJf3vZPECJdF1HaZpQpIk2ItFAjwrVtU31OsN5nu9Pvp9BbVaHYYxxOkUcMQCJTsfVVVhWRY8z8PxeEyq5nL3aDZbrM3NZoP9fo9K5RHSiwzHoe8Dy2EKNU1LEimhbdtYLlfY7fZJodubO2iazrVZrYrEnuAeXKxWa2y333+E3W6XBFZsKe12mym8bLlcfoAoPmM6/cBgYGBovDOFrdYrUbzlW5ZlGcViEaVSiSSJ2P3srgbt+z4mkynGI5ORjkZjzOefRIR3vZTZbAZFUVi7pjnhql1umc7K+rLJfE8pDjEufgvnQa9J277nZyrGZFGqICRG8dyvlflO7wIlOJDKztpBFMYA5lNwGkNiCTbi47+f4vfotZzyxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="vw-vh"
        title=""
        src="/static/vw-vh-5379a182408150a2dce7cf759fa14c00-acf85.png"
        srcset="/static/vw-vh-5379a182408150a2dce7cf759fa14c00-c1418.png 210w,
/static/vw-vh-5379a182408150a2dce7cf759fa14c00-5d5d8.png 420w,
/static/vw-vh-5379a182408150a2dce7cf759fa14c00-acf85.png 840w,
/static/vw-vh-5379a182408150a2dce7cf759fa14c00-de0cd.png 1260w,
/static/vw-vh-5379a182408150a2dce7cf759fa14c00-1d83a.png 1344w"
        sizes="(max-width: 840px) 100vw, 840px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>举例来说：视觉视口为375px,那么<code class="gatsby-code-text">1vw = 3.75px</code>,这时UI给定一个元素的宽为<code class="gatsby-code-text">20px</code>(设备独立像素)，那么我们只要只需要把它设置为<code class="gatsby-code-text">20 / 3.75 = 5.3333vw</code>。</p>
<p>这里的比例关系我们也不用自己换算，我们可以使用<code class="gatsby-code-text">PostCSS</code>的<code class="gatsby-code-text">postcss-px-viewport</code>插件帮助我们完成这个过程。写代码时，我们只需要根据UI给的设计图写px单位即可.</p>
<p>没有任何一种方案是完美的，vw,vh也存在一下缺陷：</p>
<ul>
<li><code class="gatsby-code-text">px</code>转换成vw不一定能完全整除，因此有一定的像素差。</li>
<li>当容器使用vw,margin使用px时，很容易造成整体宽度超过100vw,从而影响布局效果。当然我们也是可以避免的，比如使用<code class="gatsby-code-text">padding</code>代替<code class="gatsby-code-text">margin</code>，结合<code class="gatsby-code-text">calc</code>函数使用</li>
<li>兼容性
部分机型不支持vw,vh，可以采用csspolyfill来进行降级处理，推荐<a href="https://github.com/rodneyrehm/viewport-units-buggyfill">viewport-units-buggyfill</a></li>
</ul>]]></description><link>https://reactjs.org/blog/2019/05/27/mobile-css.html</link><guid isPermaLink="false">https://reactjs.org/blog/2019/05/27/mobile-css.html</guid><pubDate>Sun, 26 May 2019 16:00:00 GMT</pubDate></item></channel></rss>