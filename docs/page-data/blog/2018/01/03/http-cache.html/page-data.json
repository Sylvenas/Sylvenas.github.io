{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/2018/01/03/http-cache.html","result":{"data":{"markdownRemark":{"html":"<h3>概述</h3>\n<p>浏览器的缓存机制也就是我们说的HTTP缓存机制，其机制是根据HTTP报文的缓存标识进行的，所以在分析浏览器缓存机制之前，我们先使用图文简单介绍一下HTTP报文，HTTP报文分为两种：</p>\n<ul>\n<li>请求(request)报文：请求行 – HTTP头(通用信息头，请求头，实体头) – 请求报文主体(只有POST才有报文主体)</li>\n<li>响应(response)报文：报文格式为：状态行 – HTTP头(通用信息头，响应头，实体头) – 响应报文主体</li>\n</ul>\n<p>其中有关浏览器缓存的部分主要是发生在<code class=\"language-text\">请求头</code>和<code class=\"language-text\">响应头</code>中部分头域，尤其重点关注<code class=\"language-text\">Cache-Control</code>。</p>\n<h3>浏览器缓存过程分析</h3>\n<p>浏览器与服务器通信的方式为应答模式，即是：<code class=\"language-text\">浏览器发起HTTP请求</code> – <code class=\"language-text\">服务器响应该请求</code>。那么浏览器第一次向服务器发起该请求后拿到请求结果，会根据响应报文中HTTP头的<code class=\"language-text\">缓存标识</code>，决定是否缓存结果，是则将请求结果和缓存标识存入浏览器缓存中，简单的过程如下图：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/82045303ab589b2176cf35d2e9e209f5/a8a6f/first-http-request.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.78260869565217%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqklEQVQ4y32Tya7CMAxF+f+f6gbEggW0EqMQRaXM8zy1GB1LjlJ4vEiuGye2r6+dUpZlkue5nE4nmc/nst1uBdvz+VR9Pp/VPpvN9J+75nM4HGQ6narv6/VSe4kDnFerlbRaLRmPx+Kv/X4vzWZToiiS9XrtHNGTyUTq9bosl0u9qwH52IXdbqdI4jiWbrcrvV5PBoOBoiCpBTOUyOPxKOwLAUGDgDZNU0WwWCwUwe12KziafNoLAeEEVO12W3Wn01FNAu6wcOauyf1+/x2Qkg0VjUBDQZIkaod8GmMCp8fj0VHxFXCz2WgASrRSCQyfNAwurePIcDhUEH8GBDZZuXC9Xp2QhMAI/5fLRXlDQPwTIQGtZJzhDZT9fl85ZXTgExtnVoU/Sm4OTcgKyUa4NQG77f2G+E0xKdmrYI1GIymXy1KpVKRarerQBkEgtVrNvRzT/44NBjLBEXPIJfhDs6c8uCKYj4Y9nPoJHIfwEYahjgil4MCCI+yNRqPwZtFURCV0/OvpgYYu+xkJQANwoFmg9suzTvtlu6b4pNshXWfuLCjJ7PzTx6h7A88PgeQr8XWgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"浏览器第一次http请求\"\n        title=\"浏览器第一次http请求\"\n        src=\"/static/82045303ab589b2176cf35d2e9e209f5/c0255/first-http-request.png\"\n        srcset=\"/static/82045303ab589b2176cf35d2e9e209f5/81c8e/first-http-request.png 230w,\n/static/82045303ab589b2176cf35d2e9e209f5/08a84/first-http-request.png 460w,\n/static/82045303ab589b2176cf35d2e9e209f5/c0255/first-http-request.png 920w,\n/static/82045303ab589b2176cf35d2e9e209f5/b1001/first-http-request.png 1380w,\n/static/82045303ab589b2176cf35d2e9e209f5/a8a6f/first-http-request.png 1516w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>由上图我们可以知道：</p>\n<ul>\n<li>\n<p>浏览器每次发起请求，都会首先在浏览器缓存中查找该请求的结果以及缓存标识</p>\n</li>\n<li>\n<p>浏览器每次拿到返回的请求结果都会将该结果和缓存标识存入浏览器缓存中</p>\n</li>\n</ul>\n<p>以上两点结论就是浏览器缓存机制的关键，他确保了每个请求的缓存存入与读取，只要我们再理解浏览器缓存的使用规则，那么所有的问题就迎刃而解了，本文也将围绕着这点进行详细分析。为了方便大家理解，这里我们根据是否需要向服务器重新发起HTTP请求将缓存过程分为两个部分，分别是<code class=\"language-text\">强制缓存</code>和<code class=\"language-text\">协商缓存</code>。</p>\n<h3>强制缓存</h3>\n<p>强制缓存就是向浏览器缓存查找该请求结果，并根据该结果的缓存规则来决定是否使用该缓存结果的过程，强制缓存的情况主要有三种(暂不分析协商缓存过程)，如下：</p>\n<ul>\n<li>1.不存在该缓存结果和缓存标识，强制缓存失效，则直接向服务器发起请求（跟第一次发起请求一致），如下图：</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/79437557003f83a52e5807b4d76e5e0f/87488/http-cache-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.69565217391304%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABgUlEQVQoz22Ta8uCcAzF/f4fyzdlRFlBJKR2hy7aRctMaw+/wcTiGRz+t7mdnU2nqirJskzO57Ncr1cpy1Le77fUda3r8/mUNE0V+Lxer693/C+Xi749Hg9xuNhut9LpdCQIArnf74LhjOE8GAzEdV1di6KQz+ejAbE8z/Xe8zzZ7/fi8EDQ2+2mGWAAKz4EnHE09lTUZsgZPwLj61im4/Eoy+VS1uu1DIdD6ff7mnmz2chsNtOSMQtkq4FkMHfsgVIpz5jBEsAafXjH9z8YS+JoQCJTEkzG47HC930Fe5gjiWnbBt8CkjcB2aABZcEEVm0wBbyZxsD0xD9Jku+A2OFwaDRcrVZfQMtut6tsOS8WCwX7+XwuURQpIdWQqGQku3X1FzCBkU0EZ7u3Dtv86hyeTieZTqfa0d85IxHMer2ervi35xR/5ncymWjpGpBNGIay2+2abpm26BfHsZaFHLCx7htDpMKHxjo2nLbaKNhsjUajptP8Ucwod8wpd21Dwz+6rJPuHQB/lwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"不存在缓存结果和缓存标示\"\n        title=\"不存在缓存结果和缓存标示\"\n        src=\"/static/79437557003f83a52e5807b4d76e5e0f/c0255/http-cache-1.png\"\n        srcset=\"/static/79437557003f83a52e5807b4d76e5e0f/81c8e/http-cache-1.png 230w,\n/static/79437557003f83a52e5807b4d76e5e0f/08a84/http-cache-1.png 460w,\n/static/79437557003f83a52e5807b4d76e5e0f/c0255/http-cache-1.png 920w,\n/static/79437557003f83a52e5807b4d76e5e0f/87488/http-cache-1.png 1282w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>2.存在该缓存结果和缓存标识，但该结果已失效，强制缓存失效，则使用协商缓存(暂不分析)，如下图:</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f6d056db2b4af49c3dcdda5cad21b3d6/53639/http-cache-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.56521739130435%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABeklEQVQoz3WTiY6CUAxF3///mgaNiAImGMUFNxBU3O3kNCmjZqZJU6Cvt7f3Ffd4PAR/Pp9iz99O7vV6/Zt7r3W32002m410Oh1JkkTO53NTjM1mM2m1WtJut2W9Xmvufr8rSF3XEgSBdLtdyfNcc47Cw+GghdvtVq7Xq4LRiCK+0WixWMjpdGrYEDlDk/l8ruB8c8Zkv99rIk1T6fV62jUMQ200nU71zPfYJgWMLecscTwepSgKZVFVlUa60mi32zXMvx0wZDLmCgg6hejY7/fVx+OxxHEsg8FAR2Y8M84bO+Llcvm9FAMsy1KWy6WyQWC0Y1yTIcsy1QtnEggQ+Q7DD0AMQMAAInIJvu/rLaKlMeZ5tVrpObZjMpmoHFgDiH6w4xD00QXHyMGCPJraJeAAAf6+Ac0eep73sYc4xmH2EH0Z0ZiQp/loNNI8ZDBnN2XRlpbdNNY8E2GKNOStxrbE3p39Ou+/EAbAcDjUC2ECNIyiSEGN5V+1P33Sl2kVqYgdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"存在缓存结果和缓存标示,但已失效\"\n        title=\"存在缓存结果和缓存标示,但已失效\"\n        src=\"/static/f6d056db2b4af49c3dcdda5cad21b3d6/c0255/http-cache-2.png\"\n        srcset=\"/static/f6d056db2b4af49c3dcdda5cad21b3d6/81c8e/http-cache-2.png 230w,\n/static/f6d056db2b4af49c3dcdda5cad21b3d6/08a84/http-cache-2.png 460w,\n/static/f6d056db2b4af49c3dcdda5cad21b3d6/c0255/http-cache-2.png 920w,\n/static/f6d056db2b4af49c3dcdda5cad21b3d6/53639/http-cache-2.png 1358w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>3.存在该缓存结果和缓存标识，且该结果尚未失效，强制缓存生效，直接返回该结果，如下图:</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f6d056db2b4af49c3dcdda5cad21b3d6/53639/http-cache-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.56521739130435%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABeklEQVQoz3WTiY6CUAxF3///mgaNiAImGMUFNxBU3O3kNCmjZqZJU6Cvt7f3Ffd4PAR/Pp9iz99O7vV6/Zt7r3W32002m410Oh1JkkTO53NTjM1mM2m1WtJut2W9Xmvufr8rSF3XEgSBdLtdyfNcc47Cw+GghdvtVq7Xq4LRiCK+0WixWMjpdGrYEDlDk/l8ruB8c8Zkv99rIk1T6fV62jUMQ200nU71zPfYJgWMLecscTwepSgKZVFVlUa60mi32zXMvx0wZDLmCgg6hejY7/fVx+OxxHEsg8FAR2Y8M84bO+Llcvm9FAMsy1KWy6WyQWC0Y1yTIcsy1QtnEggQ+Q7DD0AMQMAAInIJvu/rLaKlMeZ5tVrpObZjMpmoHFgDiH6w4xD00QXHyMGCPJraJeAAAf6+Ac0eep73sYc4xmH2EH0Z0ZiQp/loNNI8ZDBnN2XRlpbdNNY8E2GKNOStxrbE3p39Ou+/EAbAcDjUC2ECNIyiSEGN5V+1P33Sl2kVqYgdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"不存在缓存结果和缓存标示,并有效\"\n        title=\"不存在缓存结果和缓存标示,并有效\"\n        src=\"/static/f6d056db2b4af49c3dcdda5cad21b3d6/c0255/http-cache-2.png\"\n        srcset=\"/static/f6d056db2b4af49c3dcdda5cad21b3d6/81c8e/http-cache-2.png 230w,\n/static/f6d056db2b4af49c3dcdda5cad21b3d6/08a84/http-cache-2.png 460w,\n/static/f6d056db2b4af49c3dcdda5cad21b3d6/c0255/http-cache-2.png 920w,\n/static/f6d056db2b4af49c3dcdda5cad21b3d6/53639/http-cache-2.png 1358w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>强制缓存的规则</h4>\n<p>当浏览器向服务器发起请求时，服务器会将缓存规则放入HTTP响应报文的HTTP头中和请求结果一起返回给浏览器，控制强制缓存的字段分别是<code class=\"language-text\">Expires</code>和<code class=\"language-text\">Cache-Control</code>，其中<code class=\"language-text\">Cache-Control</code>优先级比<code class=\"language-text\">Expires</code>高。</p>\n<h4>Expires</h4>\n<p>Expires是<code class=\"language-text\">HTTP/1.0</code>控制网页缓存的字段，其值为服务器返回该请求结果缓存的到期时间(服务器时间)，即再次发起该请求时，如果客户端的时间小于Expires的值时，直接使用缓存结果。</p>\n<p>Expires是HTTP/1.0的字段，但是现在浏览器默认使用的是HTTP/1.1，那么在HTTP/1.1中网页缓存还是否由Expires控制？</p>\n<p>到了HTTP/1.1，Expire已经被<code class=\"language-text\">Cache-Control</code>替代，原因在于Expires控制缓存的原理是使用客户端的时间与服务端返回的时间做对比，那么如果客户端与服务端的时间因为某些原因（例如时区不同；客户端和服务端有一方的时间不准确）发生误差，那么强制缓存则会直接失效，这样的话强制缓存的存在则毫无意义，那么Cache-Control又是如何控制的呢？</p>\n<h4>Cache-Control</h4>\n<p>在HTTP/1.1中，Cache-Control是最重要的规则，主要用于控制网页缓存，主要取值为：</p>\n<ul>\n<li>\n<p>public：所有内容都将被缓存（客户端和代理服务器都可缓存）</p>\n</li>\n<li>\n<p>private：所有内容只有客户端可以缓存，Cache-Control的默认取值</p>\n</li>\n<li>\n<p>no-cache：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定</p>\n</li>\n<li>\n<p>no-store：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存</p>\n</li>\n<li>\n<p>max-age=xxx (xxx is numeric)：缓存内容将在xxx秒后失效</p>\n</li>\n</ul>\n<p>接下来，我们直接看一个例子，如下：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ec28a47ef210f7f56d2749b2a70f52ba/8b70b/cache-control-ex.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.78260869565218%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABP0lEQVQoz5WS226CQBRF+f+v8sknbUGLxhsMcqnctKJQnIFZDUSbtrExnmRnzmSSlX32GSOOYzzPI4qi/tzv96A1Xem2pX1Shmpblus1q82GxWqFIwS7JKE4n+neni3jkuc4psleCE5hSBEEHIOAzHGQeQ7HI7qq6DxrrR/KuAiX9XBI8PLSK3l7I5vNyOYzVBhCvEPH8V03+hrNL4eqrlnYNsv5HNuycJZLdmGArCpaKWnqmlYpmqZBSom69jfYX6ghm4b1ZsPW9wnCkCRNiZOENMvI8rxXt6jPquJYFBSnE2VZ/g+sPY/5YIA/GpFMp2S2zW5iEYzHfQTvpkn0+krpOuguAilv894fWaYp28kEz7IQpsnBdSk8jw8hOLhOf7/p5Ptopb4XdN+hUpjTKcL3SfKcsq6RD77LT8hf4BfD2rMdpY/7vQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cache-Control与Expire\"\n        title=\"Cache-Control与Expire\"\n        src=\"/static/ec28a47ef210f7f56d2749b2a70f52ba/c0255/cache-control-ex.png\"\n        srcset=\"/static/ec28a47ef210f7f56d2749b2a70f52ba/81c8e/cache-control-ex.png 230w,\n/static/ec28a47ef210f7f56d2749b2a70f52ba/08a84/cache-control-ex.png 460w,\n/static/ec28a47ef210f7f56d2749b2a70f52ba/c0255/cache-control-ex.png 920w,\n/static/ec28a47ef210f7f56d2749b2a70f52ba/8b70b/cache-control-ex.png 1266w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>由上面的例子我们可以知道：</p>\n<ul>\n<li>\n<p>HTTP响应报文中expires的时间值，是一个绝对值</p>\n</li>\n<li>\n<p>HTTP响应报文中Cache-Control为max-age=600，是相对值</p>\n</li>\n</ul>\n<p>由于Cache-Control的优先级比expires，那么直接根据Cache-Control的值进行缓存，意思就是说在600秒内再次发起该请求，则会直接使用缓存结果，强制缓存生效。</p>\n<blockquote>\n<p>在无法确定客户端的时间是否与服务端的时间同步的情况下，Cache-Control相比于expires是更好的选择，所以同时存在时，只有Cache-Control生效。</p>\n</blockquote>\n<p>那么应该如何使用<code class=\"language-text\">Cache-Control</code>的各个值呢？</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6888c4d5d47a64bd65c7f8d2d898a97f/2a333/cache-control.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACjklEQVQ4y31UWW/TQBDuP+QH8MQDCB4rEA9I5RCqKiIVgQSVUKtC+tRSUFqgF0iFHnmAVKhHGto4qZ2raS6rsR1f6/WHZhO7djlGmnjtnf32m29mMuT7Psjo6fG+01q3GFYOWhhfUzCxXsZ2XoXLeBj7LxsKNnuOJ0BMxxN+WNPxeruKsSUZ995LmM/U0bNZCHjZg+8xQGJ3mUGpY8JlHv5nUdAQ0GE8BqQaDlYPWkisyJjcqGIrrwrmhu2JWM59uB4XHsgUAtKmariCZbCxX+nifqqAu/MS7szlkViWUemYIoZA6UnGIyREyrSY2qzg2vQhbs3kkK/rsXT2yhpyp/pfU01LKpLpU7zbOUPXdPsM6Sdzco63mTMs/GygYzixQ5R6Q7PD9yijl+sl3Jz5heHZY9RUK65hYKSP2nNRbPTw6lsFjxaLGP0kY3qrikLDQNtwYbsclsuFppQ66RjT0OMcbd2FZjEwr99rdOPUZhWJFQVPlmUk0zU0NVswDIpBsV2TiRqEGtLL8y8KHn8oYiQlQWn1Yowtx4PtejHhyQhsYr2Ep2sKRj8WkavpFwyP6wZ25HPslrph9eD7Aoimg9iYkQ4IgKWGgd2yJgoXFiXa5Yz7Qp+g1559VnAjmcPtuWNcf3OIpubAZlxcShdQdvZgHP+YlKCC1KTMo28+dstdrGXbWN5v4utRRxymcDaYeRZp6Egf+rBcD7rN+ukOAihNuoB6jSaFmpoORBkRQzpLHoztEC3GV2WMpApiMkhc+tbWHTxcLODqZBbDsxKuvNjD6kETHZoouw8w/6OOBwt0TsLGUedCQ6VtotDoCTdsJpiRtzQHc9/rGFs6EUyDeQ8kqaqW+FfKVjURS4C/AV72t7ow7lTfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cache-Control与Expire\"\n        title=\"Cache-Control与Expire\"\n        src=\"/static/6888c4d5d47a64bd65c7f8d2d898a97f/c0255/cache-control.png\"\n        srcset=\"/static/6888c4d5d47a64bd65c7f8d2d898a97f/81c8e/cache-control.png 230w,\n/static/6888c4d5d47a64bd65c7f8d2d898a97f/08a84/cache-control.png 460w,\n/static/6888c4d5d47a64bd65c7f8d2d898a97f/c0255/cache-control.png 920w,\n/static/6888c4d5d47a64bd65c7f8d2d898a97f/b1001/cache-control.png 1380w,\n/static/6888c4d5d47a64bd65c7f8d2d898a97f/2a333/cache-control.png 1484w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>了解强制缓存的过程后，我们拓展性的思考一下：</p>\n<p>浏览器的缓存存放在哪里，如何在浏览器中判断强制缓存是否生效？</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cf3883d8f8d5d7121b8cd0fcb2d086ff/3b2f8/browser-cache.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.130434782608695%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABdklEQVQozz2S6W7rIBSE/f6veKs0tQ1ewm5WO+1XhVvlx4ijWY4YxLBsG+u6IqRknCbu44iYJ6QUzNOIEDNSzOzbhjWaI3iC9/184wgEZ3FaMeijYo/KvFu+5M60KObNcJsWRvngNq2dXx6O3R6sOrCZgNwtq/bI3XT/i1c+MfybNbfFIUxG5x9MBltgdRUVvxE6sfmT++pQ8cl+XIx76Pp99Z3/Mo39eKLTD4MQgmWRPB473lmus/G8Gq1mrlYpOXG2ilaqa62WXvM1v/wpHpy1vnPD5/2LeRY45zhipLXGeZ6klKi14pwnxsi6bV3LOaO1ppaC1galNTmXv1xjEHJjnCVKW0q73oipUOqJcQEfIrsy5HqScsW6QC6ta0o7Yqrd+8oNH7eRj88RZTzl/Ka0/wixksqF8REfC2J5kOuzz/trSTlRNrA+LEc6u5bbk0FK2b+Ns7bXzin1q+eceq1evdfTtFpJMeK961wI/i+T+/O0VvkFvMhiFiM8C0EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"twitter网站缓存\"\n        title=\"twitter网站缓存\"\n        src=\"/static/cf3883d8f8d5d7121b8cd0fcb2d086ff/c0255/browser-cache.png\"\n        srcset=\"/static/cf3883d8f8d5d7121b8cd0fcb2d086ff/81c8e/browser-cache.png 230w,\n/static/cf3883d8f8d5d7121b8cd0fcb2d086ff/08a84/browser-cache.png 460w,\n/static/cf3883d8f8d5d7121b8cd0fcb2d086ff/c0255/browser-cache.png 920w,\n/static/cf3883d8f8d5d7121b8cd0fcb2d086ff/b1001/browser-cache.png 1380w,\n/static/cf3883d8f8d5d7121b8cd0fcb2d086ff/161ec/browser-cache.png 1840w,\n/static/cf3883d8f8d5d7121b8cd0fcb2d086ff/3b2f8/browser-cache.png 2790w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>这里我们以Twitter首页的请求为例，状态码为<code class=\"language-text\">灰色</code>的请求则代表使用了<code class=\"language-text\">强制缓存</code>，请求对应的<code class=\"language-text\">Size</code>值则代表该缓存存放的位置，分别为<code class=\"language-text\">from memory cache</code> 和 <code class=\"language-text\">from disk cache</code>。</p>\n<blockquote>\n<p>那么from memory cache 和 from disk cache又分别代表的是什么呢？什么时候会使用from disk cache，什么时候会使用from memory cache呢？</p>\n</blockquote>\n<p><code class=\"language-text\">from memory cache</code>代表使用内存中的缓存，<code class=\"language-text\">from disk cache</code>则代表使用的是硬盘中的缓存，浏览器读取缓存的顺序为<code class=\"language-text\">memory –> disk</code>。</p>\n<p>虽然我已经直接把结论说出来了，但是相信有不少人对此不能理解，那么接下来我们一起详细分析一下缓存读取问题，这里仍让以Twitter为例进行分析：</p>\n<ul>\n<li>1.访问<a href=\"https://www.twitter.com/\">https://www.twitter.com/</a> –> 200</li>\n<li>2.关闭twitter的标签页 –> 重新打开<a href=\"https://www.twitter.com/\">https://www.twitter.com/</a> -> 200(from disk cache)</li>\n<li>3.刷新 –> 200(from memory cache)</li>\n</ul>\n<p>过程如下：</p>\n<ul>\n<li>1.访问<a href=\"https://www.twitter.com/\">https://www.twitter.com/</a> –> 200</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fa585b7af3d28faa8d4670479275ff46/0b569/twitter-first.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.91304347826087%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABSUlEQVQozz2QWY7lIBAEff9D9th+3gAv7Abs1zECjeYjlVWUMpSik0ohxMY8L/RDTz+OTJ+Rzzg01XmeJ5QUGH3hrGmyRv/3pvNAXyeduALKJiZl+IiLWRkmqfmZZNt/ZtV82S3b6VkP1+51n+TFKDT9dqF0pLK6P8tBv15IkzCJJn3/sruCjl/EFVE2sxwem+CKLx+p2V2mX3Y2m9nsg4nfluv6YWCeZ9Z15TwP3pIpORG8J6ebGALeWXal+L4P+Y4oKQneta+Kd8QFz1sST8l0n6nCNoy13CmRcyHljA+BlBJaG6x1nOfJ8zzcd0Lte7sLITHeY0Og5Nyy3TB8GMYRa20LlFJIKeOcb8Aa1lo3f98KvJFSNeCyrGhrCTH+A2a62m4TooUqtD5WaA3WuXoIgUtr3vdtLWrrGCPHcRDTjYuBtzyU5+EvOTsVvq/kCosAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"首次访问twitter\"\n        title=\"首次访问twitter\"\n        src=\"/static/fa585b7af3d28faa8d4670479275ff46/c0255/twitter-first.png\"\n        srcset=\"/static/fa585b7af3d28faa8d4670479275ff46/81c8e/twitter-first.png 230w,\n/static/fa585b7af3d28faa8d4670479275ff46/08a84/twitter-first.png 460w,\n/static/fa585b7af3d28faa8d4670479275ff46/c0255/twitter-first.png 920w,\n/static/fa585b7af3d28faa8d4670479275ff46/b1001/twitter-first.png 1380w,\n/static/fa585b7af3d28faa8d4670479275ff46/161ec/twitter-first.png 1840w,\n/static/fa585b7af3d28faa8d4670479275ff46/0b569/twitter-first.png 2878w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>2.关闭博客的标签页(相当于关闭进程),重新打开<a href=\"https://www.twitter.com/\">https://www.twitter.com/</a> -> 200</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4d9185b5a6e51507dc6c802c7b0b2e1d/809bc/twitter-sec.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.43478260869565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABdklEQVQoz0WRa3OeIBSE/f8/r5dMO21iRBAEREXw9k7zdCBN+mGHPcty2AON7wXGWuxoUMOA6CVt1zEoiZL9J0o9GsMW1//Y4j8eSds7GiENPh7M6ULZhW5w9Nojx8Cz0LTK0sqxouwpO6P9yhg2lA2VD3ZG2plX7Wl+95ZfcqI1C3LKTPsb4YD5hHG98fkPejmx8eZlCDy1mim/YZaL3sWqP0uPmDJtOGmMVnSiRyqFtY4QZs7z5Lou9rxXnlKqq/cTxoyVr2sZeeM4Dpz31bvng+ZVCH4+d7yIgdEv2Gll2Q5ivpiWxJrOqvk5IbXj69MPzOgxLjD6uXo7NeLCRlgPGqklUpaUAuccj8fN435Huf2+r5qkYJomtDE1falT2riuE+scMW6cx0nTirb+bC8V87x8jnvfN/u+Vx5Lw5TqyMVbtDJyjLH6Pxoe+0nz5dt3hOjpe1kTaq1ZlqU2zDnXlB8Hy1sNg65a8RQUPoVAzjs57fwFoOldHd7SHAoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"关闭进程第二次访问twitter\"\n        title=\"关闭进程第二次访问twitter\"\n        src=\"/static/4d9185b5a6e51507dc6c802c7b0b2e1d/c0255/twitter-sec.png\"\n        srcset=\"/static/4d9185b5a6e51507dc6c802c7b0b2e1d/81c8e/twitter-sec.png 230w,\n/static/4d9185b5a6e51507dc6c802c7b0b2e1d/08a84/twitter-sec.png 460w,\n/static/4d9185b5a6e51507dc6c802c7b0b2e1d/c0255/twitter-sec.png 920w,\n/static/4d9185b5a6e51507dc6c802c7b0b2e1d/b1001/twitter-sec.png 1380w,\n/static/4d9185b5a6e51507dc6c802c7b0b2e1d/161ec/twitter-sec.png 1840w,\n/static/4d9185b5a6e51507dc6c802c7b0b2e1d/809bc/twitter-sec.png 2612w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>3.刷新网页 -> 200</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cfd9c425e8f185ad0c2f84cbc3bf4c89/6f969/twitter-th.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.73913043478261%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhElEQVQozz2P2ZKrMBBD+f8vnJolCWATiPcFbCBzzy38MA+qVqvUUnVn5IgyFqNeCDkxDD23+51JCsQ4/EGKsWnBO1IMpODJKTaerz1F1hjp7lLxChWVDkYV6RfP+ApInbhNhh+heMyOr2FhWHzDZDJS5+brZ4dQkbvUfEya7i5e/AjN/WmZzEqoNMQd7Hpi1zc2n630whUWK02XKmLyidQR+QqIvNPN09jevN7RSqG14tgL72NnLxvnXqllY6+FNSeWeeb3fVDWjLemeZ01eGfhPOh6IfnpJYNc0C5hw0YuJ2X/R0gF4wLGRZ6LZlGWz+8HynhCLmgbm/e6W7Qn15NukIJ+nLj3I8Z6jvOXerzZjzchZpTWKG3oh5F5Xvj4/EIpTUwZ4zxbPXA+Mb80W9npbo8b4ygQQmCMZs2ZWgrncVBKYd/3NlPKrOvKMI5tv7izlr1WYgytpNZK9/n9zTAKpueTEALOOVJKHMfBtm1/xxe/9Ec/EGNq3HvfQmKMGGNb4H83rV4ue6O15QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"f5刷新twitter\"\n        title=\"f5刷新twitter\"\n        src=\"/static/cfd9c425e8f185ad0c2f84cbc3bf4c89/c0255/twitter-th.png\"\n        srcset=\"/static/cfd9c425e8f185ad0c2f84cbc3bf4c89/81c8e/twitter-th.png 230w,\n/static/cfd9c425e8f185ad0c2f84cbc3bf4c89/08a84/twitter-th.png 460w,\n/static/cfd9c425e8f185ad0c2f84cbc3bf4c89/c0255/twitter-th.png 920w,\n/static/cfd9c425e8f185ad0c2f84cbc3bf4c89/b1001/twitter-th.png 1380w,\n/static/cfd9c425e8f185ad0c2f84cbc3bf4c89/161ec/twitter-th.png 1840w,\n/static/cfd9c425e8f185ad0c2f84cbc3bf4c89/6f969/twitter-th.png 2518w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>看到这里可能有人小伙伴问了，最后一个步骤刷新的时候，不是同时存在着<code class=\"language-text\">from disk cache</code>和<code class=\"language-text\">from memory cache</code>吗？</p>\n<p>对于这个问题，我们需要了解内存缓存(from memory cache)和硬盘缓存(from disk cache)，如下:</p>\n<ul>\n<li>\n<p>内存缓存(from memory cache)：内存缓存具有两个特点，分别是快速读取和时效性：</p>\n<ul>\n<li>快速读取：内存缓存会将编译解析后的文件，直接存入该进程的内存中，占据该进程一定的内存资源，以方便下次运行使用时的快速读取。</li>\n<li>时效性：一旦该进程关闭，则该进程的内存则会清空。</li>\n</ul>\n</li>\n<li>\n<p>硬盘缓存(from disk cache)：硬盘缓存则是直接将缓存写入硬盘文件中，读取缓存需要对该缓存存放的硬盘文件进行I/O操作，然后重新解析该缓存内容，读取复杂，速度比内存缓存慢。</p>\n</li>\n</ul>\n<p>在浏览器中，浏览器会在<code class=\"language-text\">js</code>和<code class=\"language-text\">图片</code>等文件解析执行后直接存入<code class=\"language-text\">内存缓存</code>中，那么当刷新页面时只需直接从内存缓存中读取(from memory cache)；而<code class=\"language-text\">css</code>文件则会存入<code class=\"language-text\">硬盘文件</code>中，所以每次渲染页面都需要从硬盘读取缓存(from disk cache)。</p>\n<blockquote>\n<p>在chrome中每一个标签页都是一个单独的进程，所以关掉twitter的标签页，然后重新打开的时候，memory cache都会被清空，而disk cache不会</p>\n</blockquote>\n<h3>协商缓存</h3>\n<p>协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程，主要有以下两种情况：</p>\n<p>协商缓存生效，返回304，如下：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/150d1410d0ea42caf6287df4c23f2cc5/0c3d0/cache-304.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.52173913043477%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABtElEQVQ4y22TB6/CMAyE+f9/DQkhltij7FU2FGjx02fpqpRHJMtpY1/OZ6eUZZk9Hg9bLBbW6XTscDjY+/12+3w+djqdrN1uW6vVss1mY2maupF3u91sMBhYv9/3PfElDp7Pp61WKxsOh3a5XCxc1+vVut2u9Xo9i+O4AAiRKIpsNBr53gF1iAG63W6dUblctmq16szH47G9Xi+/QIBhHtXg+ZcD4ne7nZeIHY/H3LgkSRKPITkE5ZszgZd0AF0xq9frvkefZrPp5VJSuIjHJFmBoQzRYYlW+/3eNaVRgKPVcrm02WzmFdzvd/fr9doBhVEomQR0JAhPZ2u1mjOmMRiMp9Opx8znc9+j77+SMVihGeXBQPrwD2Z44vinmPP57P5nUxAfZsyijG/mDGaMBzFIg2nPaP0EZERgwrhUKhU3dOQfMSy8GvLdlLxkAaILTWHuAIIRuk4mEy8xlEeGfhqbAkNuk9CNRiNvBiXTdTH6HmwNew7IhhsoFxCSdciiUVyAMSYCJYZmMKN0v/D0AIQJJZKkF0AAF5CE0dEQUG9ZkhTecvgCwpLQiHEJz1RBmKem/AFEZXv5K/+4/QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"协商缓存生效304\"\n        title=\"协商缓存生效304\"\n        src=\"/static/150d1410d0ea42caf6287df4c23f2cc5/c0255/cache-304.png\"\n        srcset=\"/static/150d1410d0ea42caf6287df4c23f2cc5/81c8e/cache-304.png 230w,\n/static/150d1410d0ea42caf6287df4c23f2cc5/08a84/cache-304.png 460w,\n/static/150d1410d0ea42caf6287df4c23f2cc5/c0255/cache-304.png 920w,\n/static/150d1410d0ea42caf6287df4c23f2cc5/b1001/cache-304.png 1380w,\n/static/150d1410d0ea42caf6287df4c23f2cc5/0c3d0/cache-304.png 1414w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>协商缓存失效，返回200和请求结果结果，如下:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5bd1393d28a2da96cc00cf6153f58b58/081d5/cache-200.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.65217391304347%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABvUlEQVQ4y3WU56rDMAyF+/7v1D+lUCiddJF0j6R7r6RLl0+g4NBeg7CjeXQsJ/N6veT5fMp2u5XZbCb7/V5Mx346nWQ6ncpkMtHz+/1WPfvxeFTbbrdL/DMWHIahdDodTewuCjSbTWk0GnomEf7s+KInNpUQ+Xw+Wmm5XMpgMJB6va4FcA6CQO2GzoRvE9NlXCMJD4eDynq9VgScV6uVRFGkKAyJyf1+T+mShKzxeCzFYlFb9D1fkXLu9/uJDwu0Jo/H43dC4wRkoIKv4XAo3W5XJQxCbX8+n8vlclFk+G82m4TXr4S0RhD7YrEQ3/el3W5Lq9WSXq+n3yQnKVxzwwD4l0OqkQguqQ4FCCNDstFopHZs+JCMGJfTr5ZplQu43W4aDBIQg8aKXa9XtSPn8/k3hyjjKE6NA4udBO5yxyWO4/9v2fM8yeVyks/npVAoSLlclmw2K6VSSdzCblfc8s+WgQ8fPCda5hbZoYBWeXYEu08PdEwEsamEOEJ8rVbTYObLUEN8tVqVSqWiSbHZ04Nb0BObjI3LhYnpKMSI8PTsp+Hyhx1/Q45kaMsSmYOduQyqMzrcLjrX3/zcuD85j33TMKjavAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"协商缓存失效200\"\n        title=\"协商缓存失效200\"\n        src=\"/static/5bd1393d28a2da96cc00cf6153f58b58/c0255/cache-200.png\"\n        srcset=\"/static/5bd1393d28a2da96cc00cf6153f58b58/81c8e/cache-200.png 230w,\n/static/5bd1393d28a2da96cc00cf6153f58b58/08a84/cache-200.png 460w,\n/static/5bd1393d28a2da96cc00cf6153f58b58/c0255/cache-200.png 920w,\n/static/5bd1393d28a2da96cc00cf6153f58b58/081d5/cache-200.png 1264w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>同样，协商缓存的标识也是在响应报文的HTTP头中和请求结果一起返回给浏览器的，控制协商缓存的字段分别有：<code class=\"language-text\">Last-Modified/ If-Modified-Since</code>和<code class=\"language-text\">Etag/If-None-Match</code>，其中Etag/If-None-Match的优先级比Last-Modified/If-Modified-Since高。</p>\n<h4>Last-Modified/If-Modified-Since</h4>\n<p>Last-Modified是服务器响应请求时，返回该资源文件在服务器最后被修改的时间，如下:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 784px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cf9f02e4c3069450281398ea90ec285c/4971b/Last-Modified.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.43478260869565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABV0lEQVQoz41SDa+CMAz0//8+n0YFNzZgMDYmqBjl40ybB1HjS96SY0ubHu1dV8457Pd7xHEMIQSUUtjtdkiSBHRuXYc8z1EUBdI0w/1+5/g0TYzPs6IgkVKRMQZaa6RpihACfB1wvlwwTSNjHMelcCb7JF3Rh4g2mw13ud1u8bNew1YVRKJQh4DHo8f12jHa9vwn2UJI40gp+c6yjGErh9JWjMp5ZLmBVBq5KXDtuqXbrx0SgRSCi+twwqlpIaTi91Em3C3l6CcE9aHlV0IyxPmaR4yOAqYoodMMMtFIlEaaGwzD8DbuK+bYQhhFEZthTIGmbXnEorR804jf9Ho9c54JrbW8KmQImUMmxUIyIWnWNC267sZahlPDU9BN8co59P3w3mFZlrx/BHKaDCKtnPe8OrOuprTwvuYckVOO3iTFGyHtIWl4OByWBXfOQ+mMO+x/C/4z8hNVI/w0JfJ5VwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Last-Modified\"\n        title=\"Last-Modified\"\n        src=\"/static/cf9f02e4c3069450281398ea90ec285c/4971b/Last-Modified.png\"\n        srcset=\"/static/cf9f02e4c3069450281398ea90ec285c/81c8e/Last-Modified.png 230w,\n/static/cf9f02e4c3069450281398ea90ec285c/08a84/Last-Modified.png 460w,\n/static/cf9f02e4c3069450281398ea90ec285c/4971b/Last-Modified.png 784w\"\n        sizes=\"(max-width: 784px) 100vw, 784px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>If-Modified-Since则是客户端再次发起该请求时，携带<code class=\"language-text\">上次请求返回的Last-Modified值</code>，通过此字段值告诉服务器该资源上次请求返回的最后被修改时间。服务器收到该请求，发现请求头含有If-Modified-Since字段，则会根据If-Modified-Since的字段值与该资源在服务器的最后被修改时间做对比，若服务器的资源最后被修改时间大于If-Modified-Since的字段值，则重新返回资源，状态码为200；否则则返回304，代表资源无更新，可继续使用缓存文件，如下。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6098941657108226201352e28214f55b/4719e/Last-Modified-Since.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.52173913043478%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABIklEQVQoz42Rb0vDMBDG+/2/lS9EQTe2Mcc269qltknbtM3/CsM+ksP6oiJ4cORygV/unicZxxF5nqOqOBgrUDctRN2A1w2aVsI6B+8DjLX4K6Zp+qkT7z3SNEWWZTifT2hbSUBWlASXXQ9tDJQ2GAYFrQ26fsDtdiPQDJvPxIdAE0ZIWQlUoibIoDT6QVHfGEu9Xmm0UqLigt7ihyGEBfByANs+o9yvUb1swA87WPaGUOZQ+SvVhl3g8jOg5bzjr5XnTHxxQfp0j+PDHbLVI+rTHmy3xvt+g+t2RdCxuuKjzACnMS0Ay0x8+DaFczKGDBE1GfK5mOQ/kVhryRTGGLgQlFGjKyvIoKhf10dNFYwx6IeBjGllR3rGu4rathLOOXwB5x8U7wjMsRAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Last-modified-Since\"\n        title=\"Last-modified-Since\"\n        src=\"/static/6098941657108226201352e28214f55b/c0255/Last-Modified-Since.png\"\n        srcset=\"/static/6098941657108226201352e28214f55b/81c8e/Last-Modified-Since.png 230w,\n/static/6098941657108226201352e28214f55b/08a84/Last-Modified-Since.png 460w,\n/static/6098941657108226201352e28214f55b/c0255/Last-Modified-Since.png 920w,\n/static/6098941657108226201352e28214f55b/4719e/Last-Modified-Since.png 1330w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>Etag/If-None-Match</h4>\n<p>Etag是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)，如下:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 848px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/71194a5a776a7456ea28b069fb88d85d/d52e5/Etag.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.95652173913043%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXUlEQVQoz4WSf2/aMBCG+f7faa3WbkDbIbqJTTSGNI5/xE4aMJUQhLQ8ld1/ika3k862TvKju/e9wWq1YrFYsFwuUUqR5znz+ZwQAjHqusZ7jzGG7XabasfjMeW5GMSjaRrKsqQoCqSU6b0OAV839H1/8uEj7Bw0AZ1zqTOjNVmWoZXC+ToBd7s9m80zIWxontoT8KcdRlAE2qrCeZ9uWzkq5xPU2IqiVBSy5GkdOBz6f3RYzilHl8jhF+r7MevfE/LvF1STIermimJ4ib69SvVt9ot2OqLb7T4df8DiJ/ruGjm6wE1H+Psx6u4bbjpGjr9iJ0Pa2Q+OWoCXIP/A68tfup5qaC2Pec5SCFxladsWYyy1r4lbEKPb7znE7F9SRrO6rjvTYTLFkwmBEILZbIbWGm2qZELUcbUOSKXR9l1jbWwyzVh3Hhj3TGRZAmYPD2ltIkiWKjn8v/g48huxJ6sJu8bg7AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Etag\"\n        title=\"Etag\"\n        src=\"/static/71194a5a776a7456ea28b069fb88d85d/d52e5/Etag.png\"\n        srcset=\"/static/71194a5a776a7456ea28b069fb88d85d/81c8e/Etag.png 230w,\n/static/71194a5a776a7456ea28b069fb88d85d/08a84/Etag.png 460w,\n/static/71194a5a776a7456ea28b069fb88d85d/d52e5/Etag.png 848w\"\n        sizes=\"(max-width: 848px) 100vw, 848px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>If-None-Match是客户端再次发起该请求时，携带<code class=\"language-text\">上次请求</code>返回的唯一标识Etag值，通过此字段值告诉服务器该资源上次请求返回的唯一标识值。服务器收到该请求后，发现该请求头中含有If-None-Match，则会根据If-None-Match的字段值与该资源在服务器的Etag值做对比，一致则返回304，代表资源无更新，继续使用缓存文件；不一致则重新返回资源文件，状态码为200，如下。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a33b69563e7f3e7b52a735784c212a2c/52576/if-none-match.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.34782608695652%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABE0lEQVQoz3WR7U6DQBBFef/XMv7QWKNtmgpJSwW2sMB+FmyDpcewicZGmeRmdie7JzNzozzPkbKmkpK6aalkHfKkY9ehtOF0OjMX1+v15h4lSUISx0x5gomyIssLmlZhrKXre4x1eH8M8L7/CJBxHH9gv6FRIQStNpSyCR/rVqGto1E6QJ3zyLrBGIs4lKGmjcF5/z8w2ax5T3dkaUq239N7T+ccTiuO3qONZRiGmxG/u/tP0fbxnu3DHeVqQbV+QSwXiNUzcvnEudhx/rwwXi6zgD/A3esCEa+Dqm0SpLIUvIJh3oy5iDZvMVkhOEyGVJKirEizgtZYlLHUTYPWBhV22oZ9FuIQ6q3SwUildThPb74AOmUW9WNL1TkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"If-None-Match\"\n        title=\"If-None-Match\"\n        src=\"/static/a33b69563e7f3e7b52a735784c212a2c/c0255/if-none-match.png\"\n        srcset=\"/static/a33b69563e7f3e7b52a735784c212a2c/81c8e/if-none-match.png 230w,\n/static/a33b69563e7f3e7b52a735784c212a2c/08a84/if-none-match.png 460w,\n/static/a33b69563e7f3e7b52a735784c212a2c/c0255/if-none-match.png 920w,\n/static/a33b69563e7f3e7b52a735784c212a2c/b1001/if-none-match.png 1380w,\n/static/a33b69563e7f3e7b52a735784c212a2c/52576/if-none-match.png 1412w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>Etag的优先级高于Last-Modified的原因在于：Last-Modified 标注的最后修改只能精确到秒级，如果某些文件在1秒钟以内被修改多次的话，它将不能准确标注文件的修改时间；如果某些文件会被定期生成，但有时内容并没有任何变化，但 Last-Modified 却改变了，导致文件没法使用缓存；</p>\n</blockquote>\n<h3>总结</h3>\n<ul>\n<li>\n<p>强制缓存优先于协商缓存进行</p>\n</li>\n<li>\n<p>若强制缓存( Expires 和 Cache-Control 时间决定 )生效则直接使用缓存</p>\n</li>\n<li>\n<p>若不生效则进行协商缓存( Last-Modified/If-Modified-Since 和 Etag/If-None-Match )，协商缓存由服务器决定是否使用缓存，若协商缓存失效，那么代表该请求的缓存失效，重新获取请求，返回200，然后再存入浏览器缓存中</p>\n</li>\n<li>\n<p>生效则返回 304，继续使用缓存，主要过程如下：</p>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin:0;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a4fc31c39882bae34205e12dfe6c9975/b4472/http-cache-all.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.86956521739131%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABgElEQVQoz4VS2Y6jMBDk/38vIaxyKJMNp00gnDZgu1blrKM5Hgap1C13d7m6TFTXNZIkQdM0cACsc3DOwRgLYwyMtTCLhplHODXBaQWrZ2zzCGv/9xjjZ4hoW1e0zw5u6rHWJYb0A+PHEVtxgxEpdNfCTAPWKkX/94KxuGN5CNhWQiuFbduwriv6vsc4joiklEjTFI+6Rp7n+JMkSA4H1FJCVBWKosCjaZDlBXbxAfs4RiUkSiGQZRm4YVmW2O12OB6PiJZlwfP59LcopSGkRFVVmJXyq7DGHqUUqrJEnmVeiTUGXdf72rKsfoaIKPVyuWAYBljrvC/BQ5LFcexVhHN+xpN1OJ1OEEL4GgXN84yIRFx1mibfSE8I5ryMNcbPNYJEfMz7/e4JtdaeI6KK8/mMYXi92mvAeARV4TXDOXOecXUq+0JI6dfr9b1y+A0Cgtrv+Em4vAhpJL1o29Yb/FKx/QqSUgRnmL8V3m437Pd7MHJ93spGxt9Ab0MvI9X+A3YRAOeFFNJCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"HTTP缓存总揽\"\n        title=\"HTTP缓存总揽\"\n        src=\"/static/a4fc31c39882bae34205e12dfe6c9975/c0255/http-cache-all.png\"\n        srcset=\"/static/a4fc31c39882bae34205e12dfe6c9975/81c8e/http-cache-all.png 230w,\n/static/a4fc31c39882bae34205e12dfe6c9975/08a84/http-cache-all.png 460w,\n/static/a4fc31c39882bae34205e12dfe6c9975/c0255/http-cache-all.png 920w,\n/static/a4fc31c39882bae34205e12dfe6c9975/b1001/http-cache-all.png 1380w,\n/static/a4fc31c39882bae34205e12dfe6c9975/161ec/http-cache-all.png 1840w,\n/static/a4fc31c39882bae34205e12dfe6c9975/b4472/http-cache-all.png 2468w\"\n        sizes=\"(max-width: 920px) 100vw, 920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","excerpt":"概述 浏览器的缓存机制也就是我们说的HTTP缓存机制，其机制是根据HTTP报文的缓存标识进行的，所以在分析浏览器缓存机制之前，我们先使用图文简单介绍一下HTTP报文，HTTP报文分为两种： 请求(request)报文：请求行 – HTTP头(通用信息头，请求头，实体头) – 请求报文主体(只有POST才有报文主体) 响应(response)报文：报文格式为：状态行 – HTTP…","fields":{"slug":"/blog/2018/01/03/http-cache.html","date":"January 02, 2018"},"frontmatter":{"title":"http cache","img":"./img/2015-03-25.jpg","author":["Sylvenas"],"categories":"http"}}},"pageContext":{"slug":"/blog/2018/01/03/http-cache.html"}},"staticQueryHashes":[]}