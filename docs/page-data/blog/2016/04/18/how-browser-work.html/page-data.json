{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/2016/04/18/how-browser-work.html","result":{"data":{"markdownRemark":{"html":"<p>关于浏览器的工作原理，一直存有好奇却又无从下手的状态，最近看到了一篇绝对棒的文章（<a href=\"https://www.html5rocks.com/en/tutorials/internals/howbrowserswork\">原文链接</a>），具体讲解了主流浏览器的工作原理，部分摘抄如下：</p>\n<h3>简介</h3>\n<p>网络浏览器很可能是使用最广的软件。在这篇入门文章中，我将会介绍它们的幕后工作原理。我们会了解到，从您在地址栏输入<code class=\"language-text\">google.com</code>直到您在浏览器屏幕上看到Google首页的整个过程中都发生了些什么。</p>\n<h3>浏览器的主要功能</h3>\n<p>浏览器的主要功能就是向服务器发出请求，在浏览器窗口中展示您选择的网络资源。这里所说的资源一般是指<code class=\"language-text\">HTML</code>文档，也可以是<code class=\"language-text\">PDF</code>、<code class=\"language-text\">图片</code>或其他的类型。资源的位置由用户使用<code class=\"language-text\">URI</code>（统一资源标示符）指定。</p>\n<p>浏览器解析并显示<code class=\"language-text\">HTML</code>文件的方式是在<code class=\"language-text\">HTML</code>和<code class=\"language-text\">CSS</code>规范中指定的。这些规范由网络标准化组织<code class=\"language-text\">W3C</code>（万维网联盟）进行维护。\n多年以来，各浏览器都<code class=\"language-text\">没有完全</code>遵从这些规范，同时还在开发自己独有的扩展程序，这给网络开发人员带来了严重的兼容性问题。如今，大多数的浏览器都是或多或少地遵从规范。</p>\n<p>浏览器的用户界面有很多彼此相同的元素，其中包括：</p>\n<ul>\n<li>用来输入<code class=\"language-text\">URI</code>的地址栏</li>\n<li>前进和后退按钮</li>\n<li>书签设置选项</li>\n<li>用于刷新和停止加载当前文档的刷新和停止按钮</li>\n<li>用于返回主页的主页按钮</li>\n</ul>\n<p>奇怪的是，浏览器的用户界面并没有任何正式的规范，这是多年来的最佳实践自然发展以及彼此之间相互模仿的结果。HTML5也没有定义浏览器必须具有的用户界面元素，但列出了一些通用的元素，例如地址栏、状态栏和工具栏等。当然，各浏览器也可以有自己独特的功能，比如 Firefox 的下载管理器。</p>\n<h3>浏览器的高层结构</h3>\n<p>浏览器的主要组件为 (1.1)：</p>\n<ul>\n<li>用户界面 - 包括地址栏、前进/后退按钮、书签菜单等。除了浏览器主窗口显示的您请求的页面外，其他显示的各个部分都属于用户界面。</li>\n<li>浏览器引擎 - 在用户界面和呈现引擎之间传送指令。</li>\n<li>呈现引擎 - 负责显示请求的内容。如果请求的内容是 HTML，它就负责解析 HTML 和 CSS 内容，并将解析后的内容显示在屏幕上。</li>\n<li>网络 - 用于网络调用，比如 HTTP 请求。其接口与平台无关，并为所有平台提供底层实现。</li>\n<li>用户界面后端 - 用于绘制基本的窗口小部件，比如组合框和窗口。其公开了与平台无关的通用接口，而在底层使用操作系统的用户界面方法。</li>\n<li>JavaScript解释器 - 用于解析和执行 JavaScript 代码。</li>\n<li>数据存储 - 这是持久层。浏览器需要在硬盘上保存各种数据，例如 Cookie。新的 HTML 规范 (HTML5) 定义了“网络数据库”，这是一个完整（但是轻便）的浏览器内数据库。</li>\n</ul>\n<div style=\"text-align:center;margin-top:20px\" align=\"center\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; margin:0;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7ba7cd1c25f87aa6bacc9cc57edd9689/0b533/browser-layers.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 67.82608695652173%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD4klEQVQ4yzWTa2hbZRjH3y8qxcn0gyLIwOoca9w+OFC/DNFPfvCCIrYFvwhjeEMQCg5h2jHbddN16bamcbPtpO161tpuTY7Npbk215OmbXKSc06W28ltpjW3JjlJY5tz8sg5sS/8+T/v84cfD+8F1VzO000qmOEZJskzdPLAG4GAqFSd9Et1O5OU4Bkm06SCoZJB37m/aUeC9VpfK6gy8lHbGVTD1Z8KFjPAqhVaVovk4j6vVkEJV8OjhT+lWswOBKKbTVBaWDjF+yNIsF13wEMd8AnPEsoP//pibWy0f1ep6K8rFT/VRR9T9O8rFee3p+YmG5N3hpq3lD/W23l/Y+zm+dLknRv5qZnRrcuXngb2HxGobYW0wCeIu2gc4AktgGwF4IQe4IToLoCTVoCuuQx0GwHe0AN06f/PDQDHv4nAkcEteF79wI2SAKhlu66DsF4EYmh1u/6Br8JDgBMkkRUenJkCENkyENkdqfaXmxDgWhCoCkByAhhjxZFFVei18RX28M/j9kP7FrmO23jQBs6mufdUOR7wgiBJnecBixcl3WN34G4kB6pcs53nBVAXBJgK5McnFplPxtTht0bmyFN141Vd1o6JZ4ihz61kR7cpeLzbRMm6TcGuHjPddcabln3siLxywZrq7fNmX//Q4D/WY6JkvSZK9q7Bd/QLbL1T5ykdm9JE0R/2CmqYhnU593x7QlpNdRRilR+KLHelyHIDRZYbLKd2B6vpxkA6XL21k2r8UkntDhTi1cFCvDpQSdaurK1lv/pNm3l1aMaHRt5+E4kTbjkwEJIeDFlx5iU2WIYUU4UkUwWWKsO6PQ5eWxR8DhY81jAw61uQDtUgQVcgE+Jgg9j2XJyPv/y1fBUBAPrXPKzbWVsEXgSuLHqec2kSJvdKOuLWJl2u5aTTuhQhLEvhDYs6ypjvhwi7Ok64NSmnS5N0e/TpmGYpelOhz8rQZ2sSUBBvuf1sMLTdyEjNs5eYk3koIXExuZbUuzgdka3FK6gJIPUBBHRWHjj6+EemZ94fyr6gtVEHQC2ExIdNzKIasENFITaUrsUnygLzrYFxddCZ5ne+GHfVHiyOUandy4HUXo8IpGm6jwonbtNhVk4/ZH+nqWCPCGzZbxiln5L0zCM6awY6awLqkQEyu66mOeTtJMJ8U+dOA26LgdG7BUREcMlHrh0iSRI8BAFOpwPWvV7wk+SmCGxa5XMCvQx7UYcSkTtYjSxhOV9xthYsz/rvufFnpy0cefuvNKe4H8uNa/7en1mtTfe+89RjOI7Ty8vLHI7jOY1Gs6dWqbDtyCYiRr887J04d2RV+f2T/wFvbD3Gk8PkRQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"browser layers\" title=\"browser layers\" src=\"/static/7ba7cd1c25f87aa6bacc9cc57edd9689/0b533/browser-layers.png\" srcset=\"/static/7ba7cd1c25f87aa6bacc9cc57edd9689/81c8e/browser-layers.png 230w,\n/static/7ba7cd1c25f87aa6bacc9cc57edd9689/08a84/browser-layers.png 460w,\n/static/7ba7cd1c25f87aa6bacc9cc57edd9689/0b533/browser-layers.png 500w\" sizes=\"(max-width: 500px) 100vw, 500px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>  \n<p>值得注意的是，和大多数浏览器不同，Chrome 浏览器的每个标签页都分别对应一个呈现引擎实例。每个标签页都是一个独立的进程。</p>\n<h3>呈现引擎</h3>\n<p>呈现引擎的作用嘛...当然就是\"呈现\"了，也就是在浏览器的屏幕上显示请求的内容。</p>\n<p>默认情况下，呈现引擎可显示HTML和XML文档与图片。通过插件（或浏览器扩展程序），还可以显示其他类型的内容；例如，使用 PDF 查看器插件就能显示 PDF 文档。但是在本章中，我们将集中介绍其主要用途：显示使用 CSS 格式化的 HTML 内容和图片。</p>\n<p>本文所讨论的浏览器（Firefox、Chrome 浏览器和 Safari）是基于两种呈现引擎构建的。Firefox 使用的是 Gecko，这是 Mozilla 公司“自制”的呈现引擎。而 Safari 和 Chrome 浏览器使用的都是 WebKit。</p>\n<p>WebKit 是一种开放源代码呈现引擎，起初用于 Linux 平台，随后由 Apple 公司进行修改，从而支持苹果机和 Windows。有关详情，请参阅 webkit.org。</p>\n<h4>主流程</h4>\n<p>呈现引擎一开始会从网络层获取请求文档的内容，内容的大小一般限制在 8000 个块以内。</p>\n<p>然后进行如下所示的基本流程：</p>\n<div style=\"text-align:center;margin-top:20px\" align=\"center\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; margin:0;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/71f429bba5ef6fb7bd2221f8082ba20a/0a47e/browser-flow.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 10.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArUlEQVQI1wGiAF3/AMjU4fPR193109nf/8fV5bUYXsYTxtXomNLY4P/R197119/o85i230KTsttC09vk8tLY3/XS2eH/xdTnlypqyhXI1uaz1Nrg/9DW3PTN2efzANXb4fzY1tT+3t3a/9Tc58Rqldg21N/uqOrq6P/p5+X+7e7v/J+64WCfuuJd7u/w+ujm5f/t7ev/1eDvqmeS1Djc5fDA7evp/+nn5f7j6O/8DUWBLtmMpz4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"browser flow\" title=\"browser flow\" src=\"/static/71f429bba5ef6fb7bd2221f8082ba20a/0a47e/browser-flow.png\" srcset=\"/static/71f429bba5ef6fb7bd2221f8082ba20a/81c8e/browser-flow.png 230w,\n/static/71f429bba5ef6fb7bd2221f8082ba20a/08a84/browser-flow.png 460w,\n/static/71f429bba5ef6fb7bd2221f8082ba20a/0a47e/browser-flow.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n<p>呈现引擎将开始解析 HTML 文档，并将各标记逐个转化成 <strong>内容树</strong> 上的 DOM 节点。同时也会解析外部 CSS 文件以及样式元素中的样式数据。HTML 中这些带有视觉指令的样式信息将用于创建另一个树结构：<strong>呈现树</strong>。</p>\n<p>呈现树包含多个带有视觉属性（如颜色和尺寸）的矩形。这些矩形的排列顺序就是它们将在屏幕上显示的顺序。</p>\n<p>呈现树构建完毕之后，进入 <strong>布局</strong> 处理阶段，也就是为每个节点分配一个应出现在屏幕上的确切坐标。下一个阶段是 <strong>绘制</strong> - 呈现引擎会遍历呈现树，由用户界面后端层将每个节点绘制出来。</p>\n<p>需要着重指出的是，这是一个渐进的过程。为达到更好的用户体验，呈现引擎会力求尽快将内容显示在屏幕上。它不必等到整个 HTML 文档解析完毕之后，就会开始构建呈现树和设置布局。在不断接收和处理来自网络的其余内容的同时，呈现引擎会将部分内容解析并显示出来。\n下面是WebKit内核浏览器的主流程示例：</p>\n<div style=\"text-align:center;margin-top:20px\" align=\"center\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; margin:0;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/85a66640e7f1d9b94421884d454cad12/39c09/browser-webkitflow.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 46.52173913043478%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACsUlEQVQoz22RW0hTcQDGv51NlvZgXkjUSiso8aGnoCC60ENBBRGEXeyhgoLeMhK6WA/iCs1AvGxO5zY2t9rmbXPzvqO76C4edznbzqbzrk3N0ArKeoh/6Gt98Hv9fvB9iEQofjQCfoVGxRObbAJCCPLyClLqRGqF7H0bqRWppACEhBBKYh4RiK0BNNLb+PHfcBwPUQ6o0KigdoWh8ERQ/KAav4kHZU/1F5kFJ+5ffwG1NwyFfRxiaxASOgAp7ceJO5X/AJalyiIhvBJplWfk9mBDo5UpxsGKXRaXsdQ4ZpDQfsujbbHKFXrX6g711g8w+RKrD1pmSqALzPJrus1Y3xBSm99385fX0inE4xQ9FYW8QtteJKO9XyVDTKVIrj5q93cGh1yaVXfEXDISskLmCFdLR0KDop7ZzJo+P7q4eej8s6jvMeDLZhI2vyfj0+c9wNYWEI0CDb1abO9nT6xANx7MbbaFblRbAg9rrbFCHFMLmtpaTjfolEXOYEfByw+ejI+++JVWb/xCrdmQllhLObWynnp1IZF5HISA/+cH+G/1Sirw81eSciyCZlvwptLhJ6qxAJE7I9I6vfaSlekgw0wbMY8ZS0tanJdb3UEis7HfxD2NtxKr/MnZeSFZWk1zbBfuUN5aDxO3AA0T3znrbiO3917DxJHXfRvC4YmODNrXXdA5YjgknieosrCCllEuV+Zgs88+J1R4Ojt9ennffoY7nAove6BrIpw1XG+quq0cjbIKJ6suk2oLbf6OQXrcMOMM9z5Z2rSjy94Oo00P2qtDpZmFwhWDfDSMa28IYnNZmEvkIDCZDywsCsjkdPJMnan2nLjf21TX736sHjCdt463m8w2TactNHjSM0VjiDEJuh16atDbhfJ2H9TeGE/p4njPVGHMLafyFlczebG5HN5fJGKA2NzSQnMAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"browser webkitflow\" title=\"browser webkitflow\" src=\"/static/85a66640e7f1d9b94421884d454cad12/39c09/browser-webkitflow.png\" srcset=\"/static/85a66640e7f1d9b94421884d454cad12/81c8e/browser-webkitflow.png 230w,\n/static/85a66640e7f1d9b94421884d454cad12/08a84/browser-webkitflow.png 460w,\n/static/85a66640e7f1d9b94421884d454cad12/39c09/browser-webkitflow.png 624w\" sizes=\"(max-width: 624px) 100vw, 624px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n<h4>解析的基本流程</h4>\n<p>解析文档是指将文档转化成为有意义的结构，也就是可让代码理解和使用的结构。</p>\n<p>解析得到的结果通常是代表了文档结构的节点树，它称作解析树或者语法树。</p>\n<p>解析的过程可以分成两个子过程：<code class=\"language-text\">词法分析</code>和<code class=\"language-text\">语法分析</code>。</p>\n<p><code class=\"language-text\">词法分析</code>是将输入内容分割成大量标记的过程。标记是语言中的词汇，即构成内容的单位。在人类语言中，它相当于语言字典中的单词。</p>\n<p><code class=\"language-text\">语法分析</code>是应用语言的语法规则的过程。\n解析器通常将解析工作分给以下两个组件来处理：<code class=\"language-text\">词法分析器</code>（有时也称为标记生成器），负责将输入内容分解成一个个有效标记；而<code class=\"language-text\">解析器</code>负责根据语言的语法规则分析文档的结构，从而构建<code class=\"language-text\">解析树</code>。词法分析器知道如何将无关的字符（比如空格和换行符）分离出来。</p>\n<div style=\"text-align:center;margin-top:20px\" align=\"center\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 101px; margin:0;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/175e3c1dd7246701c39c7ad7f841ddc4/2c66b/browser-lexical.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 297.029702970297%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"browser lexical\" title=\"browser lexical\" src=\"/static/175e3c1dd7246701c39c7ad7f841ddc4/2c66b/browser-lexical.png\" srcset=\"/static/175e3c1dd7246701c39c7ad7f841ddc4/2c66b/browser-lexical.png 101w\" sizes=\"(max-width: 101px) 100vw, 101px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n<p>解析是一个迭代的过程。通常，解析器会向词法分析器请求一个新标记，并尝试将其与某条语法规则进行匹配。如果发现了匹配规则，解析器会将一个对应于该标记的节点添加到解析树中，然后继续请求下一个标记。</p>\n<p>如果没有规则可以匹配，<code class=\"language-text\">解析器</code>就会将标记存储到内部，并继续请求标记，直至找到可与所有内部存储的标记匹配的规则。如果找不到任何匹配规则，解析器就会引发一个异常。这意味着文档无效，包含语法错误。</p>\n<p>很多时候，<code class=\"language-text\">解析树</code>还不是最终产品。解析通常是在<code class=\"language-text\">翻译</code>过程中使用的，而<code class=\"language-text\">翻译</code>是指将输入文档转换成另一种格式。编译就是这样一个例子。编译器可将源代码编译成机器代码，具体过程是<code class=\"language-text\">首先将源代码解析成解析树，然后将解析树翻译成机器代码文档</code>。</p>\n<div style=\"text-align:center;margin-top:20px\" align=\"center\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 104px; margin:0;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/adedd28fadec708cb4e0c8dd5d24448c/c6fc0/browser-translate.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 384.6153846153846%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"browser translate\" title=\"browser translate\" src=\"/static/adedd28fadec708cb4e0c8dd5d24448c/c6fc0/browser-translate.png\" srcset=\"/static/adedd28fadec708cb4e0c8dd5d24448c/c6fc0/browser-translate.png 104w\" sizes=\"(max-width: 104px) 100vw, 104px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n<h4>处理脚本和样式表的顺序</h4>\n<h5>脚本</h5>\n<p>网络的模型是同步的。网页作者希望解析器遇到<code class=\"language-text\">&lt;script></code>标记时立即解析并执行脚本。文档的解析将停止，直到脚本执行完毕。如果脚本是外部的，那么解析过程会停止，直到从网络同步抓取资源完成后再继续。此模型已经使用了多年，也在 HTML4 和 HTML5 规范中进行了指定。作者也可以将脚本标注为<code class=\"language-text\">defer</code>，这样它就不会停止文档解析，而是等到解析结束才执行。HTML5 新增了<code class=\"language-text\">async</code>属性可将脚本标记为异步，以便由其他线程解析和执行。</p>\n<p>当浏览器碰到<code class=\"language-text\">scrip</code> 脚本的时候：</p>\n<ul>\n<li><code class=\"language-text\">&lt;script src=\"script.js\">&lt;/script></code></li>\n</ul>\n<p>没有<code class=\"language-text\">defer</code>或<code class=\"language-text\">async</code>，浏览器会立即加载并执行指定的脚本，<code class=\"language-text\">立即</code>指的是在渲染该<code class=\"language-text\">script</code>标签之下的文档元素之前，也就是说不等待后续载入的文档元素，读到就加载并执行。</p>\n<ul>\n<li><code class=\"language-text\">&lt;script async src=\"script.js\">&lt;/script></code></li>\n</ul>\n<p>有<code class=\"language-text\">async</code>，加载和渲染后续文档元素的过程将和<code class=\"language-text\">script.js</code>的加载与执行并行进行(异步)，<code class=\"language-text\">async</code>的执行，并不会按着<code class=\"language-text\">script</code>在页面中的顺序来执行，而是谁先加载完谁执行。</p>\n<ul>\n<li><code class=\"language-text\">&lt;script defer src=\"myscript.js\">&lt;/script></code></li>\n</ul>\n<p>如果<code class=\"language-text\">script</code>标签设置了该属性，则浏览器会异步的下载该文件并且不会影响到后续DOM的渲染；如果有多个设置了<code class=\"language-text\">defer</code>的script标签存在，则会按照顺序执行所有的script；<code class=\"language-text\">defer</code>脚本会在文档渲染完毕后，<code class=\"language-text\">DOMContentLoaded</code>事件调用前执行。、</p>\n<div style=\"text-align:center;margin-top:20px\" align=\"center\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 689px; margin:0;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/244a0c3246f534e96ce88124e3978261/86056/script-async.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 16.086956521739133%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAADABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAd2EUH//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAXEAADAQAAAAAAAAAAAAAAAAAAARAh/9oACAEBAAE/IRbP/9oADAMBAAIAAwAAABAID//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABkQAAIDAQAAAAAAAAAAAAAAAAABESFRQf/aAAgBAQABPxBbknRk2z//2Q=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"script async\" title=\"script async\" src=\"/static/244a0c3246f534e96ce88124e3978261/86056/script-async.jpg\" srcset=\"/static/244a0c3246f534e96ce88124e3978261/e83b4/script-async.jpg 230w,\n/static/244a0c3246f534e96ce88124e3978261/e41a8/script-async.jpg 460w,\n/static/244a0c3246f534e96ce88124e3978261/86056/script-async.jpg 689w\" sizes=\"(max-width: 689px) 100vw, 689px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n<p>蓝色线代表网络读取，红色线代表执行时间，这俩都是针对脚本的；绿色线代表 HTML 解析。</p>\n<h5>预解析</h5>\n<p>WebKit和Firefox都进行了这项优化。在执行脚本时，其他线程会解析文档的其余部分，找出并加载需要通过网络加载的其他资源。通过这种方式，资源可以在并行连接上加载，从而提高总体速度。请注意，预解析器不会修改DOM树，而是将这项工作交由主解析器处理；预解析器只会解析外部资源（例如外部脚本、样式表和图片）的引用。</p>\n<p>#####样式表\n另一方面，样式表有着不同的模型。理论上来说，应用样式表不会更改DOM树，因此似乎没有必要等待样式表并停止文档解析。但这涉及到一个问题，就是脚本在文档解析阶段会请求样式信息。如果当时还没有加载和解析样式，脚本就会获得错误的回复，这样显然会产生很多问题。这看上去是一个非典型案例，但事实上非常普遍。Firefox 在样式表加载和解析的过程中，会禁止所有脚本。而对于WebKit而言，仅当脚本尝试访问的样式属性可能受尚未加载的样式表影响时，它才会禁止该脚本。</p>\n<h3>构建呈现树</h3>\n<p>在 DOM 树构建的同时，浏览器还会构建另一个树结构：呈现树。这是由可视化元素按照其显示顺序而组成的树，也是文档的可视化表示。它的作用是让您按照正确的顺序绘制内容。</p>\n<p>Firefox 将呈现树中的元素称为“框架”。WebKit 使用的术语是呈现器或呈现对象。\n呈现器知道如何布局并将自身及其子元素绘制出来。</p>\n<h4>呈现树和DOM树的关系</h4>\n<p>呈现器是和 DOM 元素相对应的，但并非一一对应。非可视化的 DOM 元素不会插入呈现树中，例如“head”元素。如果元素的 display 属性值为“none”，那么也不会显示在呈现树中（但是 visibility 属性值为“hidden”的元素仍会显示）。\n有一些 DOM 元素对应多个可视化对象。它们往往是具有复杂结构的元素，无法用单一的矩形来描述。例如，“select”元素有 3 个呈现器：一个用于显示区域，一个用于下拉列表框，还有一个用于按钮。如果由于宽度不够，文本无法在一行中显示而分为多行，那么新的行也会作为新的呈现器而添加。\n另一个关于多呈现器的例子是格式无效的 HTML。根据 CSS 规范，inline 元素只能包含 block 元素或 inline 元素中的一种。如果出现了混合内容，则应创建匿名的 block 呈现器，以包裹 inline 元素。</p>\n<p>有一些呈现对象对应于 DOM 节点，但在树中所在的位置与 DOM 节点不同。浮动定位和绝对定位的元素就是这样，它们处于正常的流程之外，放置在树中的其他地方，并映射到真正的框架，而放在原位的是占位框架。</p>\n<div style=\"text-align:center;margin-top:20px\" align=\"center\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 731px; margin:0;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a43a99a924a135f54b9ccd937b6c5de5/6e9ba/browser-renderTree.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 54.347826086956516%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACRElEQVQozy2RS08TYRSG5xepC/+BurVsXJBoZOmKmGDwEnGlUcGEjRrYEI2JiRDFEDUxmEBULFNgAmVKOu3M0Gk77XRu32Uu33Qu3zEtPOvznPc9OQIAAC8AYIi01tpEY+lCY/li99tUQvt5AUFACSEBDRBG9jtbfi4fzR91F7upkwKAAAA55xlAkcWuubv6d+Vz+X39+Kdr9xHCURQxxljM4jT2yp50XxJnxP7XPi/4uQwAo2jOyyS+rHVKerfabDHX9TFGY3zPxxHGGj6cOaxOV9EOGtflQloULy3rpq5vdDo8oE6WTjeU25r227J8y/J8f2wjFCBP8cQ5cffBLq7gcRYXcl7M98zSyXE5pAAQFcXjdvuWqtYYK5IkikdEYRQNI6IS6aFUna3if/isrZBymLbDSzXjezLaBgBzlnWt2RzYdoKQ6/u+7xFMGLDQDPfv7Ut3JVqh53IU7+0Yy19Onpp0NUx76667Lle31MZSvXZgD0Lkeb7rem5f7Bs/DHVDVTdV/atOJZrHuYDQs/rxVb1eYnhKcbYnaq7GMgC4Y5IPHTennCUwTBPto7Y5u6mv6b0/vb0Xe8qSkuFM4Hx0OiZvZXmyUS/59uQwOYjjbat9Qz68YlnXHeeNT2jnU7vypNLb6CERKYvK6cppRjIBIC8KCMNfg8FCs/nIdl6laTtN1TB6relzhCzkucgB0I5vrpvsiGEZt1ZbaAvlYX7+5zOyDCgFQiKMY0rBcYaGEXS7ntFqdV2TZpQkhDKaQ342/x+HUz1yie2uUwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"browser renderTree\" title=\"browser renderTree\" src=\"/static/a43a99a924a135f54b9ccd937b6c5de5/6e9ba/browser-renderTree.png\" srcset=\"/static/a43a99a924a135f54b9ccd937b6c5de5/81c8e/browser-renderTree.png 230w,\n/static/a43a99a924a135f54b9ccd937b6c5de5/08a84/browser-renderTree.png 460w,\n/static/a43a99a924a135f54b9ccd937b6c5de5/6e9ba/browser-renderTree.png 731w\" sizes=\"(max-width: 731px) 100vw, 731px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n<h3>布局</h3>\n<p>呈现器在创建完成并添加到呈现树时，并不包含位置和大小信息。计算这些值的过程称为<code class=\"language-text\">布局</code>或<code class=\"language-text\">重排</code>。</p>\n<p>HTML采用基于流的布局模型，这意味着大多数情况下只要一次遍历就能计算出几何信息。处于流中靠后位置元素通常不会影响靠前位置元素的几何特征，因此布局可以按从左至右、从上至下的顺序遍历文档。但是也有例外情况，比如 HTML 表格的计算就需要不止一次的遍历 (3.5)。</p>\n<p>坐标系是相对于根框架而建立的，使用的是<code class=\"language-text\">上坐标和左坐标</code>。</p>\n<p>布局是一个递归的过程。它从根呈现器（对应于 HTML 文档的 <html> 元素）开始，然后递归遍历部分或所有的框架层次结构，为每一个需要计算的呈现器计算几何信息。</p>\n<p>根呈现器的位置左边是 0,0，其尺寸为视口（也就是浏览器窗口的可见区域）。\n所有的呈现器都有一个“layout”或者“reflow”方法，每一个呈现器都会调用其需要进行布局的子代的 layout 方法。</p>\n<h4>全局布局和增量布局</h4>\n<p>全局布局是指触发了整个呈现树范围的布局，触发原因可能包括：</p>\n<ul>\n<li>影响所有呈现器的全局样式更改，例如字体大小更改。</li>\n<li>屏幕大小调整。</li>\n</ul>\n<p>布局可以采用增量方式，也就是只对 dirty 呈现器进行布局（这样可能存在需要进行额外布局的弊端）。\n当呈现器为 dirty 时，会异步触发增量布局。例如，当来自网络的额外内容添加到 DOM 树之后，新的呈现器附加到了呈现树中。</p>\n<h4>异步布局和同步布局</h4>\n<p>增量布局是异步执行的。Firefox 将增量布局的“reflow 命令”加入队列，而调度程序会触发这些命令的批量执行。WebKit 也有用于执行增量布局的计时器：对呈现树进行遍历，并对 dirty 呈现器进行布局。\n请求样式信息（例如“offsetHeight”）的脚本可同步触发增量布局。\n全局布局往往是同步触发的。\n有时，当初始布局完成之后，如果一些属性（如滚动位置）发生变化，布局就会作为回调而触发。</p>\n<h3>绘制</h3>\n<p>在绘制阶段，系统会遍历呈现树，并调用呈现器的“paint”方法，将呈现器的内容显示在屏幕上。绘制工作是使用用户界面基础组件完成的。</p>\n<h4>全局绘制和增量绘制</h4>\n<p>和布局一样，绘制也分为全局（绘制整个呈现树）和增量两种。在增量绘制中，部分呈现器发生了更改，但是不会影响整个树。更改后的呈现器将其在屏幕上对应的矩形区域设为无效，这导致 OS 将其视为一块“dirty 区域”，并生成“paint”事件。OS 会很巧妙地将多个区域合并成一个。在 Chrome 浏览器中，情况要更复杂一些，因为 Chrome 浏览器的呈现器不在主进程上。Chrome 浏览器会在某种程度上模拟 OS 的行为。展示层会侦听这些事件，并将消息委托给呈现根节点。然后遍历呈现树，直到找到相关的呈现器，该呈现器会重新绘制自己（通常也包括其子代）。</p>\n<h4>绘制顺序</h4>\n<p>CSS2 规范定义了绘制流程的顺序。绘制的顺序其实就是元素进入堆栈样式上下文的顺序。这些堆栈会从后往前绘制，因此这样的顺序会影响绘制。块呈现器的堆栈顺序如下：</p>\n<ul>\n<li>背景颜色</li>\n<li>背景图片</li>\n<li>边框</li>\n<li>子代</li>\n<li>轮廓</li>\n</ul>\n<h4>Firefox 显示列表</h4>\n<p>Firefox 遍历整个呈现树，为绘制的矩形建立一个显示列表。列表中按照正确的绘制顺序（先是呈现器的背景，然后是边框等等）包含了与矩形相关的呈现器。这样等到重新绘制的时候，只需遍历一次呈现树，而不用多次遍历（绘制所有背景，然后绘制所有图片，再绘制所有边框等等）。\nFirefox 对此过程进行了优化，也就是不添加隐藏的元素，例如被不透明元素完全遮挡住的元素。</p>\n<h4>WebKit 矩形存储</h4>\n<p>在重新绘制之前，WebKit 会将原来的矩形另存为一张位图，然后只绘制新旧矩形之间的差异部分。\n<strong>动态变化</strong><br>\n在发生变化时，浏览器会尽可能做出最小的响应。因此，元素的颜色改变后，只会对该元素进行重绘。元素的位置改变后，只会对该元素及其子元素（可能还有同级元素）进行布局和重绘。添加 DOM 节点后，会对该节点进行布局和重绘。一些重大变化（例如增大“html”元素的字体）会导致缓存无效，使得整个呈现树都会进行重新布局和绘制。</p>","excerpt":"关于浏览器的工作原理，一直存有好奇却又无从下手的状态，最近看到了一篇绝对棒的文章（原文链接），具体讲解了主流浏览器的工作原理，部分摘抄如下： 简介 网络浏览器很可能是使用最广的软件。在这篇入门文章中，我将会介绍它们的幕后工作原理。我们会了解到，从您在地址栏输入直到您在浏览器屏幕上看到Google…","fields":{"slug":"/blog/2016/04/18/how-browser-work.html","date":"April 17, 2016"},"frontmatter":{"title":"how browser work","img":"./img/2016-04-18.jpeg","author":["Sylvenas"],"categories":"browser"}}},"pageContext":{"slug":"/blog/2016/04/18/how-browser-work.html"}},"staticQueryHashes":[]}