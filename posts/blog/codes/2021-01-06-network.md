---
title: "network"
author: [Sylvenas]
categories: 'code'
img: './img/2015-03-25.jpg'
---

## cors
### 简单请求
同时满足以下两个条件
1.请求方法
- HEAD
- GET
- POST

2.HTTP的头信息不超出以下几种字段：
- Accept
- Accept-Language
- Content-Language
- Last-Event-ID
- Content-Type：只限于三个值application/x-www-form-urlencoded、multipart/form-data、text/plain

浏览器在发起请求的时候会携带 origin header,服务端判定是否在许可范围内，如果是，则 response 中包含`Access-Control-Allow-Origin`，浏览器会识别该字段准许通行，否则抛出错误

### 非简单请求
1.请求方法
- PUT
- DELETE

2.HTTP的头以下几种字段：
- Content-Type：application/json

非简单请求的CORS请求，会在正式通信之前，增加一次 HTTP 查询请求，称为"预检"请求（preflight）。

"预检"请求用的请求方法是 `OPTIONS`，表示这个请求是用来询问的。头信息里面，关键字段是 `Origin`，表示请求来自哪个源。


服务器收到"预检"请求以后，检查了 `Origin`、`Access-Control-Request-Method` 和`Access-Control-Request-Headers` 字段以后，确认允许跨源请求，就可以做出回应

如果服务器否定了"预检"请求，会返回一个正常的HTTP回应，但是没有任何CORS相关的头信息字段。这时，浏览器就会认定，服务器不同意预检请求，因此触发一个错误，被XMLHttpRequest对象的onerror回调函数捕获。控制台会打印出如下的报错信息。

一旦服务器通过了"预检"请求，以后每次浏览器正常的CORS请求，就都跟简单请求一样，会有一个Origin头信息字段。服务器的回应，也都会有一个Access-Control-Allow-Origin头信息字段。

