{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/2017/10/24/Rxjs-intro.html","result":{"data":{"markdownRemark":{"html":"<p>在介绍Rxjs之前，先通过一个简单的输入框示例的演化来了解一下Rxjs的核心思想。\n<img src=\"../../images/input-example.gif\" alt=\"example\"><br>\n这是input输入框的示例非常简单，就是在input输入的时候，实时更新下面的文字，程序的逻辑看起来是这样的：\n<img src=\"../../images/data-model.jpeg\" alt=\"example\"><br>\n从上面的实例中我们可以梳理处三个基本的概念：</p>\n<ul>\n<li>Provider/数据的提供者<br>\n在这个示例中<strong>数据的提供者</strong>就是input的输入内容，每当输入一个字符的时候都会生成新的数据value。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> input <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ninput<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> value <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>data/数据<br>\n这个实例中的<strong>数据</strong>就是输入框输入的内容</li>\n<li>Consumer/数据的消费者<br>\n在这个小程序中<strong>数据的消费者</strong>就是一个简单的界面，根据<strong>数据</strong>来更新h1标签的内容。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> h1 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nh1<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>观察者模式</h3>\n<p>现在我们使用观察者模式来重写这个例子：<br>\n在观察者模式中，我们总结出的三个基本概念都有了正式的定义：</p>\n<ul>\n<li>数据提供者：可观察对象／Observable</li>\n<li>数据：通知／Notification</li>\n<li>数据消费者：观察者／Observer</li>\n</ul>\n<p>除此之外观察者模式明确定义了<strong>可观察对象</strong>和<strong>观察者</strong>之前的契约：每当<strong>可观察对象</strong>生成新的数据的时候，就调用<strong>观察者预定义的数据接收接口</strong>，然后观察者调用<strong>自身的数据消费逻辑</strong>。\n<img src=\"../../images/pub-sub.jpeg\" alt=\"example\"></p>\n<ul>\n<li>\n<p>1.Observer/观察者</p>\n<ul>\n<li>1.1出于扩展的考虑，我们将<strong>数据的消费逻辑</strong>封装到一个函数中：</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">Observer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">consumer</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_consumer <span class=\"token operator\">=</span> consumer<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>1.2观察者要实现一个<strong>数据接收的接口</strong>，例如：onNotify，<strong>可观察对象</strong>要调用这个接口来传递数据</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token class-name\">Observer</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onNotify</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//调用真正的消费逻辑</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_consumer</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>2.Observable 可观察对象</p>\n<ul>\n<li>2.1一个<strong>可观察对象要能生成数据</strong>，我们把生成数据的逻辑封装到一个函数中，调用这个函数生成器，就能生成新的数据。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">Observable</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">generator</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//先保存生成器，当观测者连接时再执行</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_generator <span class=\"token operator\">=</span> generator<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>2.2<strong>可观察对象还需要提供一个方法供观察者连接</strong>，当连接契约建立的时候，将观察者传入数据生成器。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token class-name\">Observable</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">subscribe</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">observer</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//将观察者传入数据生成器</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_generator</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> observer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>在数据生成器中调用观察者的onNotify方法，把新的数据传递给观察者.</p>\n</blockquote>\n</li>\n<li>\n<p>3.现在我们可以使用Observable类和Observer类来重写我们的input的示例</p>\n<ul>\n<li>3.1 定义可观察对象</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">generator</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">observer</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    input<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> value <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n        observer<span class=\"token punctuation\">.</span><span class=\"token function\">onNotify</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> inputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Observable</span><span class=\"token punctuation\">(</span>generator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>3.2 定义观察者</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">consumer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        h1<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> uiRefresher <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Observer</span><span class=\"token punctuation\">(</span>consumer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>3.3 建立连接契约</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">inputStream<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>uiRefresher<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n<p><strong>上面基于观察者模式实现的示例，全部的代码在完整的代码在<a href=\"https://jsbin.com/gopurogile/1/edit?html,js,output\">jsbin</a></strong></p>\n<h3>Rxjs</h3>\n<p>现在我们使用Rxjs来重写这个示例：<br>\n首先简单介绍一下Rxjs,Rxjs的全名为：<strong>Reactive Extensions for JavaScript</strong>,RxJS is a reactive streams library that allows you to work with <em>asynchronous data streams</em>. RxJS can be used both in the browser or in the server-side using Node.js.<br>\nRxjs隶属是庞大的<a href=\"http://reactivex.io/\">ReactiveX</a>家族的一员,同样有RxJava,RxSwift等等。\n<img src=\"../../images/ReactiveX.jpeg\" alt=\"ReactiveX\"></p>\n<ul>\n<li>Rx.Observable.fromEvent()</li>\n</ul>\n<p>Rxjs提供了Rx.Observable.fromEvent()方法让我们从一个DOM事件，来实例化一个<strong>Observable/可观察对象</strong>。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> input <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> observable <span class=\"token operator\">=</span> Rx<span class=\"token punctuation\">.</span>Observable<span class=\"token punctuation\">.</span><span class=\"token function\">fromEvent</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Observer</li>\n</ul>\n<p>在Rxjs中<strong>Observer/观察者</strong>是一个由回调函数组成的对象，键名分别为<code class=\"language-text\">next</code>,<code class=\"language-text\">error</code>,<code class=\"language-text\">complete</code>, 值分别为三个函数，这三个属性并不是全部必须的。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> h1 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> observer <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">next</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n        h1<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>subscribe()</li>\n</ul>\n<p>和我们的示例一样，调用可观察对象的<code class=\"language-text\">subscribe</code>方法，来建立可观察对象和观察者之间契约。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">observable<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>短短几行代码，实现了和上面一样的逻辑，希望通过这个简单的例子，能让大家对Rxjs的核心思路有个基本的概念，上面的Rxjs实现的完整的例子在<a href=\"https://jsbin.com/rasesupapa/edit?html,js,output\">jsbin</a></strong></p>","excerpt":"在介绍Rxjs之前，先通过一个简单的输入框示例的演化来了解一下Rxjs的核心思想。\nexample 这是input输入框的示例非常简单，就是在input输入的时候，实时更新下面的文字，程序的逻辑看起来是这样的：\nexample 从上面的实例中我们可以梳理处三个基本的概念： Provider/数据的提供者 在这个示例中数据的提供者就是input的输入内容，每当输入一个字符的时候都会生成新的数据value。 data/数据 这个实例中的数据就是输入框输入的内容 Consumer…","fields":{"slug":"/blog/2017/10/24/Rxjs-intro.html","date":"2017-10-23T16:00:00.000Z"},"frontmatter":{"title":"Rxjs intro","img":"./img/2017-10-24.jpeg","author":["Sylvenas"],"categories":"Rxjs"}}},"pageContext":{"slug":"/blog/2017/10/24/Rxjs-intro.html"}},"staticQueryHashes":[]}